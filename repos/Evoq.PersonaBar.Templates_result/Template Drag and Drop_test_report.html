<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Template Drag and Drop</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0 0 10px 0;
        }
        .header p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .summary-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .summary-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
        }
        .summary-item.blocked {
            background-color: #fff3e0;
            border: 2px solid #ff9800;
        }
        .summary-item.fail {
            background-color: #ffebee;
            border: 2px solid #f44336;
        }
        .summary-item.pass {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
        }
        .summary-item .count {
            font-size: 36px;
            font-weight: bold;
        }
        .summary-item.blocked .count { color: #ff9800; }
        .summary-item.fail .count { color: #f44336; }
        .summary-item.pass .count { color: #4caf50; }
        .test-scenario {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-scenario h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-blocked {
            background-color: #ff9800;
            color: white;
        }
        .status-fail {
            background-color: #f44336;
            color: white;
        }
        .status-pass {
            background-color: #4caf50;
            color: white;
        }
        .steps {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .steps li {
            margin-bottom: 8px;
        }
        .screenshot {
            margin: 15px 0;
            text-align: center;
        }
        .screenshot img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .screenshot figcaption {
            color: #666;
            font-size: 14px;
            margin-top: 8px;
        }
        .observations {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .error-details {
            background-color: #ffebee;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            margin: 15px 0;
        }
        .blocker-notice {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .blocker-notice h2 {
            margin-top: 0;
        }
        .code-review {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .code-review h4 {
            margin-top: 0;
        }
        .code-review code {
            background-color: #e0e0e0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        .footer {
            text-align: center;
            color: #666;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Test Report: Template Drag and Drop</h1>
        <p><strong>Extension:</strong> Evoq.PersonaBar.Templates (PersonaBar Module)</p>
        <p><strong>Feature:</strong> Reorder templates in hierarchy by dragging and dropping them to new positions</p>
        <p><strong>Priority:</strong> Low | <strong>Extension Priority:</strong> High</p>
        <p><strong>Test Date:</strong> December 30, 2025</p>
        <p><strong>UI Location:</strong> Admin > Manage > Templates > Drag handle on template items</p>
    </div>

    <div class="blocker-notice">
        <h2>BLOCKER: Server API Errors Prevent Testing</h2>
        <p>The Templates feature API endpoints are returning <strong>HTTP 500 Internal Server Error</strong> responses, which completely blocks the ability to test the drag and drop functionality.</p>
        <p>Affected API endpoints:</p>
        <ul>
            <li><code>GetPageTemplates</code> - Returns 500 error (cannot load templates list)</li>
            <li><code>SavePageAsTemplate</code> - Returns 500 error (cannot create new templates)</li>
        </ul>
        <p><strong>Impact:</strong> Without being able to load or create templates, there is nothing to drag and drop. All planned test scenarios are blocked.</p>
    </div>

    <div class="summary-box">
        <h2>Test Summary</h2>
        <div class="summary-grid">
            <div class="summary-item pass">
                <div class="count">2</div>
                <div>Passed</div>
            </div>
            <div class="summary-item blocked">
                <div class="count">6</div>
                <div>Blocked</div>
            </div>
            <div class="summary-item fail">
                <div class="count">1</div>
                <div>Failed</div>
            </div>
        </div>
    </div>

    <div class="test-scenario">
        <h3>
            <span class="status-badge status-pass">PASS</span>
            Scenario 1: Navigate to Templates Feature
        </h3>
        <p><strong>Description:</strong> Navigate to the Templates management page via Admin > Manage > Templates</p>
        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Opened browser and navigated to http://localhost:8081</li>
                <li>Logged in as superuser (host / Pass123456)</li>
                <li>Clicked on "Manage" in the PersonaBar</li>
                <li>Selected "Templates" from the submenu</li>
            </ol>
        </div>
        <figure class="screenshot">
            <img src="Template Drag and Drop_step01_login_page.png" alt="Login page">
            <figcaption>Step 1: Login page loaded successfully</figcaption>
        </figure>
        <div class="observations">
            <strong>Result:</strong> Successfully navigated to the Page Templates section. The UI loaded but showed an error when trying to retrieve template data.
        </div>
    </div>

    <div class="test-scenario">
        <h3>
            <span class="status-badge status-fail">FAIL</span>
            Scenario 2: Load Templates List
        </h3>
        <p><strong>Description:</strong> Verify templates are loaded and displayed in the Templates management area</p>
        <div class="error-details">
            <h4>Error Encountered:</h4>
            <p><strong>HTTP 500 Internal Server Error</strong> when calling <code>GetPageTemplates</code> API</p>
            <p>Error message displayed: "There was an error retrieving your content. Please check your internet connection."</p>
        </div>
        <figure class="screenshot">
            <img src="Template Drag and Drop_step02_templates_error.png" alt="Templates error">
            <figcaption>Server error when loading templates</figcaption>
        </figure>
        <figure class="screenshot">
            <img src="Template Drag and Drop_step03_templates_empty.png" alt="Templates empty">
            <figcaption>Templates page showing empty due to API failure</figcaption>
        </figure>
        <div class="observations">
            <strong>Result:</strong> FAILED - The Templates API is returning 500 errors. No templates can be loaded or displayed.
        </div>
    </div>

    <div class="test-scenario">
        <h3>
            <span class="status-badge status-pass">PASS</span>
            Scenario 3: Attempt to Add Template
        </h3>
        <p><strong>Description:</strong> Verify the "Add Template" button behavior</p>
        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Clicked the "Add Template" button</li>
                <li>System displayed message: "You must save an existing page as a template prior to create a new template."</li>
            </ol>
        </div>
        <figure class="screenshot">
            <img src="Template Drag and Drop_step04_no_templates_message.png" alt="No templates message">
            <figcaption>Message indicating no templates exist and pages need to be saved as templates first</figcaption>
        </figure>
        <div class="observations">
            <strong>Result:</strong> PASS - The UI correctly indicates that no templates exist and provides guidance on how to create them.
        </div>
    </div>

    <div class="test-scenario">
        <h3>
            <span class="status-badge status-fail">FAIL</span>
            Scenario 4: Save Page as Template
        </h3>
        <p><strong>Description:</strong> Attempt to create a template by saving an existing page</p>
        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Navigated to Content > Pages</li>
                <li>Selected "Home" page</li>
                <li>Clicked "Save Page Template" dropdown</li>
                <li>Selected "Evoq Page Template"</li>
                <li>Entered template name: "Home Template"</li>
                <li>Clicked "Save" button</li>
            </ol>
        </div>
        <div class="error-details">
            <h4>Error Encountered:</h4>
            <p><strong>HTTP 500 Internal Server Error</strong> when attempting to save the template</p>
            <p>The save operation failed silently and redirected back to the empty Templates page with the same error banner.</p>
        </div>
        <figure class="screenshot">
            <img src="Template Drag and Drop_step05_save_template_error.png" alt="Save template error">
            <figcaption>Error after attempting to save a page as template</figcaption>
        </figure>
        <div class="observations">
            <strong>Result:</strong> FAILED - Cannot create templates due to server-side API errors.
        </div>
    </div>

    <div class="test-scenario">
        <h3>
            <span class="status-badge status-blocked">BLOCKED</span>
            Scenario 5-10: Drag and Drop Tests
        </h3>
        <p><strong>Description:</strong> All drag and drop test scenarios are blocked due to the inability to load or create templates.</p>

        <table>
            <thead>
                <tr>
                    <th>Test Scenario</th>
                    <th>Status</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Drag template to new position</td>
                    <td><span class="status-badge status-blocked">BLOCKED</span></td>
                    <td>No templates available to drag</td>
                </tr>
                <tr>
                    <td>Drop template on another template</td>
                    <td><span class="status-badge status-blocked">BLOCKED</span></td>
                    <td>No templates available</td>
                </tr>
                <tr>
                    <td>Cancel drag operation</td>
                    <td><span class="status-badge status-blocked">BLOCKED</span></td>
                    <td>No templates available to initiate drag</td>
                </tr>
                <tr>
                    <td>Verify drag disabled during search</td>
                    <td><span class="status-badge status-blocked">BLOCKED</span></td>
                    <td>No templates to verify drag handle visibility</td>
                </tr>
                <tr>
                    <td>Test drag visual feedback</td>
                    <td><span class="status-badge status-blocked">BLOCKED</span></td>
                    <td>Cannot initiate drag operation</td>
                </tr>
                <tr>
                    <td>Verify hierarchy updates after drop</td>
                    <td><span class="status-badge status-blocked">BLOCKED</span></td>
                    <td>No hierarchy to test</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-scenario">
        <h3>Code Review Findings</h3>
        <div class="code-review">
            <h4>Relevant Files Examined:</h4>
            <ul>
                <li><code>admin/personaBar/scripts/templatesHierarchy.js</code></li>
                <li><code>admin/personaBar/Templates.html</code></li>
            </ul>

            <h4>Key Implementation Details:</h4>
            <ul>
                <li><strong>Drag Handle:</strong> <code>span.drag-area</code> element on template items triggers drag functionality</li>
                <li><strong>Drag Disabled During Search:</strong> The drag handle is only visible when <code>searchKeyword() == ''</code> (line 93 in Templates.html)</li>
                <li><strong>Visual Feedback:</strong> Creates <code>page-drag-helper</code> element during drag, shows <code>page-drag-target</code> placeholder</li>
                <li><strong>Drop Targets:</strong> Items get <code>item-can-be-parent-list</code> class when hovering with dragged item</li>
                <li><strong>API Endpoint:</strong> Uses <code>MovePage</code> API with actions: parent/before/after</li>
                <li><strong>UI Framework:</strong> Uses jQuery UI <code>sortable</code> and <code>droppable</code> for drag functionality</li>
            </ul>

            <h4>Note:</h4>
            <p>The front-end code appears to be properly implemented. The issue is with the back-end API endpoints returning 500 errors.</p>
        </div>
    </div>

    <div class="summary-box">
        <h2>Recommendations</h2>
        <ol>
            <li><strong>Investigate Server Errors:</strong> Check the DNN event logs and server logs to identify the root cause of the 500 Internal Server Errors on the Templates API endpoints.</li>
            <li><strong>Verify Database:</strong> Ensure the templates database tables exist and have proper permissions.</li>
            <li><strong>Check Module Installation:</strong> Verify the Evoq.PersonaBar.Templates module is properly installed and all dependencies are met.</li>
            <li><strong>Re-test After Fix:</strong> Once the server issues are resolved, re-execute all blocked test scenarios to validate the drag and drop functionality.</li>
        </ol>
    </div>

    <div class="summary-box">
        <h2>Environment Information</h2>
        <table>
            <tr>
                <th>Website URL</th>
                <td>http://localhost:8081</td>
            </tr>
            <tr>
                <th>Test User</th>
                <td>host (SuperUser)</td>
            </tr>
            <tr>
                <th>Browser</th>
                <td>Chromium (Playwright MCP)</td>
            </tr>
            <tr>
                <th>Viewport</th>
                <td>1920x1080</td>
            </tr>
            <tr>
                <th>Repository</th>
                <td>Dnn.AdminExperience.Evoq.Basic</td>
            </tr>
        </table>
    </div>

    <div class="footer">
        <p>Test Report Generated: December 30, 2025</p>
        <p>Evoq.PersonaBar.Templates - Template Drag and Drop Feature Testing</p>
    </div>
</body>
</html>
