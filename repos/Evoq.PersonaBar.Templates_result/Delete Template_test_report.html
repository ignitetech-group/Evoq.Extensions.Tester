<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Template - Test Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
        }
        h3 {
            color: #555;
        }
        .feature-info {
            background-color: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin-bottom: 20px;
        }
        .test-case {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 14px;
        }
        .status-pass {
            background-color: #d4edda;
            color: #155724;
        }
        .status-fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .issue {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
        }
        .observations {
            background-color: #e2e3e5;
            border-left: 4px solid #6c757d;
            padding: 15px;
            margin-top: 30px;
        }
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .summary-table th, .summary-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .summary-table th {
            background-color: #0066cc;
            color: white;
        }
        .summary-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>Delete Template - Test Report</h1>

    <div class="feature-info">
        <h3>Feature Information</h3>
        <p><strong>Extension:</strong> Evoq.PersonaBar.Templates (PersonaBar Module)</p>
        <p><strong>Feature Name:</strong> Delete Template</p>
        <p><strong>Description:</strong> Delete templates from the system with confirmation dialog, except default templates</p>
        <p><strong>Feature Priority:</strong> High</p>
        <p><strong>UI Location:</strong> Admin &gt; Manage &gt; Templates &gt; Template Item &gt; Delete button</p>
        <p><strong>Relevant Files:</strong> Services/TemplatesController.cs, admin/personaBar/scripts/templatesHierarchy.js</p>
        <p><strong>Test Date:</strong> 2026-01-06</p>
    </div>

    <h2>Test Summary</h2>
    <table class="summary-table">
        <tr>
            <th>Test Scenario</th>
            <th>Status</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td>Delete non-default template</td>
            <td><span class="status status-fail">FAIL</span></td>
            <td>API Error - Templates cannot be loaded</td>
        </tr>
        <tr>
            <td>Confirm deletion dialog appears</td>
            <td><span class="status status-fail">FAIL</span></td>
            <td>API Error - Templates cannot be loaded</td>
        </tr>
        <tr>
            <td>Cancel deletion</td>
            <td><span class="status status-fail">FAIL</span></td>
            <td>API Error - Templates cannot be loaded</td>
        </tr>
        <tr>
            <td>Verify default template cannot be deleted</td>
            <td><span class="status status-fail">FAIL</span></td>
            <td>API Error - Templates cannot be loaded</td>
        </tr>
        <tr>
            <td>Verify template with default skin cannot be deleted</td>
            <td><span class="status status-fail">FAIL</span></td>
            <td>API Error - Templates cannot be loaded</td>
        </tr>
        <tr>
            <td>Update list after successful deletion</td>
            <td><span class="status status-fail">FAIL</span></td>
            <td>API Error - Templates cannot be loaded</td>
        </tr>
    </table>

    <h2>Test Cases</h2>

    <!-- Test Case 1: Delete non-default template -->
    <div class="test-case">
        <h3>Test 1: Delete non-default template</h3>
        <span class="status status-fail">FAIL</span>

        <div class="steps">
            <strong>Steps taken:</strong>
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Navigated to Manage &gt; Templates via PersonaBar</li>
                <li>Attempted to load template list</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> The GetPageTemplates API endpoint returns HTTP 500 Internal Server Error.
            Templates cannot be loaded or displayed, making it impossible to test the delete functionality.
        </div>

        <p><strong>Screenshot - Login Confirmed:</strong></p>
        <img src="Delete Template_step00_login_confirmed.png" alt="Login confirmed" class="screenshot">

        <p><strong>Screenshot - Templates API Error:</strong></p>
        <img src="Delete Template_step02_templates_api_error.png" alt="Templates API Error" class="screenshot">
    </div>

    <!-- Test Case 2: Confirm deletion dialog appears -->
    <div class="test-case">
        <h3>Test 2: Confirm deletion dialog appears</h3>
        <span class="status status-fail">FAIL</span>

        <div class="steps">
            <strong>Expected behavior (from code review):</strong>
            <ol>
                <li>Click delete button on a template</li>
                <li>Confirmation dialog should appear with message "Are you sure you want to delete [TEMPLATE_NAME]?"</li>
                <li>Dialog shows "Delete" and "Cancel" buttons</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> Cannot test this scenario because templates fail to load due to API errors.
            The code in templatesHierarchy.js shows the confirmation dialog is implemented via <code>this.utility.confirm()</code> function.
        </div>
    </div>

    <!-- Test Case 3: Cancel deletion -->
    <div class="test-case">
        <h3>Test 3: Cancel deletion</h3>
        <span class="status status-fail">FAIL</span>

        <div class="steps">
            <strong>Expected behavior (from code review):</strong>
            <ol>
                <li>Click delete button on a template</li>
                <li>Confirmation dialog appears</li>
                <li>Click "Cancel" button</li>
                <li>Dialog closes, template remains in list</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> Cannot test this scenario because templates fail to load due to API errors.
        </div>
    </div>

    <!-- Test Case 4: Verify default template cannot be deleted -->
    <div class="test-case">
        <h3>Test 4: Verify default template cannot be deleted</h3>
        <span class="status status-fail">FAIL</span>

        <div class="steps">
            <strong>Expected behavior (from code review):</strong>
            <ol>
                <li>Identify a template with default skin</li>
                <li>Attempt to delete it</li>
                <li>Server should return HTTP 422 error with message "PageTemplate_Cannot_Delete_Default_Template"</li>
                <li>Template should remain in the list</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> Cannot test this scenario because templates fail to load due to API errors.
            The code in TemplatesController.cs shows protection logic:
            <code>if (_pageTemplatesController.IsTemplatePage(tab) && UseDefaultSkin(tab))</code> returns error.
        </div>
    </div>

    <!-- Test Case 5: Verify template with default skin cannot be deleted -->
    <div class="test-case">
        <h3>Test 5: Verify template with default skin cannot be deleted</h3>
        <span class="status status-fail">FAIL</span>

        <div class="steps">
            <strong>Expected behavior (from code review):</strong>
            <ol>
                <li>Templates using the portal's default skin should be protected</li>
                <li>The <code>UseDefaultSkin()</code> method checks if tab.SkinSrc equals PortalSettings.DefaultPortalSkin</li>
                <li>Delete attempt should show error notification</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> Cannot test this scenario because templates fail to load due to API errors.
        </div>
    </div>

    <!-- Test Case 6: Update list after successful deletion -->
    <div class="test-case">
        <h3>Test 6: Update list after successful deletion</h3>
        <span class="status status-fail">FAIL</span>

        <div class="steps">
            <strong>Expected behavior (from code review):</strong>
            <ol>
                <li>Successfully delete a non-default template</li>
                <li>The <code>_updatePageData()</code> function removes the deleted template from the UI</li>
                <li>List should refresh without the deleted template</li>
                <li>If current page was the deleted template, redirect to home</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> Cannot test this scenario because templates fail to load due to API errors.
        </div>
    </div>

    <div class="observations">
        <h2>Observations</h2>
        <ul>
            <li><strong>Critical API Issue:</strong> The GetPageTemplates API endpoint at <code>/API/PersonaBar/Templates/GetPageTemplates</code> returns HTTP 500 Internal Server Error consistently. This prevents all template-related functionality from working.</li>
            <li><strong>Navigation Works:</strong> The Templates feature is accessible via Manage &gt; Templates menu in the PersonaBar.</li>
            <li><strong>UI Components Present:</strong> The Page Templates UI shows a search box and "Add Template" button, confirming the module is loaded.</li>
            <li><strong>Error Handling:</strong> The system displays a user-friendly error message: "There was an error retrieving your content. Please check your internet connection."</li>
            <li><strong>Code Analysis:</strong> Based on code review of TemplatesController.cs and templatesHierarchy.js:
                <ul>
                    <li>Delete functionality uses <code>_deletePageClickHandler()</code> which shows confirmation dialog</li>
                    <li>DeletePage API performs soft delete via <code>TabController.Instance.SoftDeleteTab()</code></li>
                    <li>Protection exists for templates using default portal skin (returns HTTP 422)</li>
                    <li>UI updates list after successful deletion via <code>_updatePageData()</code></li>
                </ul>
            </li>
            <li><strong>Save Template Issue:</strong> Attempted to create a test template via Pages &gt; Save Page Template &gt; Evoq Page Template, but this also resulted in HTTP 400 Bad Request error.</li>
        </ul>

        <h3>Recommended Actions</h3>
        <ol>
            <li>Investigate server logs for the 500 error on GetPageTemplates endpoint</li>
            <li>Check database connectivity and template table integrity</li>
            <li>Verify that the Templates module is properly installed and licensed</li>
            <li>Re-test after resolving the API issues</li>
        </ol>
    </div>

</body>
</html>
