<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Search - Test Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0078d4;
            padding-bottom: 10px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
        }
        h3 {
            color: #555;
        }
        .feature-info {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-case {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-left: 4px solid #dc3545;
        }
        .test-case.pass {
            border-left-color: #28a745;
        }
        .test-case.fail {
            border-left-color: #dc3545;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 14px;
        }
        .status.pass {
            background-color: #28a745;
            color: white;
        }
        .status.fail {
            background-color: #dc3545;
            color: white;
        }
        .steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .screenshot {
            margin: 15px 0;
            text-align: center;
        }
        .screenshot img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .screenshot-caption {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }
        .issues {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        .observations {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #0078d4;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .summary-table {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>Template Search - Test Report</h1>

    <div class="feature-info">
        <h2>Feature Information</h2>
        <table>
            <tr>
                <th>Feature Name</th>
                <td>Template Search</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>Search templates by name or localized name using keyword search</td>
            </tr>
            <tr>
                <th>Extension</th>
                <td>Evoq.PersonaBar.Templates</td>
            </tr>
            <tr>
                <th>Priority</th>
                <td>High</td>
            </tr>
            <tr>
                <th>UI Location</th>
                <td>Admin > Manage > Templates > Search box</td>
            </tr>
            <tr>
                <th>Relevant Files</th>
                <td>
                    <code>Services/TemplatesController.cs</code><br>
                    <code>admin/personaBar/Templates.html</code><br>
                    <code>admin/personaBar/scripts/templatesHierarchy.js</code>
                </td>
            </tr>
            <tr>
                <th>Test Date</th>
                <td>January 6, 2026</td>
            </tr>
            <tr>
                <th>Tester</th>
                <td>Automated Test (Claude)</td>
            </tr>
        </table>
    </div>

    <h2>Test Summary</h2>
    <div class="summary-table">
        <table>
            <thead>
                <tr>
                    <th>Test Scenario</th>
                    <th>Status</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Search by template name</td>
                    <td><span class="status fail">FAIL</span></td>
                    <td>Backend API returns 500 Internal Server Error</td>
                </tr>
                <tr>
                    <td>Search by partial name</td>
                    <td><span class="status fail">FAIL</span></td>
                    <td>Backend API returns 500 Internal Server Error</td>
                </tr>
                <tr>
                    <td>Search with no results</td>
                    <td><span class="status fail">FAIL</span></td>
                    <td>Backend API returns 500 Internal Server Error</td>
                </tr>
                <tr>
                    <td>Clear search to show all templates</td>
                    <td><span class="status fail">FAIL</span></td>
                    <td>Backend API returns 500 Internal Server Error</td>
                </tr>
                <tr>
                    <td>Search is case-insensitive</td>
                    <td><span class="status fail">FAIL</span></td>
                    <td>Backend API returns 500 Internal Server Error</td>
                </tr>
                <tr>
                    <td>Real-time search as user types</td>
                    <td><span class="status fail">FAIL</span></td>
                    <td>Backend API returns 500 Internal Server Error</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2>Test Details</h2>

    <div class="test-case fail">
        <h3>Test 1: Search by Template Name</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Steps Taken:</h4>
        <div class="steps">
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Navigated to Manage > Templates</li>
                <li>Attempted to view templates list</li>
                <li>Typed "test" in the search box</li>
            </ol>
        </div>

        <h4>Expected Result:</h4>
        <p>Templates matching the search term should be displayed</p>

        <h4>Actual Result:</h4>
        <p>The GetPageTemplates API returns HTTP 500 Internal Server Error. No templates are displayed. Error message: "There was an error retrieving your content. Please check your internet connection."</p>

        <div class="issues">
            <strong>Issues Found:</strong>
            <ul>
                <li>API endpoint <code>/API/personaBar/Templates/GetPageTemplates</code> returns 500 error</li>
                <li>Search functionality cannot be tested due to backend failure</li>
            </ul>
        </div>

        <div class="screenshot">
            <img src="Template_Search_step01_templates_page_error.png" alt="Templates page with error">
            <p class="screenshot-caption">Templates page showing server error when loading</p>
        </div>

        <div class="screenshot">
            <img src="Template_Search_step02_search_attempt_error.png" alt="Search attempt with error">
            <p class="screenshot-caption">Search attempt showing "test" typed but server error persists</p>
        </div>
    </div>

    <div class="test-case fail">
        <h3>Test 2: Search by Partial Name</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Expected Result:</h4>
        <p>Partial name search should match templates containing the search term</p>

        <h4>Actual Result:</h4>
        <p>Cannot test - GetPageTemplates API consistently returns 500 error</p>
    </div>

    <div class="test-case fail">
        <h3>Test 3: Search with No Results</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Expected Result:</h4>
        <p>Searching for non-existent template should show empty result or "no results" message</p>

        <h4>Actual Result:</h4>
        <p>Cannot test - GetPageTemplates API consistently returns 500 error</p>
    </div>

    <div class="test-case fail">
        <h3>Test 4: Clear Search to Show All Templates</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Expected Result:</h4>
        <p>Clearing the search box should show all available templates</p>

        <h4>Actual Result:</h4>
        <p>Cannot test - GetPageTemplates API consistently returns 500 error. Additionally, clicking "Add Template" shows message: "You must save an existing page as a template prior to create a new template" indicating no templates exist in the system.</p>

        <div class="screenshot">
            <img src="Template_Search_step03_no_templates_exist.png" alt="No templates exist message">
            <p class="screenshot-caption">Message indicating no templates exist in the system</p>
        </div>
    </div>

    <div class="test-case fail">
        <h3>Test 5: Search is Case-Insensitive</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Code Analysis:</h4>
        <p>Based on code review, the search should be case-insensitive. In <code>TemplatesController.cs</code> line 319-320:</p>
        <pre><code>where string.IsNullOrEmpty(searchKey) ||
    (t.TabName.IndexOf(searchKey, StringComparison.InvariantCultureIgnoreCase) > Null.NullInteger
    || t.LocalizedTabName.IndexOf(searchKey, StringComparison.InvariantCultureIgnoreCase) > Null.NullInteger)</code></pre>

        <h4>Actual Result:</h4>
        <p>Cannot verify through UI testing - GetPageTemplates API consistently returns 500 error</p>
    </div>

    <div class="test-case fail">
        <h3>Test 6: Real-time Search as User Types</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Code Analysis:</h4>
        <p>Based on code review in <code>templatesHierarchy.js</code>, the search implements debounce with 500ms delay:</p>
        <pre><code>_searchKeywordsChangedHandler: function (e) {
    if (this._doSearchTimeoutHandler) {
        clearTimeout(this._doSearchTimeoutHandler);
    }
    this._doSearchTimeoutHandler = setTimeout(function () {
        handler._searchPage();
    }, this.options.delayTime); // delayTime: 500
}</code></pre>

        <h4>Expected Result:</h4>
        <p>Search should filter templates in real-time with 500ms debounce as user types</p>

        <h4>Actual Result:</h4>
        <p>Typing in search box triggers API calls, but all calls return 500 error. Real-time functionality cannot be verified.</p>
    </div>

    <h2>Additional Testing Attempt</h2>

    <div class="test-case fail">
        <h3>Attempt to Create Template</h3>
        <p><span class="status fail">FAIL</span></p>

        <h4>Steps Taken:</h4>
        <div class="steps">
            <ol>
                <li>Navigated to Content > Pages</li>
                <li>Selected Home page</li>
                <li>Clicked "Save Page Template" dropdown</li>
                <li>Selected "Evoq Page Template"</li>
                <li>Entered template name: "Home Template"</li>
                <li>Entered description: "A template based on the home page"</li>
                <li>Clicked Save</li>
            </ol>
        </div>

        <h4>Actual Result:</h4>
        <p>Save operation failed with HTTP 400 Bad Request error. Template was not created.</p>

        <div class="screenshot">
            <img src="Template_Search_step04_save_template_attempt.png" alt="Save template attempt">
            <p class="screenshot-caption">Attempting to save page as template</p>
        </div>
    </div>

    <div class="observations">
        <h2>Observations</h2>
        <ul>
            <li><strong>UI Elements Present:</strong> The Templates page UI loads correctly with the search box, "Add Template" button, and page list panel.</li>
            <li><strong>Backend Issue:</strong> The <code>GetPageTemplates</code> API endpoint consistently returns HTTP 500 Internal Server Error, preventing any template listing or search functionality.</li>
            <li><strong>No Existing Templates:</strong> The system has no existing page templates. Clicking "Add Template" displays: "You must save an existing page as a template prior to create a new template."</li>
            <li><strong>Template Creation Blocked:</strong> Attempting to save a page as template via Pages panel fails with HTTP 400 Bad Request.</li>
            <li><strong>Code Analysis Confirms Design:</strong> Review of source code confirms:
                <ul>
                    <li>Search is designed to be case-insensitive using <code>StringComparison.InvariantCultureIgnoreCase</code></li>
                    <li>Search filters by both <code>TabName</code> and <code>LocalizedTabName</code></li>
                    <li>Real-time search is implemented with 500ms debounce</li>
                    <li>Search is performed client-side by calling <code>_loadPageTemplates()</code> which calls the API</li>
                </ul>
            </li>
            <li><strong>Recommendation:</strong> Backend configuration or database setup issue needs to be resolved before Template Search feature can be tested. The API endpoints for Templates functionality are not working properly on this test environment.</li>
        </ul>
    </div>

    <h2>Environment Information</h2>
    <div class="feature-info">
        <table>
            <tr>
                <th>Website URL</th>
                <td>http://localhost:8081</td>
            </tr>
            <tr>
                <th>Test Account</th>
                <td>SuperUser (host)</td>
            </tr>
            <tr>
                <th>Browser</th>
                <td>Playwright MCP (Chromium)</td>
            </tr>
            <tr>
                <th>Viewport</th>
                <td>1280x720</td>
            </tr>
        </table>
    </div>

    <div class="screenshot">
        <img src="Template_Search_step00_login_confirmed.png" alt="Login confirmed">
        <p class="screenshot-caption">Login successful - Setup screenshot</p>
    </div>

</body>
</html>
