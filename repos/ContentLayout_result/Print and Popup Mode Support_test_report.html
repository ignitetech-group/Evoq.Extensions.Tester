<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Print and Popup Mode Support - ContentLayout</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        h3 {
            color: #7f8c8d;
        }
        .feature-info {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .feature-info table {
            width: 100%;
            border-collapse: collapse;
        }
        .feature-info td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .feature-info td:first-child {
            font-weight: bold;
            width: 200px;
            color: #555;
        }
        .test-scenario {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .status.pass {
            background-color: #27ae60;
            color: white;
        }
        .status.fail {
            background-color: #e74c3c;
            color: white;
        }
        .status.partial {
            background-color: #f39c12;
            color: white;
        }
        .screenshot {
            margin: 15px 0;
            text-align: center;
        }
        .screenshot img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .screenshot-caption {
            font-style: italic;
            color: #666;
            margin-top: 8px;
        }
        .steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .steps li {
            margin-bottom: 8px;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .observations {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .summary {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .summary.fail {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Test Report: Print and Popup Mode Support</h1>

    <div class="feature-info">
        <h2>Feature Information</h2>
        <table>
            <tr><td>Extension</td><td>ContentLayout (Module)</td></tr>
            <tr><td>Repository</td><td>Dnn.Evoq.Basic</td></tr>
            <tr><td>Feature Name</td><td>Print and Popup Mode Support</td></tr>
            <tr><td>Feature Priority</td><td>Low</td></tr>
            <tr><td>Description</td><td>Handles special rendering modes for print view and popup windows.</td></tr>
            <tr><td>UI Location</td><td>Page Print View / Popup Windows</td></tr>
            <tr><td>Relevant Files</td><td>Evoq Content/Modules/ContentLayout/View.ascx.cs</td></tr>
            <tr><td>Dependencies</td><td>DNN Page Modes</td></tr>
            <tr><td>Test Date</td><td>December 30, 2025</td></tr>
        </table>
    </div>

    <div class="feature-info">
        <h2>Code Analysis</h2>
        <p>The feature is implemented in <code>View.ascx.cs</code> through the following key mechanisms:</p>

        <h3>IsSpecialPageMode Property (lines 78-84)</h3>
        <div class="code-block">
private bool IsSpecialPageMode
{
    get
    {
        return Request.QueryString["dnnprintmode"] == "true" || Request.QueryString["popUp"] == "true";
    }
}
        </div>
        <p>This property detects when the page is in print mode (<code>?dnnprintmode=true</code>) or popup mode (<code>?popUp=true</code>).</p>

        <h3>RegisterResources Method (lines 247-262)</h3>
        <div class="code-block">
private void RegisterResources()
{
    if (InEditMode && !IsSpecialPageMode && TabPermissionController.CanAddContentToPage())
    {
        ClientResourceManager.EnableAsyncPostBackHandler();
        ClientResourceManager.RegisterScript(Page, Path.Combine(ControlPath, "ClientScripts/LayoutEditor.js"));
        ClientResourceManager.RegisterStyleSheet(Page, Path.Combine(ControlPath, "Css/LayoutEditor.css"), Constants.CssFileOrder);
    }

    if (InEditMode && !IsSpecialPageMode && CanEdit && !_moduleController.IsSharedModule(ModuleConfiguration))
    {
        EditorScript.Visible = true;
    }
    // ...
}
        </div>
        <p>This ensures that Layout Editor scripts and styles are NOT loaded in special modes, and the Editor Script is hidden.</p>
    </div>

    <!-- Test Scenario 1: Print Mode Rendering -->
    <div class="test-scenario">
        <h2>Test Scenario 1: Print Mode Rendering</h2>
        <span class="status pass">PASS</span>

        <h3>Objective</h3>
        <p>Verify that print mode renders the page correctly with edit controls hidden.</p>

        <h3>Steps Taken</h3>
        <div class="steps">
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Navigated to homepage in normal edit mode</li>
                <li>Added <code>?dnnprintmode=true</code> query parameter to URL</li>
                <li>Verified page renders without admin sidebar</li>
            </ol>
        </div>

        <h3>Screenshots</h3>
        <div class="screenshot">
            <img src="Print and Popup Mode Support_step03_print_mode.png" alt="Print Mode Viewport">
            <p class="screenshot-caption">Print mode - viewport showing no admin sidebar, content rendered normally</p>
        </div>
        <div class="screenshot">
            <img src="Print and Popup Mode Support_step06_print_mode_full.png" alt="Print Mode Full Page">
            <p class="screenshot-caption">Print mode - full page showing complete layout preservation</p>
        </div>

        <h3>Results</h3>
        <ul>
            <li>Admin sidebar (Dashboard, Pages, Manage, Settings icons) is NOT visible</li>
            <li>Site navigation remains visible (appropriate for print)</li>
            <li>Page content renders correctly</li>
            <li>No Layout Editor controls visible</li>
        </ul>
    </div>

    <!-- Test Scenario 2: Popup Mode Rendering -->
    <div class="test-scenario">
        <h2>Test Scenario 2: Popup Mode Rendering</h2>
        <span class="status pass">PASS</span>

        <h3>Objective</h3>
        <p>Verify that popup mode renders the page correctly for embedded/popup window display.</p>

        <h3>Steps Taken</h3>
        <div class="steps">
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Added <code>?popUp=true</code> query parameter to URL</li>
                <li>Verified page renders in popup-friendly format</li>
            </ol>
        </div>

        <h3>Screenshots</h3>
        <div class="screenshot">
            <img src="Print and Popup Mode Support_step04_popup_mode.png" alt="Popup Mode Viewport">
            <p class="screenshot-caption">Popup mode - viewport showing simplified layout without site navigation</p>
        </div>
        <div class="screenshot">
            <img src="Print and Popup Mode Support_step05_popup_mode_full.png" alt="Popup Mode Full Page">
            <p class="screenshot-caption">Popup mode - full page showing content with module action icons</p>
        </div>

        <h3>Results</h3>
        <ul>
            <li>Admin sidebar (Dashboard, Pages, Manage, Settings icons) is NOT visible</li>
            <li>Site header/navigation is hidden (typical popup behavior)</li>
            <li>Content is rendered in popup-friendly format</li>
            <li>Module action icons remain visible (for popup editing scenarios)</li>
        </ul>

        <div class="observations">
            <strong>Observation:</strong> In popup mode, module-level action menus (Admin, Move, Edit) are still visible. This appears to be intentional behavior for scenarios where popup windows may still need some editing capability.
        </div>
    </div>

    <!-- Test Scenario 3: Edit Controls Hidden -->
    <div class="test-scenario">
        <h2>Test Scenario 3: Verify Edit Controls Hidden in Special Modes</h2>
        <span class="status pass">PASS</span>

        <h3>Objective</h3>
        <p>Compare normal edit mode with special modes to verify Layout Editor controls are hidden.</p>

        <h3>Comparison</h3>
        <div class="screenshot">
            <img src="Print and Popup Mode Support_step02_edit_mode.png" alt="Normal Edit Mode">
            <p class="screenshot-caption">NORMAL EDIT MODE - Shows admin sidebar with Dashboard, Pages, Manage, Page Analytics, Settings icons on the left</p>
        </div>

        <h3>Results</h3>
        <table style="width:100%; border-collapse: collapse; margin: 15px 0;">
            <tr style="background: #f8f9fa;">
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Component</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Normal Edit Mode</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Print Mode</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Popup Mode</th>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Admin Sidebar (Dashboard, Pages, etc.)</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: green;">Visible</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: red;">Hidden</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: red;">Hidden</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Layout Editor Scripts (LayoutEditor.js)</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: green;">Loaded</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: red;">Not Loaded</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: red;">Not Loaded</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Site Navigation</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: green;">Visible</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: green;">Visible</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: red;">Hidden</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Module Action Menus</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: green;">Visible</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: red;">Hidden</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; color: green;">Visible</td>
            </tr>
        </table>
    </div>

    <!-- Test Scenario 4: Layout Preservation -->
    <div class="test-scenario">
        <h2>Test Scenario 4: Test Layout Preservation in Print View</h2>
        <span class="status pass">PASS</span>

        <h3>Objective</h3>
        <p>Verify that the ContentLayout module preserves the multi-column layout in print view.</p>

        <h3>Steps Taken</h3>
        <div class="steps">
            <ol>
                <li>Navigated to homepage with ContentLayout modules</li>
                <li>Enabled print mode with <code>?dnnprintmode=true</code></li>
                <li>Captured full-page screenshot to verify layout preservation</li>
                <li>Verified all layout columns and content sections render correctly</li>
            </ol>
        </div>

        <h3>Layout Elements Verified</h3>
        <ul>
            <li><strong>Hero Section:</strong> "The World's Finest AV Products" with TV image - Preserved</li>
            <li><strong>Top Row Products:</strong> WEARABLES, TELEVISIONS, TABLETS, LAPTOPS - Preserved</li>
            <li><strong>Bottom Row Products:</strong> HOME THEATERS, BLU-RAY PLAYERS, MONITORS, CAMERAS - Preserved</li>
            <li><strong>Welcome Paragraph:</strong> Cavalier Electronics description - Preserved</li>
            <li><strong>Additional Modules:</strong> Groups, Token Test, User Status widgets - Preserved</li>
        </ul>

        <h3>Results</h3>
        <p>All ContentLayout sections and multi-column layouts are correctly preserved in print mode. The grid layout with product categories displays properly, and all images and text content render as expected.</p>
    </div>

    <!-- Summary -->
    <div class="summary">
        <h2>Test Summary</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <th style="text-align: left; padding: 10px; border-bottom: 2px solid #28a745;">Test Scenario</th>
                <th style="text-align: center; padding: 10px; border-bottom: 2px solid #28a745;">Status</th>
            </tr>
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">Print mode rendering</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: center;"><span class="status pass">PASS</span></td>
            </tr>
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">Popup mode rendering</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: center;"><span class="status pass">PASS</span></td>
            </tr>
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">Edit controls hidden in special modes</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: center;"><span class="status pass">PASS</span></td>
            </tr>
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">Layout preservation in print view</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: center;"><span class="status pass">PASS</span></td>
            </tr>
        </table>

        <h3>Overall Result: <span style="color: #28a745;">ALL TESTS PASSED</span></h3>

        <h3>Conclusion</h3>
        <p>The Print and Popup Mode Support feature in ContentLayout is functioning correctly. The <code>IsSpecialPageMode</code> property properly detects both <code>?dnnprintmode=true</code> and <code>?popUp=true</code> query parameters, and the <code>RegisterResources()</code> method correctly prevents Layout Editor scripts from loading in these modes. Content layouts are preserved and display correctly for both print and popup scenarios.</p>
    </div>
</body>
</html>
