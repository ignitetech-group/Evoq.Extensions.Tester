<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Endpoints Test Report - ContentLayout</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }
        h2 {
            color: #0066cc;
            margin-top: 30px;
        }
        h3 {
            color: #444;
        }
        .feature-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-scenario {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-left: 4px solid #0066cc;
        }
        .test-scenario.pass {
            border-left-color: #28a745;
        }
        .test-scenario.fail {
            border-left-color: #dc3545;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
        }
        .status.pass {
            background-color: #28a745;
        }
        .status.fail {
            background-color: #dc3545;
        }
        .steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .summary h2 {
            color: white;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .observations {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 4px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>ContentLayout - API Endpoints Test Report</h1>

    <div class="summary">
        <h2>Test Summary</h2>
        <table style="color: white;">
            <tr>
                <td><strong>Feature:</strong></td>
                <td>API Endpoints</td>
            </tr>
            <tr>
                <td><strong>Extension:</strong></td>
                <td>ContentLayout (Module)</td>
            </tr>
            <tr>
                <td><strong>Priority:</strong></td>
                <td>High</td>
            </tr>
            <tr>
                <td><strong>Test Date:</strong></td>
                <td>January 6, 2026</td>
            </tr>
            <tr>
                <td><strong>Total Tests:</strong></td>
                <td>6</td>
            </tr>
            <tr>
                <td><strong>Passed:</strong></td>
                <td>6</td>
            </tr>
            <tr>
                <td><strong>Failed:</strong></td>
                <td>0</td>
            </tr>
        </table>
    </div>

    <div class="feature-info">
        <h2>Feature Information</h2>
        <p><strong>Description:</strong> RESTful API endpoints for managing content layouts programmatically.</p>
        <p><strong>UI Location:</strong> API: /DesktopModules/DnnCorp/ContentLayout/API/Service/</p>
        <p><strong>Relevant Files:</strong></p>
        <ul>
            <li>Evoq Content/Modules/ContentLayout/Services/ServiceController.cs</li>
            <li>Evoq Content/Modules/ContentLayout/Services/ServiceRouteMapper.cs</li>
            <li>Evoq Content/Modules/ContentLayout/Services/Attributes/ContentLayoutExceptionFilterAttribute.cs</li>
        </ul>
        <h3>API Endpoints</h3>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Description</th>
                <th>Authorization</th>
            </tr>
            <tr>
                <td>GET</td>
                <td><code>GetContentLayoutTemplates</code></td>
                <td>Returns available layout templates</td>
                <td>DnnAuthorize, DnnPageEditor</td>
            </tr>
            <tr>
                <td>POST</td>
                <td><code>UpdateLayoutWithColumnSizes</code></td>
                <td>Updates layout with custom column sizes</td>
                <td>DnnModuleAuthorize (Edit), ValidateAntiForgeryToken</td>
            </tr>
            <tr>
                <td>POST</td>
                <td><code>UpdateLayoutFromTemplate</code></td>
                <td>Updates layout using a predefined template</td>
                <td>DnnModuleAuthorize (Edit), ValidateAntiForgeryToken</td>
            </tr>
        </table>
    </div>

    <!-- Test 1: GET Content Layout Templates -->
    <div class="test-scenario pass">
        <h2>Test 1: GET Content Layout Templates</h2>
        <span class="status pass">PASS</span>

        <h3>What was tested</h3>
        <p>Verify that the GET GetContentLayoutTemplates endpoint returns a list of available layout templates.</p>

        <h3>Steps taken</h3>
        <div class="steps">
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Made GET request to <code>/DesktopModules/DnnCorp/ContentLayout/API/Service/GetContentLayoutTemplates</code></li>
                <li>Verified response status and data structure</li>
            </ol>
        </div>

        <h3>Result</h3>
        <p><strong>Status:</strong> 200 OK</p>
        <p><strong>Response:</strong> Array of 6 layout templates with id, name, sizes, and icon properties</p>
        <pre>{
  "id": 1, "name": "25% + 75%", "sizes": "25", "icon": "..."
  "id": 2, "name": "75% + 25%", "sizes": "75", "icon": "..."
  "id": 3, "name": "50% + 50%", "sizes": "50", "icon": "..."
  "id": 4, "name": "25% + 50% + 25%", "sizes": "25,50", "icon": "..."
  "id": 5, "name": "33% + 33% + 33%", "sizes": "33,33", "icon": "..."
  "id": 6, "name": "4 X 25%", "sizes": "25,25,25", "icon": "..."
}</pre>

        <h3>Screenshot</h3>
        <img class="screenshot" src="API_Endpoints_step01_GET_templates_success.png" alt="GET templates success">
    </div>

    <!-- Test 2: POST Update Layout with Column Sizes -->
    <div class="test-scenario pass">
        <h2>Test 2: POST Update Layout with Column Sizes</h2>
        <span class="status pass">PASS</span>

        <h3>What was tested</h3>
        <p>Verify that the POST UpdateLayoutWithColumnSizes endpoint successfully updates a ContentLayout module's column configuration.</p>

        <h3>Steps taken</h3>
        <div class="steps">
            <ol>
                <li>Enabled Edit mode to access ContentLayout module (ID: 364)</li>
                <li>Retrieved anti-forgery token from page</li>
                <li>Made POST request with ModuleId, TabId headers and Sizes in body</li>
                <li>Verified successful response</li>
            </ol>
        </div>

        <h3>Result</h3>
        <p><strong>Status:</strong> 200 OK</p>
        <p><strong>Request Body:</strong> <code>{ "Sizes": "50" }</code> (50-50 two-column layout)</p>
        <p><strong>Response:</strong> <code>{}</code> (empty object indicates success)</p>

        <h3>Screenshot</h3>
        <img class="screenshot" src="API_Endpoints_step03_POST_column_sizes_success.png" alt="POST column sizes success">
    </div>

    <!-- Test 3: POST Update Layout from Template -->
    <div class="test-scenario pass">
        <h2>Test 3: POST Update Layout from Template</h2>
        <span class="status pass">PASS</span>

        <h3>What was tested</h3>
        <p>Verify that the POST UpdateLayoutFromTemplate endpoint successfully updates a ContentLayout module using a predefined template.</p>

        <h3>Steps taken</h3>
        <div class="steps">
            <ol>
                <li>Used ContentLayout module (ID: 364) in Edit mode</li>
                <li>Retrieved anti-forgery token from page</li>
                <li>Made POST request with TemplateId: 3 (50% + 50% template)</li>
                <li>Verified successful response</li>
            </ol>
        </div>

        <h3>Result</h3>
        <p><strong>Status:</strong> 200 OK</p>
        <p><strong>Request Body:</strong> <code>{ "TemplateId": 3 }</code></p>
        <p><strong>Response:</strong> <code>{}</code> (empty object indicates success)</p>

        <h3>Screenshot</h3>
        <img class="screenshot" src="API_Endpoints_step04_POST_template_success.png" alt="POST template success">
    </div>

    <!-- Test 4: Authorization Requirements -->
    <div class="test-scenario pass">
        <h2>Test 4: Authorization Requirements</h2>
        <span class="status pass">PASS</span>

        <h3>What was tested</h3>
        <p>Verify that API endpoints properly enforce authorization, rejecting requests without proper module context.</p>

        <h3>Steps taken</h3>
        <div class="steps">
            <ol>
                <li>Made POST request WITHOUT ModuleId/TabId headers</li>
                <li>Verified that the request was rejected with 401 Unauthorized</li>
            </ol>
        </div>

        <h3>Result</h3>
        <p><strong>Status:</strong> 401 Unauthorized</p>
        <p><strong>Error Message:</strong> "Authorization has been denied for this request."</p>
        <p><strong>Conclusion:</strong> DnnModuleAuthorize attribute correctly enforces module-level authorization</p>

        <h3>Screenshot</h3>
        <img class="screenshot" src="API_Endpoints_step05_security_tests.png" alt="Authorization test">
    </div>

    <!-- Test 5: Anti-Forgery Token Validation -->
    <div class="test-scenario pass">
        <h2>Test 5: Anti-Forgery Token Validation</h2>
        <span class="status pass">PASS</span>

        <h3>What was tested</h3>
        <p>Verify that POST endpoints properly validate anti-forgery tokens to prevent CSRF attacks.</p>

        <h3>Steps taken</h3>
        <div class="steps">
            <ol>
                <li>Made POST request WITHOUT RequestVerificationToken header</li>
                <li>Verified that the request was rejected</li>
            </ol>
        </div>

        <h3>Result</h3>
        <p><strong>Status:</strong> 500 Internal Server Error</p>
        <p><strong>Error Message:</strong> "RequestVerificationToken not present"</p>
        <p><strong>Conclusion:</strong> ValidateAntiForgeryToken attribute correctly enforces CSRF protection</p>

        <h3>Screenshot</h3>
        <img class="screenshot" src="API_Endpoints_step05_security_tests.png" alt="Anti-forgery token test">
    </div>

    <!-- Test 6: Error Handling and Responses -->
    <div class="test-scenario pass">
        <h2>Test 6: Error Handling and Responses</h2>
        <span class="status pass">PASS</span>

        <h3>What was tested</h3>
        <p>Verify that API endpoints return meaningful error messages for invalid input.</p>

        <h3>Steps taken</h3>
        <div class="steps">
            <ol>
                <li>Sent invalid sizes format ("invalid-format")</li>
                <li>Sent non-existent template ID (9999)</li>
                <li>Verified clear, descriptive error messages in both cases</li>
            </ol>
        </div>

        <h3>Result</h3>
        <table>
            <tr>
                <th>Test Case</th>
                <th>Input</th>
                <th>Status</th>
                <th>Error Message</th>
            </tr>
            <tr>
                <td>Invalid sizes format</td>
                <td><code>{ Sizes: "invalid-format" }</code></td>
                <td>500</td>
                <td>"The Column Sizes value 'invalid-format' is in a not valid format"</td>
            </tr>
            <tr>
                <td>Non-existent template</td>
                <td><code>{ TemplateId: 9999 }</code></td>
                <td>500</td>
                <td>"The Content Layout Template Id 9999 does not exists"</td>
            </tr>
        </table>
        <p><strong>Conclusion:</strong> ContentLayoutExceptionFilterAttribute properly handles exceptions and returns JSON error responses</p>

        <h3>Screenshot</h3>
        <img class="screenshot" src="API_Endpoints_step06_error_handling.png" alt="Error handling test">
    </div>

    <!-- Observations Section -->
    <div class="observations">
        <h2>Observations</h2>
        <ul>
            <li><strong>API Route Structure:</strong> The API uses the route pattern <code>/DesktopModules/DnnCorp/ContentLayout/API/Service/{action}</code> as defined in ServiceRouteMapper.cs</li>
            <li><strong>DTO Property Names:</strong> The LayoutWithColumnSizes DTO uses <code>Sizes</code> (not ColumnSizes) as the property name for column configuration</li>
            <li><strong>Sizes Format:</strong> Column sizes are specified as comma-separated percentages for all columns except the last one (e.g., "50" for 50-50, "25,50" for 25-50-25)</li>
            <li><strong>Module Context:</strong> POST endpoints require ModuleId and TabId headers for DnnModuleAuthorize to function correctly</li>
            <li><strong>Error Response Format:</strong> All errors are returned as JSON objects with a "Message" property, handled by ContentLayoutExceptionFilterAttribute</li>
        </ul>
    </div>

    <div class="feature-info" style="margin-top: 30px;">
        <h2>Test Environment</h2>
        <table>
            <tr><td><strong>Website URL:</strong></td><td>http://localhost:8081</td></tr>
            <tr><td><strong>Test User:</strong></td><td>host (SuperUser)</td></tr>
            <tr><td><strong>Browser:</strong></td><td>Playwright Chromium</td></tr>
            <tr><td><strong>Test Module ID:</strong></td><td>364</td></tr>
            <tr><td><strong>Test Tab ID:</strong></td><td>21</td></tr>
        </table>
    </div>

    <footer style="text-align: center; margin-top: 30px; color: #666;">
        <p>Generated by Claude Code - Evoq Extensions Tester</p>
    </footer>
</body>
</html>
