<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Details Management - Test Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0078d4;
            padding-bottom: 10px;
        }
        h2 {
            color: #0078d4;
            margin-top: 30px;
        }
        h3 {
            color: #444;
        }
        .feature-info {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .feature-info p {
            margin: 8px 0;
        }
        .test-case {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .pass {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }
        .fail {
            color: #dc3545;
            font-weight: bold;
            font-size: 1.2em;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        .status-pass {
            background-color: #28a745;
        }
        .status-fail {
            background-color: #dc3545;
        }
        img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .screenshot-container {
            margin: 15px 0;
        }
        .screenshot-caption {
            font-style: italic;
            color: #666;
            font-size: 0.9em;
        }
        .steps {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #0078d4;
            margin: 15px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .summary-table th, .summary-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .summary-table th {
            background-color: #0078d4;
            color: white;
        }
        .summary-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .observations {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>Page Details Management - Test Report</h1>

    <div class="feature-info">
        <h2>Feature Information</h2>
        <p><strong>Extension:</strong> Evoq.PersonaBar.Pages</p>
        <p><strong>Feature Name:</strong> Page Details Management</p>
        <p><strong>Description:</strong> Retrieve and save page settings including metadata, appearance, and permissions</p>
        <p><strong>UI Location:</strong> Admin > Content > Pages > Page Settings</p>
        <p><strong>Priority:</strong> Top</p>
        <p><strong>Test Date:</strong> January 6, 2026</p>
        <p><strong>Tester:</strong> Automated Testing via Claude Code</p>
    </div>

    <h2>Test Summary</h2>
    <table class="summary-table">
        <tr>
            <th>Test Scenario</th>
            <th>Status</th>
        </tr>
        <tr>
            <td>Get page details by ID</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
        <tr>
            <td>Save page details with all fields</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
        <tr>
            <td>Page type changes</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
        <tr>
            <td>Workflow assignment</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
        <tr>
            <td>Timezone/Scheduling</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
        <tr>
            <td>Edge cases - Special characters (XSS)</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
        <tr>
            <td>Disabled link pages</td>
            <td><span class="status-badge status-pass">PASS</span></td>
        </tr>
    </table>

    <h2>Detailed Test Results</h2>

    <!-- Test 1: Get Page Details by ID -->
    <div class="test-case">
        <h3>Test 1: Get Page Details by ID</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to Admin > Content > Pages</li>
                <li>Click on "Home" page in the page list</li>
                <li>Verify page details panel loads with correct information</li>
                <li>Click on "Our Products" page</li>
                <li>Verify different page details load correctly</li>
                <li>Click on "Workflow Test Page"</li>
                <li>Verify page ID and metadata display correctly</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Page details should load correctly for each page clicked, showing Page ID, Name, Title, Description, Status, and other metadata.</p>
        <p><strong>Actual Result:</strong> Page details loaded successfully for all tested pages (Home ID:21, Our Products ID:22, Workflow Test Page ID:70). All fields displayed correctly.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">Home page details (Page ID: 21)</p>
            <img src="Page_Details_Management_step01_home_page_details.png" alt="Home page details">
        </div>

        <div class="screenshot-container">
            <p class="screenshot-caption">Our Products page details (Page ID: 22)</p>
            <img src="Page_Details_Management_step02_our_products_details.png" alt="Our Products page details">
        </div>

        <div class="screenshot-container">
            <p class="screenshot-caption">Workflow Test Page details (Page ID: 70)</p>
            <img src="Page_Details_Management_step03_workflow_page_details.png" alt="Workflow Test Page details">
        </div>
    </div>

    <!-- Test 2: Save Page Details with All Fields -->
    <div class="test-case">
        <h3>Test 2: Save Page Details with All Fields</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select Workflow Test Page from the list</li>
                <li>Modify the Title field to "Workflow Test Page - Updated Title Test"</li>
                <li>Add Description: "This is a test description for verifying save functionality"</li>
                <li>Add Keywords: "test, workflow, verification"</li>
                <li>Click Save button</li>
                <li>Verify success message appears</li>
                <li>Navigate away and return to verify changes persisted</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Page details should save successfully and persist after navigation.</p>
        <p><strong>Actual Result:</strong> Page details saved successfully. "Page updated successfully" message appeared. Changes persisted after navigation.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">Before save - Modified fields</p>
            <img src="Page_Details_Management_step04_before_save.png" alt="Before save">
        </div>

        <div class="screenshot-container">
            <p class="screenshot-caption">Save success message</p>
            <img src="Page_Details_Management_step05_save_success.png" alt="Save success">
        </div>

        <div class="screenshot-container">
            <p class="screenshot-caption">Verified - Changes persisted after navigation</p>
            <img src="Page_Details_Management_step06_save_verified.png" alt="Save verified">
        </div>
    </div>

    <!-- Test 3: Page Type Changes -->
    <div class="test-case">
        <h3>Test 3: Page Type Changes</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select a page from the list</li>
                <li>Verify Page Type options are visible: Standard, Existing, URL, File</li>
                <li>Click "Add Page" button</li>
                <li>Verify page type options in Add Page form</li>
                <li>Navigate away with unsaved changes</li>
                <li>Verify unsaved changes warning dialog appears</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Page types (Standard, Existing, URL, File) should be available. Unsaved changes should trigger warning dialog.</p>
        <p><strong>Actual Result:</strong> All four page types visible and selectable. Unsaved changes warning dialog appeared correctly.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">Page type options: Standard, Existing, URL, File</p>
            <img src="Page_Details_Management_step07_page_types.png" alt="Page types">
        </div>

        <div class="screenshot-container">
            <p class="screenshot-caption">Unsaved changes warning dialog</p>
            <img src="Page_Details_Management_step08_unsaved_warning.png" alt="Unsaved changes warning">
        </div>
    </div>

    <!-- Test 4: Workflow Assignment -->
    <div class="test-case">
        <h3>Test 4: Workflow Assignment</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select "Test Normal Page" from the page list</li>
                <li>Open the Workflow dropdown in the Details tab</li>
                <li>Verify available workflows are listed</li>
                <li>Change workflow from "Direct Publish" to "Content Approval"</li>
                <li>Click Save button</li>
                <li>Verify workflow change saved successfully</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Multiple workflows should be available. Workflow assignment should save correctly.</p>
        <p><strong>Actual Result:</strong> Five workflows available: Direct Publish, Save Draft, Content Approval, Test Approval Workflow, QA Test Workflow. Successfully changed to "Content Approval" and saved.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">Workflow dropdown showing available options</p>
            <img src="Page_Details_Management_step09_workflow_options.png" alt="Workflow options">
        </div>

        <div class="screenshot-container">
            <p class="screenshot-caption">Workflow changed to Content Approval - Save successful</p>
            <img src="Page_Details_Management_step10_workflow_changed.png" alt="Workflow changed">
        </div>
    </div>

    <!-- Test 5: Timezone/Scheduling -->
    <div class="test-case">
        <h3>Test 5: Timezone/Scheduling</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select "Home" page which has scheduling enabled</li>
                <li>Verify "Enable Scheduling" toggle is visible and can be toggled</li>
                <li>Verify Start Date and End Date fields appear when scheduling is enabled</li>
                <li>Verify date picker calendar controls work</li>
                <li>Verify time fields (hours, minutes, AM/PM) are functional</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Enable Scheduling toggle should show/hide date fields. Date/time pickers should be functional.</p>
        <p><strong>Actual Result:</strong> Scheduling toggle works correctly. Date pickers show calendar with month navigation. Time fields support hour, minute, and AM/PM selection. Home page shows: Start Date: 01/30/2026 10:30 PM, End Date: 03/02/2026 05:00 PM.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">Scheduling interface with Start Date, End Date, and time pickers</p>
            <img src="Page_Details_Management_step12_scheduling_fullpage.png" alt="Scheduling interface">
        </div>
    </div>

    <!-- Test 6: Edge Cases - Special Characters -->
    <div class="test-case">
        <h3>Test 6: Edge Cases - Special Characters (XSS Protection)</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select page named "&lt;script&gt;alert('XSS')&lt;/script&gt;" from the list</li>
                <li>Verify page loads without executing script</li>
                <li>Verify special characters are properly HTML-encoded</li>
                <li>Verify page details display correctly</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Special characters and script tags should be properly escaped. No XSS execution should occur.</p>
        <p><strong>Actual Result:</strong> Page with XSS-style name loaded safely. Special characters properly HTML-encoded as &amp;lt;script&amp;gt;alert(&amp;#39;XSS&amp;#39;)&amp;lt;/script&amp;gt;. No script execution. Page ID: 76, Status: Visible.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">XSS page with special characters properly escaped</p>
            <img src="Page_Details_Management_step13_xss_page_details.png" alt="XSS page details">
        </div>
    </div>

    <!-- Test 7: Disabled Link Pages -->
    <div class="test-case">
        <h3>Test 7: Disabled Link Pages</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select a page from the list</li>
                <li>Navigate to Advanced tab</li>
                <li>Click on "More" sub-tab</li>
                <li>Verify "Disable Page" option exists under Security section</li>
                <li>Verify toggle can be switched On/Off</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Disable Page option should be available in Advanced > More > Security section.</p>
        <p><strong>Actual Result:</strong> "Disable Page" toggle found in Advanced > More > Security section alongside "Secure Connection" option. Cache Settings also available with Output Cache Provider dropdown.</p>

        <div class="screenshot-container">
            <p class="screenshot-caption">Advanced > More tab showing Disable Page option</p>
            <img src="Page_Details_Management_step14_advanced_more_disable.png" alt="Disable Page option">
        </div>
    </div>

    <!-- Observations Section -->
    <div class="observations">
        <h2>Observations</h2>
        <ul>
            <li><strong>Code Review:</strong> The source code (EvoqPagesController.cs) shows proper security checks via <code>_securityService.CanManagePage()</code> and <code>_securityService.CanSavePageDetails()</code> before allowing page operations.</li>
            <li><strong>Timezone Handling:</strong> The <code>FixTimeZone()</code> method in the controller properly converts dates to UTC when the DateTime kind is unspecified, ensuring consistent date handling.</li>
            <li><strong>Workflow Integration:</strong> The <code>WorkflowHelper.AssignWorkflowToTab()</code> method handles workflow assignment, with support for propagating workflows to child pages via <code>ApplyWorkflowToChildren</code> option.</li>
            <li><strong>Page Types:</strong> Four page types are supported: Standard, Existing (links to existing page), URL (external link), and File (links to a file).</li>
            <li><strong>Validation:</strong> The code includes proper validation with <code>PageValidationException</code> for field-level validation errors.</li>
            <li><strong>Permission Checks:</strong> Pages API returns HTTP 403 Forbidden for unauthorized access attempts.</li>
            <li><strong>Page Not Found:</strong> The API properly returns HTTP 404 with message "Page doesn't exists." when an invalid page ID is requested.</li>
        </ul>
    </div>

    <div class="feature-info">
        <h2>Test Environment</h2>
        <p><strong>URL:</strong> http://localhost:8081</p>
        <p><strong>User:</strong> host (SuperUser)</p>
        <p><strong>Browser:</strong> Chromium (via Playwright MCP)</p>
        <p><strong>Viewport:</strong> 1280x720</p>
    </div>

</body>
</html>
