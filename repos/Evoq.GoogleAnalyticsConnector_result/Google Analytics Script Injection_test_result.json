{
  "metadata": {
    "extension_name": "Evoq.GoogleAnalyticsConnector",
    "extension_type": "Connector",
    "feature_name": "Google Analytics Script Injection",
    "feature_description": "Injects appropriate Google Analytics tracking scripts into page headers based on configuration.",
    "feature_priority": "Top",
    "test_date": "2026-01-16T12:00:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Inject tracking script when enabled",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Connectors panel and verify Google Analytics 4 is configured with Measurement ID: G-TESTADMIN123",
          "expected": "GA4 connector shows configured state with Edit button",
          "actual": "GA4 connector shows green checkmark and Edit button with Measurement ID: G-TESTADMIN123",
          "screenshot": "Google Analytics Script Injection_step01_ga4_config.png"
        },
        {
          "step_number": 2,
          "action": "Check page source for GA tracking script injection",
          "expected": "GA4 tracking script should be present in page HTML with the configured Measurement ID",
          "actual": "Found GA4 script: <script async src=\"https://www.googletagmanager.com/gtag/js?id=G-TESTADMIN123\"></script> and inline gtag configuration",
          "screenshot": "Google Analytics Script Injection_step02_script_injected.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Skip injection when disabled (no GA connection)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Delete the GA4 connection by clicking Edit then Delete Connection",
          "expected": "GA4 connection should be deleted and show Connect button",
          "actual": "GA4 connection deleted successfully, now shows Connect button",
          "screenshot": "Google Analytics Script Injection_step09_after_delete.png"
        },
        {
          "step_number": 2,
          "action": "Reload page and check for GA tracking script",
          "expected": "No GA tracking script should be present in page HTML",
          "actual": "No GA scripts found in page HTML",
          "screenshot": "Google Analytics Script Injection_step10_no_script_disabled.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Skip injection for super users when Track for Administrators is disabled",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "With GA configured, uncheck 'Track for Administrators' option and save",
          "expected": "Setting should save successfully",
          "actual": "Setting saved with success message: 'Item successfully saved'",
          "screenshot": "Google Analytics Script Injection_step04_save_success.png"
        },
        {
          "step_number": 2,
          "action": "Reload page as super user and check for GA tracking script",
          "expected": "No GA tracking script should be present for super user when Track for Administrators is disabled",
          "actual": "No GA scripts found - script correctly skipped for super user",
          "screenshot": "Google Analytics Script Injection_step05_no_script_superuser.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Skip injection for administrators when Track for Administrators is disabled",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Code review confirms administrators are handled same as super users",
          "expected": "Code should check if user is administrator and skip injection when trackForAdmin is false",
          "actual": "Code at GoogleAnalyticsProEngine.cs:84-91 confirms: if (!trackForAdmin && (user.IsSuperUser || user.IsInRole(AdministratorRoleName))) return empty string",
          "screenshot": "Google Analytics Script Injection_step05_no_script_superuser.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Handle Google Tag Manager override",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempt to configure Google Tag Manager with 'Use Tag Manager for GA' option enabled",
          "expected": "GTM should be configured and GA script injection should be skipped",
          "actual": "GTM configuration failed with validation error: 'The Container Id is invalid or container hasn't been published yet.' - GTM requires a valid container ID which cannot be tested without a real GTM account",
          "screenshot": "Google Analytics Script Injection_step07_gtm_validation_error.png"
        }
      ],
      "issues": ["GTM override feature cannot be tested without a valid Google Tag Manager container ID. The system validates the container ID against Google's API."]
    },
    {
      "scenario_name": "Verify domain configuration in script",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Code review of domain configuration feature",
          "expected": "Domain configuration should be available and properly set in script",
          "actual": "Code review shows domain configuration is implemented for Universal Analytics template (SiteAnalytics.config) with [DOMAIN_NAME] placeholder. GA4 template (SiteAnalytics.GA4.config) does not use domain configuration as GA4 handles this automatically with 'auto' cookie domain.",
          "screenshot": "Google Analytics Script Injection_step01_ga4_config.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "The Google Analytics 4 connector UI does not expose domain name configuration - this is by design as GA4 uses automatic cookie domain detection",
    "The domain configuration feature ([DOMAIN_NAME] placeholder) is only applicable to Universal Analytics, not GA4",
    "Google Tag Manager override feature (GTMUseTagManagerForGA portal setting) cannot be fully tested via UI without a valid GTM container ID - GTM validates container IDs against Google's API",
    "The 'Track for Administrators' checkbox correctly controls whether tracking scripts are injected for both super users and administrators",
    "Code confirms custom dimensions for Universal Analytics and page personalization tracking are implemented in RenderCustomDimensions() and RenderPagePersonalization() methods",
    "The GA4 template uses gtag('config', '[TRACKING_ID]') format instead of the older ga() API"
  ],
  "summary": {
    "total_scenarios": 6,
    "passed": 5,
    "failed": 1,
    "pass_rate": "83%"
  }
}
