<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Custom Dimensions and Variables</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }
        h2 {
            color: #0066cc;
            margin-top: 30px;
        }
        h3 {
            color: #444;
        }
        .feature-info {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .feature-info table {
            width: 100%;
            border-collapse: collapse;
        }
        .feature-info td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .feature-info td:first-child {
            font-weight: bold;
            width: 200px;
            color: #666;
        }
        .test-scenario {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-pass {
            background-color: #28a745;
            color: white;
        }
        .status-fail {
            background-color: #dc3545;
            color: white;
        }
        .status-not-testable {
            background-color: #6c757d;
            color: white;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .observations {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .observations h2 {
            color: #856404;
            margin-top: 0;
        }
        .code-analysis {
            background: #e7f3ff;
            border: 1px solid #0066cc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .code-analysis h3 {
            color: #0066cc;
            margin-top: 0;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .summary-table th, .summary-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .summary-table th {
            background: #0066cc;
            color: white;
        }
        .summary-table tr:nth-child(even) {
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Test Report: Custom Dimensions and Variables</h1>

    <div class="feature-info">
        <h2>Feature Information</h2>
        <table>
            <tr>
                <td>Extension</td>
                <td>Evoq.GoogleAnalyticsConnector</td>
            </tr>
            <tr>
                <td>Feature Name</td>
                <td>Custom Dimensions and Variables</td>
            </tr>
            <tr>
                <td>Description</td>
                <td>Configure custom tracking dimensions and variables based on segmentation rules for enhanced analytics.</td>
            </tr>
            <tr>
                <td>Feature Priority</td>
                <td>Medium</td>
            </tr>
            <tr>
                <td>UI Location</td>
                <td>Rendered in tracking script based on rules</td>
            </tr>
            <tr>
                <td>Relevant Files</td>
                <td>
                    <code>Evoq Platform/Library/Services/Analytics/GoogleAnalyticsProEngine.cs</code><br>
                    <code>Evoq Content/Connectors/GoogleAnalytics/Components/GoogleAnalyticsConnector.cs</code>
                </td>
            </tr>
            <tr>
                <td>Test Date</td>
                <td>2026-01-06</td>
            </tr>
        </table>
    </div>

    <div class="code-analysis">
        <h3>Code Analysis Summary</h3>
        <p>The Custom Dimensions and Variables feature was thoroughly analyzed in the codebase. Key findings:</p>
        <ul>
            <li><strong>MAX_CUSTOM_VARS = 5</strong> - Maximum of 5 custom variables supported</li>
            <li><strong>CUSTVAR_OPT_SCOPE = 3</strong> - Page-level scope is used for all custom variables</li>
            <li><strong>Rule Configuration</strong> - Rules support Label, Value, TabId (Page), and RoleId (Role) fields</li>
            <li><strong>UI Template</strong> - <code>advanced.htm</code> provides the Segmentation Rules interface</li>
            <li><strong>JavaScript Handler</strong> - <code>connector.js</code> manages rule CRUD operations</li>
        </ul>
        <p>Code excerpt from <code>GoogleAnalyticsProEngine.cs</code>:</p>
        <pre>private const int MAX_CUSTOM_VARS = 5;
private const int CUSTVAR_OPT_SCOPE = 3; //page level

// Custom variables are rendered based on rules matching:
// - TabId (specific page or -1 for any page)
// - RoleId (specific role or -1 for all users)</pre>
    </div>

    <h2>Test Execution Summary</h2>

    <table class="summary-table">
        <tr>
            <th>Scenario</th>
            <th>Status</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td>Add custom variable for specific role</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Add custom variable for specific page</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Test maximum 5 custom variables limit</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Verify page-level scope (scope=3)</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Test custom dimension for page variants</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Validate localStorage for dimension names</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Test rule matching for current page</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
        <tr>
            <td>Test role-based rule matching</td>
            <td><span class="status status-not-testable">NOT TESTABLE</span></td>
            <td>No UI element found to access feature</td>
        </tr>
    </table>

    <h2>Investigation Steps</h2>

    <div class="test-scenario">
        <h3>Step 1: Login and Navigate to Connectors</h3>
        <div class="steps">
            <ol>
                <li>Logged in as SuperUser (host / Pass123456)</li>
                <li>Navigated to Settings > Connectors</li>
                <li>Located Google Analytics 4 connector</li>
            </ol>
        </div>
        <p><strong>Screenshot: Login Confirmed</strong></p>
        <img src="Custom Dimensions and Variables_step00_login_confirmed.png" alt="Login Confirmed" class="screenshot">
    </div>

    <div class="test-scenario">
        <h3>Step 2: Google Analytics 4 Connector Settings</h3>
        <div class="steps">
            <ol>
                <li>Clicked "Edit" on Google Analytics 4 connector</li>
                <li>Observed only two configuration options available:
                    <ul>
                        <li>Measurement ID field</li>
                        <li>Track for Administrators checkbox</li>
                    </ul>
                </li>
                <li>Searched for "Advanced Settings" link - NOT FOUND</li>
            </ol>
        </div>
        <p><strong>Screenshot: GA4 Connector Settings</strong></p>
        <img src="Custom Dimensions and Variables_step01_ga_connector_settings.png" alt="GA4 Connector Settings" class="screenshot">
        <p><strong>Finding:</strong> The GA4 connector interface does not include an "Advanced Settings" link that would provide access to the Segmentation Rules configuration.</p>
    </div>

    <div class="test-scenario">
        <h3>Step 3: Testing with Universal Analytics Tracking ID</h3>
        <div class="steps">
            <ol>
                <li>Changed Measurement ID to Universal Analytics format: UA-12345678-1</li>
                <li>Saved the configuration successfully</li>
                <li>Re-checked for Advanced Settings link - still NOT FOUND</li>
            </ol>
        </div>
        <p><strong>Screenshot: UA Tracking ID Saved</strong></p>
        <img src="Custom Dimensions and Variables_step02_ua_tracking_saved.png" alt="UA Tracking ID Saved" class="screenshot">
        <p><strong>Finding:</strong> Even with a Universal Analytics tracking ID, the Advanced Settings link for Segmentation Rules is not displayed in the connector UI.</p>
    </div>

    <div class="test-scenario">
        <h3>Step 4: DOM Inspection</h3>
        <div class="steps">
            <ol>
                <li>Used browser automation to inspect the connector HTML structure</li>
                <li>Found connector uses a simplified GA4 template with ID <code>txtGa4ID</code></li>
                <li>Original <code>connector.htm</code> template with <code>advancedSetting</code> link is not being used</li>
            </ol>
        </div>
        <p><strong>Technical Finding:</strong></p>
        <p>The codebase contains <code>connector.htm</code> with an Advanced Settings link:</p>
        <pre>&lt;a class="advancedSetting" href="#" data-bind="attr: {title: resx.AdvancedSettings}"&gt;&lt;/a&gt;</pre>
        <p>However, the GA4 connector uses a different simplified template that only renders:</p>
        <pre>&lt;div&gt;
    &lt;label for="txtGa4ID"&gt;Measurement ID:&lt;/label&gt;
    &lt;input id="txtGa4ID" ... /&gt;
&lt;/div&gt;</pre>
        <p><strong>Screenshot: Connectors Page</strong></p>
        <img src="Custom Dimensions and Variables_step03_connectors_page.png" alt="Connectors Page" class="screenshot">
    </div>

    <div class="observations">
        <h2>Observations</h2>
        <p>Based on comprehensive code analysis and UI testing, the following observations were made:</p>
        <ol>
            <li><strong>Feature Exists in Code:</strong> The Custom Dimensions and Variables (Segmentation Rules) feature is fully implemented in the codebase:
                <ul>
                    <li><code>GoogleAnalyticsProEngine.cs</code> - Contains logic for rendering custom variables with MAX_CUSTOM_VARS=5 and page-level scope</li>
                    <li><code>GoogleAnalyticsConnector.cs</code> - Handles rules configuration with GetRulesAsConfig/ParseRuleSettings methods</li>
                    <li><code>advanced.htm</code> - Complete UI template for managing Segmentation Rules (Label, Value, Page, Role)</li>
                    <li><code>connector.js</code> - JavaScript for rule CRUD operations and Advanced Settings dialog</li>
                </ul>
            </li>
            <li><strong>No UI Element Found:</strong> The Google Analytics 4 connector in the Persona Bar Connectors section does not expose the "Advanced Settings" link that would open the Segmentation Rules configuration dialog.</li>
            <li><strong>Technical Explanation:</strong> The GA4 connector appears to use a simplified template that excludes the Advanced Settings functionality. This may be because:
                <ul>
                    <li>Custom Variables are a Universal Analytics (UA) feature not supported in Google Analytics 4</li>
                    <li>The GA4 data model uses a different approach (Events with parameters) instead of Custom Variables</li>
                    <li>The feature may have been intentionally deprecated for GA4 since Google sunset Universal Analytics</li>
                </ul>
            </li>
            <li><strong>Resource File Confirms Feature:</strong> The <code>SharedResources.resx</code> file contains localization strings for the feature including:
                <ul>
                    <li>"Segmentation Rules"</li>
                    <li>"Advanced Settings: Google Analytics"</li>
                    <li>"+ Add Rule"</li>
                    <li>"Any Page" / "Any Role"</li>
                </ul>
            </li>
        </ol>
        <p><strong>Recommendation:</strong> The Custom Dimensions and Variables feature cannot be tested via the UI in its current state. If this functionality is required for GA4, the connector template would need to be updated to include the Advanced Settings link, or the feature may need to be reimplemented using GA4's event-based tracking model.</p>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
        <p>Test Report Generated: 2026-01-06</p>
        <p>Tester: Claude Code (Automated Testing)</p>
        <p>Extension: Evoq.GoogleAnalyticsConnector | Feature: Custom Dimensions and Variables</p>
    </footer>
</body>
</html>
