{
  "metadata": {
    "extension_name": "Evoq.GoogleAnalyticsConnector",
    "extension_type": "Connector",
    "feature_name": "Custom Dimensions and Variables",
    "feature_description": "Configure custom tracking dimensions and variables based on segmentation rules for enhanced analytics.",
    "feature_priority": "Medium",
    "test_date": "2026-01-16T14:05:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Access Custom Variables (Segmentation Rules) UI",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Connectors panel and open Google Analytics connector settings",
          "expected": "Google Analytics connector settings should display with Advanced Settings link for accessing Segmentation Rules",
          "actual": "Connector displays as 'Google Analytics 4' with simplified UI showing only Measurement ID and Track for Administrators fields. No Advanced Settings link visible.",
          "screenshot": "Custom Dimensions and Variables_step01_ga_settings_basic.png"
        },
        {
          "step_number": 2,
          "action": "Change tracking ID from GA4 format (G-xxxxx) to Universal Analytics format (UA-xxxxx) to check if Advanced Settings appears",
          "expected": "UI should update to show Advanced Settings link for Segmentation Rules when using Universal Analytics format",
          "actual": "UI remains unchanged - still shows GA4 connector format without Advanced Settings. Even with UA-12345678-1 tracking ID, the connector is labeled 'Google Analytics 4' and lacks the Advanced Settings link.",
          "screenshot": "Custom Dimensions and Variables_step02_ua_tracking_id_no_advanced.png"
        },
        {
          "step_number": 3,
          "action": "Verify analytics script rendering after tracking ID change",
          "expected": "Analytics tracking script should be rendered on the page with the configured tracking ID",
          "actual": "No analytics script is rendered on the page after changing to UA format. The GA4 connector does not properly handle Universal Analytics tracking IDs.",
          "screenshot": "Custom Dimensions and Variables_step03_no_analytics_script.png"
        }
      ],
      "issues": [
        "The deployed connector is registered as 'Google Analytics 4' which uses a simplified UI without the Advanced Settings functionality",
        "The Segmentation Rules (Custom Variables) UI exists in code (advanced.htm, connector.js) but is not accessible through the GA4 connector",
        "Custom variables feature in GoogleAnalyticsProEngine.cs uses _gaq.push(['_setCustomVar'...]) which is for Classic Google Analytics, not GA4",
        "The GA4 connector does not properly render analytics scripts when configured with Universal Analytics (UA-) tracking IDs",
        "All suggested test scenarios (add custom variable for role/page, test 5 variable limit, verify scope, test localStorage, rule matching) cannot be executed due to missing UI access"
      ]
    },
    {
      "scenario_name": "Add custom variable for specific role",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempt to access Segmentation Rules UI to add a custom variable for a specific role",
          "expected": "Should be able to access Advanced Settings dialog with Label, Value, Page, and Role fields",
          "actual": "Cannot access - Advanced Settings link not available in GA4 connector UI",
          "screenshot": "Custom Dimensions and Variables_step01_ga_settings_basic.png"
        }
      ],
      "issues": ["Segmentation Rules UI not accessible through GA4 connector"]
    },
    {
      "scenario_name": "Add custom variable for specific page",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempt to access Segmentation Rules UI to add a custom variable for a specific page",
          "expected": "Should be able to select a page from dropdown in Advanced Settings dialog",
          "actual": "Cannot access - Advanced Settings link not available in GA4 connector UI",
          "screenshot": "Custom Dimensions and Variables_step01_ga_settings_basic.png"
        }
      ],
      "issues": ["Segmentation Rules UI not accessible through GA4 connector"]
    },
    {
      "scenario_name": "Test maximum 5 custom variables limit",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempt to add 6 custom variables to test the MAX_CUSTOM_VARS = 5 limit",
          "expected": "Should be able to add rules until reaching 5, then Add Rule link should be hidden",
          "actual": "Cannot test - Advanced Settings UI not accessible to add any custom variables",
          "screenshot": "Custom Dimensions and Variables_step01_ga_settings_basic.png"
        }
      ],
      "issues": ["Segmentation Rules UI not accessible through GA4 connector"]
    },
    {
      "scenario_name": "Verify page-level scope (scope=3)",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Add a custom variable and verify CUSTVAR_OPT_SCOPE = 3 (page level) is applied in rendered script",
          "expected": "Custom variable should render with scope=3 in _gaq.push call",
          "actual": "Cannot test - No custom variables can be added, and analytics script is not rendering",
          "screenshot": "Custom Dimensions and Variables_step03_no_analytics_script.png"
        }
      ],
      "issues": ["Segmentation Rules UI not accessible; analytics script not rendering with UA tracking ID"]
    },
    {
      "scenario_name": "Test custom dimension for page variants",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Verify RenderPagePersonalization() renders dimension based on ContentPersonalizedPageVariantName",
          "expected": "Script should include localStorage check for 'Analytics.Page.PageVariantDimension' and set dimension",
          "actual": "Cannot test - Analytics script not rendered on page; no custom dimension output visible",
          "screenshot": "Custom Dimensions and Variables_step03_no_analytics_script.png"
        }
      ],
      "issues": ["Analytics script not rendering; page personalization dimensions require Universal Analytics script"]
    },
    {
      "scenario_name": "Validate localStorage for dimension names",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Verify localStorage.getItem('Analytics.Page.PageVariantDimension') integration in rendered script",
          "expected": "Script should check localStorage for dimension name and apply it via ga('set', dimensionName, value)",
          "actual": "Cannot test - No analytics script rendered on page to verify localStorage integration",
          "screenshot": "Custom Dimensions and Variables_step03_no_analytics_script.png"
        }
      ],
      "issues": ["Analytics script not rendering; localStorage integration cannot be verified"]
    },
    {
      "scenario_name": "Test rule matching for current page",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Add a rule with specific TabId and verify it only renders on that page",
          "expected": "Custom variable should only appear in script when on the matching page",
          "actual": "Cannot test - Unable to add rules through UI; no custom variables can be configured",
          "screenshot": "Custom Dimensions and Variables_step01_ga_settings_basic.png"
        }
      ],
      "issues": ["Segmentation Rules UI not accessible through GA4 connector"]
    },
    {
      "scenario_name": "Test role-based rule matching",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Add a rule with specific RoleId and verify it only renders for users in that role",
          "expected": "Custom variable should only appear in script when user is in the matching role",
          "actual": "Cannot test - Unable to add rules through UI; no custom variables can be configured",
          "screenshot": "Custom Dimensions and Variables_step01_ga_settings_basic.png"
        }
      ],
      "issues": ["Segmentation Rules UI not accessible through GA4 connector"]
    }
  ],
  "observations": [
    "Code confirms feature exists: GoogleAnalyticsProEngine.cs implements custom variables with MAX_CUSTOM_VARS=5 and CUSTVAR_OPT_SCOPE=3 (page level)",
    "UI templates exist: advanced.htm contains full Segmentation Rules form with Label, Value, Page dropdown, and Role dropdown",
    "JavaScript handling exists: connector.js has onAdvancedClick handler that should open Advanced Settings dialog",
    "The deployed connector is 'Google Analytics 4' which uses a different, simplified UI template without Advanced Settings",
    "Code review shows connector.htm has advancedSetting link but it's not being loaded for the GA4 connector",
    "Custom variables (_gaq.push['_setCustomVar']) are for Classic/Universal Analytics; GA4 uses different tracking methods",
    "RenderCustomDimensions() method exists for page personalization dimensions via localStorage",
    "The EnsureConfig method in GoogleAnalyticsConnector.cs selects different SiteAnalytics.config templates based on tracking ID format (UA- vs G-)",
    "Feature appears to be legacy functionality designed for Universal Analytics that was not updated for GA4 connector"
  ],
  "summary": {
    "total_scenarios": 9,
    "passed": 0,
    "failed": 9,
    "pass_rate": "0%"
  }
}
