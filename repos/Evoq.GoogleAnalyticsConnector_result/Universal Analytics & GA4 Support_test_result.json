{
  "metadata": {
    "extension_name": "Evoq.GoogleAnalyticsConnector",
    "extension_type": "Connector",
    "feature_name": "Universal Analytics & GA4 Support",
    "feature_description": "Support for both Universal Analytics (UA-) and Google Analytics 4 (G-) tracking codes with appropriate configuration.",
    "feature_priority": "Top",
    "test_date": "2026-02-09T14:51:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Configure GA4 tracking code (G-XXXXX)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Admin > Settings > Connectors",
          "expected": "Connectors page loads with Google Analytics 4 connector visible",
          "actual": "Connectors page loaded successfully with Google Analytics 4 connector shown",
          "screenshot": "Universal Analytics & GA4 Support_step01_connectors_page.png"
        },
        {
          "step_number": 2,
          "action": "Click Connect on Google Analytics 4",
          "expected": "Settings panel opens with Measurement ID field",
          "actual": "Settings panel opened with Measurement ID and Track for Administrators fields",
          "screenshot": "Universal Analytics & GA4 Support_step02_ga4_settings_panel.png"
        },
        {
          "step_number": 3,
          "action": "Enter GA4 tracking code G-ABC123XYZ",
          "expected": "Code is accepted in the field",
          "actual": "GA4 tracking code entered successfully",
          "screenshot": "Universal Analytics & GA4 Support_step03_ga4_id_entered.png"
        },
        {
          "step_number": 4,
          "action": "Click Save button",
          "expected": "Configuration saves successfully",
          "actual": "Success message 'Item successfully saved' displayed, connector shows green checkmark",
          "screenshot": "Universal Analytics & GA4 Support_step04_ga4_saved_success.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Configure UA tracking code (UA-XXXXX)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Edit Google Analytics 4 connector settings",
          "expected": "Settings panel opens",
          "actual": "Settings panel opened with previous configuration",
          "screenshot": "Universal Analytics & GA4 Support_step04_ga4_saved_success.png"
        },
        {
          "step_number": 2,
          "action": "Enter UA tracking code UA-123456789-1",
          "expected": "Code is accepted in the field",
          "actual": "UA tracking code entered successfully",
          "screenshot": "Universal Analytics & GA4 Support_step05_ua_id_entered.png"
        },
        {
          "step_number": 3,
          "action": "Click Save button",
          "expected": "Configuration saves successfully",
          "actual": "Success message displayed, configuration saved",
          "screenshot": "Universal Analytics & GA4 Support_step06_ua_saved_success.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Display warning for UA deprecation",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Configure UA tracking code and check for deprecation warning",
          "expected": "Warning message should display about Universal Analytics deprecation (code exists in connector.js and SharedResources.resx)",
          "actual": "No deprecation warning displayed in the Connectors page UI. The warning text exists in code: 'Universal Analytics (UA) will sunset on the 1st of July 2023...' but the inline connector settings panel does not show this warning.",
          "screenshot": "Universal Analytics & GA4 Support_step06_ua_saved_success.png"
        }
      ],
      "issues": ["UA deprecation warning exists in code (connector.htm, connector.js, SharedResources.resx) but is NOT displayed in the current Connectors page inline settings UI"]
    },
    {
      "scenario_name": "Auto-detect analytics version from tracking ID",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Review code for auto-detection logic in GoogleAnalyticsConnector.cs",
          "expected": "Code should detect GA4 (G-) vs UA (UA-) tracking IDs",
          "actual": "GetAnalyticsVersion() method correctly detects: UA- prefix returns Universal, G- prefix returns GA4, other returns Other",
          "screenshot": "Universal Analytics & GA4 Support_step06_ua_saved_success.png"
        },
        {
          "step_number": 2,
          "action": "Test with UA tracking ID",
          "expected": "System recognizes UA tracking code",
          "actual": "UA-123456789-1 was saved and processed correctly",
          "screenshot": "Universal Analytics & GA4 Support_step06_ua_saved_success.png"
        },
        {
          "step_number": 3,
          "action": "Test with GA4 tracking ID",
          "expected": "System recognizes GA4 tracking code",
          "actual": "G-ABC123XYZ99 was saved and processed correctly",
          "screenshot": "Universal Analytics & GA4 Support_step16_ga4_configured.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Load correct config file based on version",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Review code for config file loading logic",
          "expected": "EnsureConfig() method loads appropriate SiteAnalytics config based on analytics version",
          "actual": "Code confirmed: GA4 version loads SiteAnalytics.GA4.config (gtag.js template), Universal loads SiteAnalytics.config (analytics.js template)",
          "screenshot": "Universal Analytics & GA4 Support_step07_script_verification.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test analytics.js vs gtag.js script injection",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Configure UA tracking code with Track for Administrators enabled",
          "expected": "UA tracking should inject analytics.js script with ga() function calls",
          "actual": "UA tracking code (UA-123456789-1) was injected using gtag.js script instead of analytics.js. Page source shows: googletagmanager.com/gtag/js?id=UA-123456789-1 and gtag('config', 'UA-123456789-1')",
          "screenshot": "Universal Analytics & GA4 Support_step15_ua_uses_gtag.png"
        },
        {
          "step_number": 2,
          "action": "Configure GA4 tracking code with Track for Administrators enabled",
          "expected": "GA4 tracking should inject gtag.js script",
          "actual": "GA4 tracking code (G-ABC123XYZ99) correctly injected using gtag.js: googletagmanager.com/gtag/js?id=G-ABC123XYZ99",
          "screenshot": "Universal Analytics & GA4 Support_step16_ga4_configured.png"
        }
      ],
      "issues": ["UA tracking codes are injected using GA4 template (gtag.js) instead of the proper UA template (analytics.js with ga() calls). While gtag.js works with UA codes, the dedicated SiteAnalytics.config with analytics.js is not being used for UA tracking IDs."]
    },
    {
      "scenario_name": "Empty input validation",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Clear the Measurement ID field and click Save",
          "expected": "Validation error should appear",
          "actual": "Error message displayed: 'Tracking Code Cannot Be Empty'",
          "screenshot": "Universal Analytics & GA4 Support_step09_empty_validation.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Invalid format tracking ID",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Enter invalid tracking ID format 'INVALID-123456' and save",
          "expected": "Validation error or warning about invalid format",
          "actual": "System accepted and saved 'INVALID-123456' without any format validation",
          "screenshot": "Universal Analytics & GA4 Support_step11_invalid_format_saved.png"
        }
      ],
      "issues": ["No validation for tracking ID format - system accepts any non-empty string including invalid formats"]
    },
    {
      "scenario_name": "Special characters and XSS input",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Enter XSS test string '<script>alert('XSS')</script>' as tracking ID",
          "expected": "Input should be sanitized or rejected",
          "actual": "System accepted and saved the XSS script tag without sanitization",
          "screenshot": "Universal Analytics & GA4 Support_step13_xss_saved.png"
        }
      ],
      "issues": ["Potential security vulnerability - XSS/script injection input is accepted without sanitization. The tracking ID is later injected into page HTML which could lead to XSS attacks if malicious input is provided."]
    },
    {
      "scenario_name": "Track for Administrators checkbox",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Enable Track for Administrators checkbox and save",
          "expected": "Setting should be saved and analytics script should be injected for admin users",
          "actual": "Setting saved successfully. When enabled, analytics script is injected in page source for admin users. When disabled, script is not injected for admin users.",
          "screenshot": "Universal Analytics & GA4 Support_step14_track_admin_enabled.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "The connector is labeled 'Google Analytics 4' in the UI but accepts both GA4 (G-) and UA (UA-) tracking codes",
    "UA deprecation warning code exists in connector.js (checkTrackingVersion function) and SharedResources.resx but is not displayed in the inline Connectors page settings panel",
    "Both SiteAnalytics.config (analytics.js template) and SiteAnalytics.GA4.config (gtag.js template) exist in the codebase, but testing revealed that gtag.js is used for both UA and GA4 codes",
    "GetAnalyticsVersion() method in GoogleAnalyticsConnector.cs correctly detects tracking ID format based on prefix (UA- vs G-)",
    "No input validation exists for tracking ID format beyond non-empty check - any string is accepted",
    "Script injection correctly respects the 'Track for Administrators' setting - script is not injected when disabled and user is admin"
  ],
  "summary": {
    "total_scenarios": 10,
    "passed": 6,
    "failed": 4,
    "pass_rate": "60%"
  }
}
