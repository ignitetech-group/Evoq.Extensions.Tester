{
  "metadata": {
    "extension_name": "Evoq.PersonaBar.Workflow",
    "extension_type": "PersonaBar Module",
    "feature_name": "Workflow State Permissions",
    "feature_description": "Configure role-based and user-specific permissions for workflow state transitions and reviews.",
    "feature_priority": "High",
    "test_date": "2026-01-16T00:00:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify default roles appear (Content Editor, Content Manager)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Settings > Workflow and expand Content Approval workflow",
          "expected": "Workflow states list should be visible",
          "actual": "Workflow states list displayed showing Draft, Ready For Review, and Published states",
          "screenshot": "Workflow_State_Permissions_step01_workflows_panel.png"
        },
        {
          "step_number": 2,
          "action": "Click Edit (E) button on Ready For Review state",
          "expected": "State permissions dialog should open with default roles",
          "actual": "Dialog opened showing Roles table with Administrators, All Users, Content Editors, Content Managers, and Registered Users",
          "screenshot": "Workflow_State_Permissions_step02_permissions_dialog.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Assign review permission to Content Manager role",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "In the state permissions dialog, click the Review checkbox for Content Managers role",
          "expected": "Checkbox should toggle to checked state",
          "actual": "Content Managers Review checkbox was clicked and toggled",
          "screenshot": "Workflow_State_Permissions_step03_content_manager_click.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Assign review permission to specific user",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "In the Add User field, type 'admin' to search for users",
          "expected": "User search dropdown should appear with matching users",
          "actual": "Token input search showed dropdown with 'Test Admin' user as matching result",
          "screenshot": "Workflow_State_Permissions_step04_user_search.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test permission inheritance for new states",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to QA Test Workflow Edited and click Add a State button",
          "expected": "New state dialog should open",
          "actual": "Workflow State New dialog opened for creating new state",
          "screenshot": "Workflow_State_Permissions_step05_workflows_list.png"
        },
        {
          "step_number": 2,
          "action": "Verify permissions grid in new state dialog",
          "expected": "Content Managers should have Review permission checked by default (per code: SetContentManagerRoleAsCheckedByDefault)",
          "actual": "Content Managers role had Review checkbox checked by default. All other roles (All Users, Content Editors, Registered Users) had unchecked Review. Administrators was locked.",
          "screenshot": "Workflow_State_Permissions_step06_new_state_dialog.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Remove permission from role",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Open Ready For Review state permissions dialog",
          "expected": "Dialog should show roles with Delete actions for non-default roles",
          "actual": "Dialog showed Moderators role with Delete link visible",
          "screenshot": "Workflow_State_Permissions_step07_edit_state_dialog.png"
        },
        {
          "step_number": 2,
          "action": "Click Delete link on Moderators role",
          "expected": "Moderators should be removed from the permissions grid",
          "actual": "Moderators row was removed from the Roles table. Moderators now appears in Select Role dropdown (available to add again).",
          "screenshot": "Workflow_State_Permissions_step08_role_removed.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Remove permission from user",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "In the same dialog, click Delete link on Test Admin user",
          "expected": "Test Admin should be removed from the Users permissions grid",
          "actual": "Test Admin row was removed from the Users table. Only SuperUser Account remained in Users section.",
          "screenshot": "Workflow_State_Permissions_step09_user_removed.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "Code confirms Content Editor and Content Manager roles are added by default in GetPermissionsData method (WorkflowStatesController.cs:342-354)",
    "For NEW states (StateId == 0), SetContentManagerRoleAsCheckedByDefault sets Content Manager's Review permission to checked by default",
    "Permission states in UI: unchecked (no permission), checked (granted), lock icon (locked/inherited), minus icon (denied)",
    "Administrators role is always locked and cannot be modified",
    "Non-default roles can be removed using Delete action; default roles (Content Editors, Content Managers) appear without Delete option unless explicitly added",
    "Verify permissions enforced during state transitions - This test scenario would require creating content and going through actual workflow state transitions with different user roles, which is beyond the scope of testing the permissions configuration UI. The backend enforcement logic exists in WorkflowSecurity service."
  ],
  "summary": {
    "total_scenarios": 6,
    "passed": 6,
    "failed": 0,
    "pass_rate": "100%"
  }
}
