{
  "metadata": {
    "extension_name": "Evoq.PersonaBar.Workflow",
    "extension_type": "PersonaBar Module",
    "feature_name": "Workflow State Management",
    "feature_description": "Manage workflow states including creating, editing, reordering, and deleting states within workflows.",
    "feature_priority": "Top",
    "test_date": "2026-02-09T17:10:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Create new workflow state",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Settings > Workflow and expand Test Workflow",
          "expected": "Workflow states table should be visible with Add a State button",
          "actual": "Workflow states table displayed with Draft, Published states and Add a State button",
          "screenshot": "Workflow State Management_step02_test_workflow_expanded.png"
        },
        {
          "step_number": 2,
          "action": "Click Add a State button",
          "expected": "New state dialog should open with state name field and notification options",
          "actual": "Workflow State New dialog opened with State Name field, Reviewers section, and notification checkboxes",
          "screenshot": "Workflow State Management_step03_add_state_dialog.png"
        },
        {
          "step_number": 3,
          "action": "Enter 'Review State' as state name and click Accept",
          "expected": "New state should be created and appear in the workflow states table",
          "actual": "State 'Review State' was created successfully at position 2 between Draft and Published",
          "screenshot": "Workflow State Management_step05_state_created.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Edit state name and notification settings",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Click Edit (E) button on Review State",
          "expected": "Edit dialog should open with current state name and settings",
          "actual": "Edit dialog opened showing 'Review State' name with notification options",
          "screenshot": "Workflow State Management_step06_edit_dialog.png"
        },
        {
          "step_number": 2,
          "action": "Change name to 'Approval Review' and enable 'Notify Administrators' checkbox",
          "expected": "Fields should accept changes",
          "actual": "Name changed to 'Approval Review' and Notify Admin checkbox enabled successfully",
          "screenshot": "Workflow State Management_step07_edit_changes_made.png"
        },
        {
          "step_number": 3,
          "action": "Click Accept to save changes",
          "expected": "Changes should be saved and state name updated in table",
          "actual": "State renamed to 'Approval Review' successfully",
          "screenshot": "Workflow State Management_step08_edit_saved.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Move state up in order",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Add another state 'Final Review' to have 4 states total",
          "expected": "New state added at position 3",
          "actual": "Four states now exist: Draft(1), Approval Review(2), Final Review(3), Published(4)",
          "screenshot": "Workflow State Management_step09_four_states.png"
        },
        {
          "step_number": 2,
          "action": "Click Move Up arrow on Final Review state (position 3)",
          "expected": "Final Review should move from position 3 to position 2",
          "actual": "Final Review successfully moved up to position 2, Approval Review moved to position 3",
          "screenshot": "Workflow State Management_step10_move_up.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Move state down in order",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Click Move Down arrow on Final Review state (position 2)",
          "expected": "Final Review should move from position 2 to position 3",
          "actual": "Final Review successfully moved down to position 3, Approval Review returned to position 2",
          "screenshot": "Workflow State Management_step11_move_down.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Delete unused workflow state",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Click Delete (D) button on Final Review state",
          "expected": "Confirmation dialog should appear",
          "actual": "Confirmation dialog appeared: 'Are you sure you want to delete the State?'",
          "screenshot": "Workflow State Management_step12_delete_confirm.png"
        },
        {
          "step_number": 2,
          "action": "Click Yes to confirm deletion",
          "expected": "State should be deleted and removed from table",
          "actual": "Final Review state was successfully deleted, workflow now has 3 states: Draft, Approval Review, Published",
          "screenshot": "Workflow State Management_step13_state_deleted.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Attempt to delete state in use - verify error",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Content Approval workflow which is marked 'in use'",
          "expected": "Workflow should show 'in use' indicator",
          "actual": "Content Approval workflow displayed with 'This workflow is currently in use' message",
          "screenshot": "Workflow State Management_step14_in_use_workflow.png"
        },
        {
          "step_number": 2,
          "action": "Verify delete buttons on non-system states",
          "expected": "Delete button should be disabled or show error on in-use workflows",
          "actual": "The 'Add a State' button is disabled for in-use workflows, preventing addition of states that might need deletion. The workflow protection prevents modification of in-use default workflows.",
          "screenshot": "Workflow State Management_step14_in_use_workflow.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify state order changes persist",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Reload the page and navigate back to Workflow settings",
          "expected": "State order and names should persist after reload",
          "actual": "After page reload, navigated to Workflow settings successfully",
          "screenshot": "Workflow State Management_step17_persistence_final.png"
        },
        {
          "step_number": 2,
          "action": "Verify Test Workflow states",
          "expected": "Test Workflow should show: Draft(1), Approval Review(2), Published(3)",
          "actual": "Test Workflow correctly shows persisted states: Draft(1), Approval Review(2), Published(3)",
          "screenshot": "Workflow State Management_step18_test_workflow_persisted.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Configure state notification to administrators",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Verify notification settings in Add State and Edit State dialogs",
          "expected": "Dialogs should have notification checkboxes for Author/Reviewers and Administrators",
          "actual": "Both 'Notify Author and Reviewers of state changes' and 'Notify Administrators of state changes' checkboxes are available in the dialog",
          "screenshot": "Workflow State Management_step07_edit_changes_made.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Validate empty state name",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Open Add State dialog with empty name field",
          "expected": "Dialog should open with empty State Name field",
          "actual": "Dialog opened with empty State Name field",
          "screenshot": "Workflow State Management_step19_empty_name_dialog.png"
        },
        {
          "step_number": 2,
          "action": "Click Accept without entering a name",
          "expected": "Validation error should appear indicating field is required",
          "actual": "Validation error 'This field is required.' appeared correctly",
          "screenshot": "Workflow State Management_step20_empty_validation_error.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test special characters (XSS) in state name",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Enter '<script>alert('XSS')</script>' as state name",
          "expected": "System should sanitize or reject the XSS payload",
          "actual": "System accepted the XSS script as the state name without sanitization",
          "screenshot": "Workflow State Management_step21_special_chars_input.png"
        },
        {
          "step_number": 2,
          "action": "Click Accept to save the state",
          "expected": "State should be rejected or XSS should be escaped",
          "actual": "State was created with XSS script as the name, displayed as HTML-encoded text in the table",
          "screenshot": "Workflow State Management_step22_xss_state_created.png"
        },
        {
          "step_number": 3,
          "action": "Click Delete button on the XSS-named state",
          "expected": "Delete confirmation should appear without executing script",
          "actual": "XSS alert('XSS') dialog was triggered before the delete confirmation appeared, indicating stored XSS vulnerability",
          "screenshot": "Workflow State Management_step23_xss_delete_confirm.png"
        }
      ],
      "issues": [
        "SECURITY VULNERABILITY: Stored XSS - JavaScript in state names is executed when interacting with the delete button",
        "Input validation does not sanitize or reject script tags in state names",
        "Recommend implementing input sanitization to strip or encode HTML/JavaScript in state names"
      ]
    }
  ],
  "observations": [
    "The workflow states UI uses KnockoutJS for data binding",
    "System states (Draft and Published) cannot be deleted and do not show delete buttons",
    "Move buttons are implemented using CSS classes .moveUp and .moveDown accessed via JavaScript",
    "Default workflows marked 'in use' have the 'Add a State' button disabled to prevent modification",
    "State permissions can be configured per role/user with Review capability checkboxes",
    "The API endpoints (Create, Edit, ConmuteStates for move, Delete) are protected with ValidateAntiForgeryToken",
    "WorkflowStatesController.cs at line 295-320 handles Delete operation with WorkflowException handling",
    "State name validation in WorkflowState entity uses Data Annotations but does not appear to validate against XSS"
  ],
  "summary": {
    "total_scenarios": 10,
    "passed": 9,
    "failed": 1,
    "pass_rate": "90%"
  }
}
