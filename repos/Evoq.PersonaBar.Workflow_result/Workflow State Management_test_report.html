<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Workflow State Management</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        h3 {
            color: #2980b9;
        }
        .summary {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-case {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .pass {
            color: #27ae60;
            font-weight: bold;
        }
        .fail {
            color: #e74c3c;
            font-weight: bold;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-pass {
            background-color: #27ae60;
            color: white;
        }
        .status-fail {
            background-color: #e74c3c;
            color: white;
        }
        img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .steps {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .observations {
            background: #fef9e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-top: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Test Report: Workflow State Management</h1>

    <div class="summary">
        <h2>Summary</h2>
        <table>
            <tr>
                <th>Property</th>
                <th>Value</th>
            </tr>
            <tr>
                <td>Extension</td>
                <td>Evoq.PersonaBar.Workflow</td>
            </tr>
            <tr>
                <td>Feature</td>
                <td>Workflow State Management</td>
            </tr>
            <tr>
                <td>Priority</td>
                <td>Top (Exhaustive Testing)</td>
            </tr>
            <tr>
                <td>Test Date</td>
                <td>2026-01-06</td>
            </tr>
            <tr>
                <td>Total Tests</td>
                <td>8</td>
            </tr>
            <tr>
                <td>Passed</td>
                <td><span class="pass">8</span></td>
            </tr>
            <tr>
                <td>Failed</td>
                <td><span class="fail">0</span></td>
            </tr>
            <tr>
                <td>Overall Result</td>
                <td><span class="status-badge status-pass">PASS</span></td>
            </tr>
        </table>
    </div>

    <h2>Feature Description</h2>
    <p>Manage workflow states including creating, editing, reordering, and deleting states within workflows. This feature allows administrators to customize the document approval process by configuring workflow states with specific reviewers and notification settings.</p>

    <!-- Test Case 1 -->
    <div class="test-case">
        <h3>Test 1: Create New Workflow State</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Create a new workflow state in Test Approval Workflow</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to Settings > Workflow</li>
                <li>Expand Test Approval Workflow</li>
                <li>Click "Add a State" button</li>
                <li>Enter state name "Review State"</li>
                <li>Click Accept to save</li>
            </ol>
        </div>
        <p><strong>Result:</strong> New state "Review State" was created successfully and appears in the workflow states list.</p>
        <img src="Workflow_State_Management_step02_add_state_dialog.png" alt="Add State Dialog">
        <img src="Workflow_State_Management_step03_state_created.png" alt="State Created">
    </div>

    <!-- Test Case 2 -->
    <div class="test-case">
        <h3>Test 2: Edit State Name and Notification Settings</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Edit an existing workflow state's name and notification settings</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Click the Edit (E) icon for "Review State"</li>
                <li>Change name to "Review State Updated"</li>
                <li>Enable "Notify Author" checkbox</li>
                <li>Enable "Notify Administrators" checkbox</li>
                <li>Click Accept to save changes</li>
            </ol>
        </div>
        <p><strong>Result:</strong> State name was updated and notification settings were saved successfully.</p>
        <img src="Workflow_State_Management_step04_edit_dialog.png" alt="Edit Dialog">
        <img src="Workflow_State_Management_step05_edit_with_changes.png" alt="Edit With Changes">
        <img src="Workflow_State_Management_step06_edit_saved.png" alt="Edit Saved">
    </div>

    <!-- Test Case 3 -->
    <div class="test-case">
        <h3>Test 3: Move State Up in Order</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Move a workflow state up in the order</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Add a fourth state "Final Review" to enable move functionality</li>
                <li>Click the Move Up arrow for the state</li>
                <li>Verify the state order changes</li>
            </ol>
        </div>
        <p><strong>Result:</strong> State was successfully moved up. Order changed from position 3 to position 2.</p>
        <img src="Workflow_State_Management_step08_four_states.png" alt="Four States">
        <img src="Workflow_State_Management_step10_moved_up.png" alt="Moved Up">
    </div>

    <!-- Test Case 4 -->
    <div class="test-case">
        <h3>Test 4: Move State Down in Order</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Move a workflow state down in the order</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Locate the state to move down</li>
                <li>Click the Move Down arrow</li>
                <li>Verify the state order changes</li>
            </ol>
        </div>
        <p><strong>Result:</strong> State was successfully moved down. "Final Review" moved from position 2 to position 3.</p>
        <img src="Workflow_State_Management_step12_move_down_success.png" alt="Move Down Success">
    </div>

    <!-- Test Case 5 -->
    <div class="test-case">
        <h3>Test 5: Delete Unused Workflow State</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Delete a workflow state that is not in use</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Click the Delete (D) icon for "Final Review" state</li>
                <li>Confirm deletion in the confirmation dialog</li>
                <li>Verify the state is removed from the list</li>
            </ol>
        </div>
        <p><strong>Result:</strong> State was deleted successfully. The workflow now shows only 3 states.</p>
        <img src="Workflow_State_Management_step13_delete_confirmation.png" alt="Delete Confirmation">
        <img src="Workflow_State_Management_step14_delete_success.png" alt="Delete Success">
    </div>

    <!-- Test Case 6 -->
    <div class="test-case">
        <h3>Test 6: Attempt to Delete State in Use - Verify Protection</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Verify that states in workflows that are "in use" cannot be deleted</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to Content Approval workflow (marked "IN USE")</li>
                <li>Observe that the Delete button is hidden for middle states</li>
                <li>View the "This workflow is currently in use" message</li>
                <li>Click "View Usage" to see what content is using the workflow</li>
            </ol>
        </div>
        <p><strong>Result:</strong> The UI correctly prevents deletion by hiding delete buttons for states in workflows that are in use. The "View Usage" feature shows 9 items using the workflow (4 Publisher Posts and 5 Pages).</p>
        <img src="Workflow_State_Management_step15_state_in_use_protection.png" alt="State In Use Protection">
        <img src="Workflow_State_Management_step16_workflow_usage.png" alt="Workflow Usage">
    </div>

    <!-- Test Case 7 -->
    <div class="test-case">
        <h3>Test 7: Configure State Notification Settings</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Test the notification configuration options for workflow states</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Edit the "Review State Updated" state</li>
                <li>Verify notification checkboxes are present:
                    <ul>
                        <li>"Notify Author and Reviewers of state changes"</li>
                        <li>"Notify Administrators of state changes"</li>
                    </ul>
                </li>
                <li>Toggle the "Notify Administrators" checkbox off</li>
                <li>Click Accept to save</li>
            </ol>
        </div>
        <p><strong>Result:</strong> Notification settings can be configured and saved successfully. Both checkboxes are functional.</p>
        <img src="Workflow_State_Management_step19_scroll_attempt.png" alt="Notification Settings Visible">
        <img src="Workflow_State_Management_step20_notification_unchecked.png" alt="Notification Unchecked">
    </div>

    <!-- Test Case 8 -->
    <div class="test-case">
        <h3>Test 8: Edge Cases - Validation and Special Characters</h3>
        <p><strong>Status:</strong> <span class="status-badge status-pass">PASS</span></p>
        <p><strong>Description:</strong> Test validation for empty names and handling of special characters</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Click "Add a State"</li>
                <li>Attempt to save with empty name - verify validation error</li>
                <li>Enter special characters: Test &lt;State&gt; &amp; "Special" 'Chars'</li>
                <li>Click Accept to save</li>
                <li>Verify the state is created with special characters displayed correctly</li>
            </ol>
        </div>
        <p><strong>Result:</strong></p>
        <ul>
            <li><strong>Empty Name Validation:</strong> Error message "This field is required." is displayed correctly</li>
            <li><strong>Special Characters:</strong> State with special characters (&lt;, &gt;, &amp;, ", ') was created and displays correctly</li>
        </ul>
        <img src="Workflow_State_Management_step21_validation_error.png" alt="Validation Error">
        <img src="Workflow_State_Management_step22_special_chars_input.png" alt="Special Chars Input">
    </div>

    <!-- Observations -->
    <div class="observations">
        <h2>Observations</h2>
        <ul>
            <li><strong>Reviewer Permissions:</strong> The state edit dialog includes a comprehensive role-based permission system where administrators can specify which roles can review content at each workflow state.</li>
            <li><strong>User-Level Permissions:</strong> In addition to role-based permissions, specific users can be added as reviewers for individual states.</li>
            <li><strong>Move Functionality:</strong> The move up/down arrows only appear for middle states when there are 4+ states in the workflow. First and last states cannot be moved.</li>
            <li><strong>System Workflows:</strong> System workflows (Direct Publish, Save Draft, Content Approval) have the "Add a State" button disabled when in use, preventing modifications to their structure.</li>
            <li><strong>State Order Persistence:</strong> State order changes are persisted immediately after clicking the move buttons.</li>
            <li><strong>XSS Protection:</strong> Special characters are properly escaped/encoded when displayed in the UI, preventing XSS vulnerabilities.</li>
        </ul>
    </div>

    <h2>Test Environment</h2>
    <table>
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Website URL</td>
            <td>http://localhost:8081</td>
        </tr>
        <tr>
            <td>User</td>
            <td>host (SuperUser)</td>
        </tr>
        <tr>
            <td>UI Location</td>
            <td>Settings > Workflow > [Select Workflow] > States</td>
        </tr>
        <tr>
            <td>Repository</td>
            <td>Dnn.AdminExperience.Evoq.Basic</td>
        </tr>
    </table>

</body>
</html>
