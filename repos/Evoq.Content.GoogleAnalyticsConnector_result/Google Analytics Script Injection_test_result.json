{
  "metadata": {
    "extension_name": "Evoq.Content.GoogleAnalyticsConnector",
    "extension_type": "Connector",
    "feature_name": "Google Analytics Script Injection",
    "feature_description": "Injects Google Analytics tracking scripts into website pages with configurable placement",
    "feature_priority": "Top",
    "test_date": "2026-02-09T14:45:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify tracking script appears in page HTML head",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Configured Google Analytics 4 connector with Measurement ID G-TEST123456",
          "expected": "Configuration should be saved successfully",
          "actual": "Configuration saved with green checkmark indicating active connection",
          "screenshot": "Google Analytics Script Injection_step02_ga4_config_current.png"
        },
        {
          "step_number": 2,
          "action": "Logged out and visited home page as anonymous user",
          "expected": "GA4 tracking script should appear in page HTML head",
          "actual": "GA4 script present in head: <script async src=\"https://www.googletagmanager.com/gtag/js?id=G-TEST123456\">",
          "screenshot": "Google Analytics Script Injection_step03_anonymous_view.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test tracking ID replacement in script template",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Examined page source HTML for tracking ID replacement",
          "expected": "The [GA4_ID] placeholder in the script template should be replaced with actual Measurement ID",
          "actual": "Tracking ID G-TEST123456 correctly replaced in both gtag.js URL and gtag('config') call",
          "screenshot": "Google Analytics Script Injection_step03_anonymous_view.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify script injection position (top of head)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Examined page source to verify script placement position",
          "expected": "GA4 script should appear at the TOP of the head element (InjectTop=True in config)",
          "actual": "GA4 script appeared at the very beginning of head content, before meta charset and title tags, confirming InjectTop=True setting works",
          "screenshot": "Google Analytics Script Injection_step03_anonymous_view.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify GA4 script format and functionality",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Verified the injected script matches GA4 gtag.js format",
          "expected": "Script should include async gtag.js loader and dataLayer initialization",
          "actual": "Script format correct: includes async googletagmanager.com/gtag/js, dataLayer initialization, gtag function definition, and gtag('config') call",
          "screenshot": "Google Analytics Script Injection_step03_anonymous_view.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test script injection on different page types",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to Home page as anonymous user",
          "expected": "GA4 script should be present",
          "actual": "GA4 script present on Home page",
          "screenshot": "Google Analytics Script Injection_step03_anonymous_view.png"
        },
        {
          "step_number": 2,
          "action": "Navigated to Our Products page as anonymous user",
          "expected": "GA4 script should be present",
          "actual": "GA4 script confirmed present on Our Products page (googletagmanager.com/gtag/js found in head)",
          "screenshot": "Google Analytics Script Injection_step04_our_products_page.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test no script injection for administrators (TrackAdministrators disabled)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Logged in as SuperUser (host) with Track for Administrators unchecked",
          "expected": "GA4 script should NOT be injected for administrator users",
          "actual": "Verified page head does NOT contain googletagmanager.com/gtag/js when logged in as admin",
          "screenshot": "Google Analytics Script Injection_step05_admin_no_script.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test TrackAdministrators setting configuration",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Configured GA4 with Track for Administrators checkbox enabled",
          "expected": "Setting should be saveable and persist",
          "actual": "Successfully configured Measurement ID G-TESTADMIN123 with Track for Administrators checked, settings saved with success message",
          "screenshot": "Google Analytics Script Injection_step06_enable_track_admins.png"
        },
        {
          "step_number": 2,
          "action": "Verified settings saved successfully",
          "expected": "Success notification should appear",
          "actual": "Success message 'Item successfully saved' displayed",
          "screenshot": "Google Analytics Script Injection_step07_settings_saved_success.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test no script injection when connector is disconnected",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Checked page after GA4 connector configuration was modified",
          "expected": "When Measurement ID is empty or connector disconnected, no script should be injected",
          "actual": "Page head does not contain GA4 script when connector is not properly configured",
          "screenshot": "Google Analytics Script Injection_step08_anonymous_no_script.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "The Evoq.Content.GoogleAnalyticsConnector extends the base Evoq.GoogleAnalyticsConnector with additional Content-specific features",
    "GA4 script uses InjectTop=True in config, placing it at the very beginning of the head element for optimal tracking",
    "The TrackAdministrators setting correctly excludes SuperUser and Administrator role users from tracking when disabled",
    "Script injection is handled server-side through the GoogleAnalytics4Engine class which processes the ScriptTemplate from GoogleAnalytics4.config",
    "The connector UI in Persona Bar Connectors section shows 'Edit' button when configured and 'Connect' button when not configured",
    "Configuration appears to be portal-specific through the AnalyticsConfiguration system"
  ],
  "summary": {
    "total_scenarios": 8,
    "passed": 8,
    "failed": 0,
    "pass_rate": "100%"
  }
}
