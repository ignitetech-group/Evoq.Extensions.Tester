<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Portal Configuration Support - Test Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        h3 {
            color: #7f8c8d;
        }
        .feature-info {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .feature-info table {
            width: 100%;
            border-collapse: collapse;
        }
        .feature-info td {
            padding: 8px 15px;
            border-bottom: 1px solid #bdc3c7;
        }
        .feature-info td:first-child {
            font-weight: bold;
            width: 200px;
            color: #2c3e50;
        }
        .test-scenario {
            margin: 25px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .test-scenario h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .status.pass {
            background: #27ae60;
            color: white;
        }
        .status.fail {
            background: #e74c3c;
            color: white;
        }
        .status.partial {
            background: #f39c12;
            color: white;
        }
        .screenshot {
            margin: 15px 0;
            text-align: center;
        }
        .screenshot img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .screenshot-caption {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 8px;
        }
        .steps {
            background: #fff;
            padding: 15px;
            border-left: 3px solid #3498db;
            margin: 15px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .steps li {
            margin: 8px 0;
        }
        .observations {
            background: #fff9e6;
            padding: 15px;
            border-left: 3px solid #f39c12;
            margin: 15px 0;
        }
        .api-results {
            font-family: 'Consolas', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .api-results table {
            width: 100%;
            border-collapse: collapse;
        }
        .api-results th, .api-results td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #34495e;
        }
        .api-results th {
            color: #3498db;
        }
        .summary {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }
        .summary h2 {
            color: white;
            border-left-color: #3498db;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .summary-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .summary-item .number {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
        }
        .code-block {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Multi-Portal Configuration Support - Test Report</h1>

        <div class="feature-info">
            <table>
                <tr>
                    <td>Extension:</td>
                    <td>Evoq.PersonaBar.SiteSettings (PersonaBar Module)</td>
                </tr>
                <tr>
                    <td>Feature Name:</td>
                    <td>Multi-Portal Configuration Support</td>
                </tr>
                <tr>
                    <td>Feature Priority:</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>Description:</td>
                    <td>Supports configuration of settings across multiple portals in a DNN installation</td>
                </tr>
                <tr>
                    <td>UI Location:</td>
                    <td>Admin > Settings > Site Settings (with portal selector)</td>
                </tr>
                <tr>
                    <td>Relevant Files:</td>
                    <td>Services/EvoqSiteSettingsController.cs, Components/EvoqSiteSettingsController.cs</td>
                </tr>
                <tr>
                    <td>Test Date:</td>
                    <td>December 30, 2025</td>
                </tr>
            </table>
        </div>

        <h2>Code Analysis Summary</h2>
        <p>The Multi-Portal Configuration Support feature is implemented through the following key mechanisms:</p>
        <div class="code-block">
            <strong>GetSettingsPortalId() Method (Services/EvoqSiteSettingsController.cs:464-467)</strong><br>
            <code>
private int GetSettingsPortalId(int portalId)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return portalId > -1 ? portalId : PortalId;<br>
}
            </code>
        </div>
        <ul>
            <li><strong>Default Portal ID (-1):</strong> When portalId=-1 is passed, the current portal's ID is used</li>
            <li><strong>Specific Portal ID:</strong> When a specific portalId is passed (>-1), that portal's settings are accessed</li>
            <li><strong>All API endpoints</strong> accept the portalId parameter for cross-portal configuration</li>
        </ul>

        <h2>Test Scenarios</h2>

        <!-- Test Scenario 1 -->
        <div class="test-scenario">
            <h3>1. Login and Navigate to Site Settings</h3>
            <span class="status pass">PASS</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>Navigated to http://localhost:8081/Login</li>
                    <li>Logged in as host user (superuser)</li>
                    <li>Accessed Site Settings via PersonaBar</li>
                </ol>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step01_login_page.png" alt="Login Page">
                <div class="screenshot-caption">Figure 1: DNN Login Page</div>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step02_site_settings.png" alt="Site Settings">
                <div class="screenshot-caption">Figure 2: Site Settings Panel showing Portal 0 (My Website)</div>
            </div>

            <div class="observations">
                <strong>Observations:</strong> Successfully logged in and accessed Site Settings. The Home Directory shows "Portals/0" indicating Portal ID 0.
            </div>
        </div>

        <!-- Test Scenario 2 -->
        <div class="test-scenario">
            <h3>2. View Sites Management and Create Second Portal</h3>
            <span class="status pass">PASS</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>Navigated to Manage > Sites</li>
                    <li>Observed existing portal "My Website"</li>
                    <li>Clicked "Add New Site"</li>
                    <li>Created "Test Portal" with directory site type</li>
                </ol>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step03_sites_management.png" alt="Sites Management">
                <div class="screenshot-caption">Figure 3: Sites Management - Initial state with one portal</div>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step04_add_new_site_form.png" alt="Add New Site Form">
                <div class="screenshot-caption">Figure 4: Add New Site form with configuration options</div>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step05_two_portals.png" alt="Two Portals">
                <div class="screenshot-caption">Figure 5: Sites Management showing both portals - My Website (Portal 0) and Test Portal (Portal 1)</div>
            </div>

            <div class="observations">
                <strong>Observations:</strong>
                <ul>
                    <li>Successfully created second portal "Test Portal"</li>
                    <li>Portal 0 (My Website): 2 users, 49 pages</li>
                    <li>Portal 1 (Test Portal): 1 user, 28 pages</li>
                </ul>
            </div>
        </div>

        <!-- Test Scenario 3 -->
        <div class="test-scenario">
            <h3>3. Switch Between Different Portals and Verify Portal-Specific Settings</h3>
            <span class="status pass">PASS</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>Clicked Site Settings for "Test Portal"</li>
                    <li>Verified unique settings: Site Title, GUID, Home Directory</li>
                    <li>Compared with Portal 0 settings</li>
                </ol>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step06_test_portal_settings.png" alt="Test Portal Settings">
                <div class="screenshot-caption">Figure 6: Test Portal (Portal 1) Site Settings - Note different GUID and Home Directory</div>
            </div>

            <div class="observations">
                <strong>Portal Settings Comparison:</strong>
                <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
                    <tr style="background: #ecf0f1;">
                        <th style="padding: 10px; border: 1px solid #ddd;">Setting</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">My Website (Portal 0)</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">Test Portal (Portal 1)</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">Site Title</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">My Website</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Test Portal</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">GUID</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">5CC8BD37-15D6-4F0D-A000-B8740E57C851</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">99D361B4-4A4B-41C7-9611-0FD8CC777F32</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">Home Directory</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Portals/0</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Portals/1</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Test Scenario 4 -->
        <div class="test-scenario">
            <h3>4. Save Settings for Non-Current Portal</h3>
            <span class="status pass">PASS</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>While viewing Test Portal settings, added description: "Test Portal for Multi-Portal Configuration Testing"</li>
                    <li>Clicked Save button</li>
                    <li>Verified success message appeared</li>
                </ol>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step07_settings_saved.png" alt="Settings Saved">
                <div class="screenshot-caption">Figure 7: Settings saved successfully for Test Portal</div>
            </div>

            <div class="observations">
                <strong>Observations:</strong> Successfully saved description for Test Portal (non-current portal) while logged into Portal 0. The success message "Settings have been updated" confirmed the save operation.
            </div>
        </div>

        <!-- Test Scenario 5 -->
        <div class="test-scenario">
            <h3>5. Verify Settings Isolation Between Portals</h3>
            <span class="status pass">PASS</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>Navigated back to Sites list</li>
                    <li>Opened Site Settings for "My Website" (Portal 0)</li>
                    <li>Verified Description field is empty (not affected by Test Portal's description)</li>
                </ol>
            </div>

            <div class="screenshot">
                <img src="Multi-Portal_Configuration_Support_step08_portal_isolation_verified.png" alt="Portal Isolation Verified">
                <div class="screenshot-caption">Figure 8: My Website (Portal 0) settings - Description remains empty, confirming isolation</div>
            </div>

            <div class="observations">
                <strong>Observations:</strong> Changes made to Test Portal's description did NOT affect My Website's description. This confirms that settings are properly isolated between portals.
            </div>
        </div>

        <!-- Test Scenario 6 -->
        <div class="test-scenario">
            <h3>6. Test API with Default Portal ID (-1)</h3>
            <span class="status pass">PASS</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>Called API: /API/PersonaBar/EvoqSiteSettings/GetCrawlSettings?portalId=-1</li>
                    <li>Verified response returns current portal's settings</li>
                </ol>
            </div>

            <div class="api-results">
                <table>
                    <tr>
                        <th>Test Case</th>
                        <th>Portal ID</th>
                        <th>HTTP Status</th>
                        <th>Result</th>
                    </tr>
                    <tr>
                        <td>Default Portal ID</td>
                        <td>-1</td>
                        <td>200 OK</td>
                        <td style="color: #2ecc71;">PASS - Uses current portal</td>
                    </tr>
                    <tr>
                        <td>Portal 0</td>
                        <td>0</td>
                        <td>200 OK</td>
                        <td style="color: #2ecc71;">PASS - Returns Portal 0 data</td>
                    </tr>
                    <tr>
                        <td>Portal 1</td>
                        <td>1</td>
                        <td>200 OK</td>
                        <td style="color: #2ecc71;">PASS - Returns Portal 1 data</td>
                    </tr>
                </table>
            </div>

            <div class="observations">
                <strong>Observations:</strong> The API correctly handles the default portalId (-1) by using the current portal's ID, as implemented in the GetSettingsPortalId() method.
            </div>
        </div>

        <!-- Test Scenario 7 -->
        <div class="test-scenario">
            <h3>7. Test API with Invalid Portal ID</h3>
            <span class="status partial">PARTIAL</span>

            <div class="steps">
                <strong>Steps Taken:</strong>
                <ol>
                    <li>Called API: /API/PersonaBar/EvoqSiteSettings/GetCrawlSettings?portalId=9999</li>
                    <li>Observed error response</li>
                </ol>
            </div>

            <div class="api-results">
                <table>
                    <tr>
                        <th>Test Case</th>
                        <th>Portal ID</th>
                        <th>HTTP Status</th>
                        <th>Result</th>
                    </tr>
                    <tr>
                        <td>Invalid Portal ID</td>
                        <td>9999</td>
                        <td>500 Internal Server Error</td>
                        <td style="color: #f39c12;">PARTIAL - Returns error for non-existent portal</td>
                    </tr>
                </table>
            </div>

            <div class="observations">
                <strong>Observations:</strong> The API returns a 500 Internal Server Error when an invalid portal ID is provided. This is expected behavior but could be improved with more graceful error handling (e.g., returning 404 Not Found or a user-friendly error message).
            </div>
        </div>

        <!-- Summary -->
        <div class="summary">
            <h2>Test Summary</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="number">7</div>
                    <div>Total Tests</div>
                </div>
                <div class="summary-item">
                    <div class="number" style="color: #2ecc71;">6</div>
                    <div>Passed</div>
                </div>
                <div class="summary-item">
                    <div class="number" style="color: #f39c12;">1</div>
                    <div>Partial</div>
                </div>
                <div class="summary-item">
                    <div class="number" style="color: #e74c3c;">0</div>
                    <div>Failed</div>
                </div>
            </div>

            <h3 style="color: white; margin-top: 25px;">Overall Result: <span style="color: #2ecc71;">PASS</span></h3>

            <h3 style="color: white; margin-top: 25px;">Key Findings:</h3>
            <ul>
                <li><strong>Portal Switching:</strong> Superusers can successfully switch between different portals and access their settings</li>
                <li><strong>Portal-Specific Settings:</strong> Each portal maintains its own unique settings (Site Title, GUID, Home Directory, Description, etc.)</li>
                <li><strong>Settings Isolation:</strong> Changes to one portal's settings do NOT affect other portals</li>
                <li><strong>Cross-Portal Configuration:</strong> Settings can be saved for non-current portals</li>
                <li><strong>Default Portal ID (-1):</strong> API correctly resolves -1 to the current portal's ID</li>
                <li><strong>Invalid Portal ID:</strong> API returns 500 error for non-existent portals (could be improved)</li>
            </ul>

            <h3 style="color: white; margin-top: 25px;">Recommendations:</h3>
            <ul>
                <li>Consider returning a more descriptive error (404 Not Found or validation error) for invalid portal IDs instead of 500 Internal Server Error</li>
                <li>Add input validation to reject obviously invalid portal IDs before attempting to access portal data</li>
            </ul>
        </div>
    </div>
</body>
</html>
