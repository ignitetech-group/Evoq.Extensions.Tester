<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Search Crawling Included Directory Management</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0078d4;
            padding-bottom: 10px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
        }
        h3 {
            color: #555;
        }
        .feature-info {
            background-color: #e7f3ff;
            border-left: 4px solid #0078d4;
            padding: 15px;
            margin: 20px 0;
        }
        .test-case {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .pass {
            background-color: #28a745;
            color: white;
        }
        .fail {
            background-color: #dc3545;
            color: white;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .steps {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .observations {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
        .summary {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>Test Report: Search Crawling Included Directory Management</h1>

    <div class="feature-info">
        <h3>Feature Details</h3>
        <table>
            <tr><th>Extension</th><td>Evoq.PersonaBar.SiteSettings</td></tr>
            <tr><th>Feature Name</th><td>Search Crawling Included Directory Management</td></tr>
            <tr><th>Description</th><td>Manages directories that should be included in search crawling operations</td></tr>
            <tr><th>UI Location</th><td>Admin > Settings > Site Settings > Search > Crawling > Included Directories</td></tr>
            <tr><th>Priority</th><td>Medium</td></tr>
            <tr><th>Test Date</th><td>2026-01-06</td></tr>
        </table>
    </div>

    <div class="summary">
        <h3>Test Summary</h3>
        <table>
            <tr><th>Total Tests</th><th>Passed</th><th>Failed</th></tr>
            <tr><td>4</td><td>4</td><td>0</td></tr>
        </table>
    </div>

    <h2>Test Results</h2>

    <!-- Test 1 -->
    <div class="test-case">
        <h3>Test 1: View List of Included Directories <span class="status pass">PASS</span></h3>
        <p><strong>Description:</strong> Verify that the list of included directories is displayed with directory paths.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Navigate to Admin > Settings > Site Settings</li>
                <li>Click on the "Search" tab</li>
                <li>Click on the "Crawling" sub-tab</li>
                <li>Scroll to view the "Included Directories" section</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Included directories list is displayed with directory paths.</p>
        <p><strong>Actual Result:</strong> The Included Directories section displays "Badges/" with a trash icon for deletion. The directory path is clearly visible.</p>

        <img src="Search Crawling Included Directory Management_step02_included_directories.png" alt="Included Directories List" class="screenshot">
    </div>

    <!-- Test 2 -->
    <div class="test-case">
        <h3>Test 2: Folder Picker UI Functionality <span class="status pass">PASS</span></h3>
        <p><strong>Description:</strong> Verify that the folder picker opens and displays available directories when adding a new directory.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Click the "+ Add Directory" button in the Included Directories section</li>
                <li>Observe the folder picker UI</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> A folder picker/tree should open showing available directories.</p>
        <p><strong>Actual Result:</strong> The folder picker opens displaying a tree structure with Site Root and all available folders (Badges, Groups, Images, PermissionsTestFolder, Templates, TestNewFolder2026, Users, etc.). Cancel and Save buttons are available.</p>

        <img src="Search Crawling Included Directory Management_step03_folder_picker.png" alt="Folder Picker UI" class="screenshot">
        <img src="Search Crawling Included Directory Management_step04_folder_tree.png" alt="Folder Tree Displayed" class="screenshot">
    </div>

    <!-- Test 3 -->
    <div class="test-case">
        <h3>Test 3: Validation - Required Folder Selection <span class="status pass">PASS</span></h3>
        <p><strong>Description:</strong> Verify that validation error appears when trying to save without selecting a folder.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Open the Add Directory form</li>
                <li>Without selecting a folder, click the Save button</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> An error notification should appear indicating a folder must be selected.</p>
        <p><strong>Actual Result:</strong> Error notification "Please select a folder." is displayed, preventing save without proper folder selection.</p>

        <img src="Search Crawling Included Directory Management_step05_validation_error.png" alt="Validation Error" class="screenshot">
    </div>

    <!-- Test 4 -->
    <div class="test-case">
        <h3>Test 4: Deletion Confirmation Dialog <span class="status pass">PASS</span></h3>
        <p><strong>Description:</strong> Verify that a confirmation dialog appears when attempting to delete an included directory.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Click the trash/delete icon next to "Badges/" in the Included Directories list</li>
                <li>Observe the confirmation dialog</li>
                <li>Click "No" to cancel the deletion</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> A confirmation dialog should appear with the directory name and Yes/No options.</p>
        <p><strong>Actual Result:</strong> Confirmation dialog appears with warning icon and message "Are you sure you want to delete Badges/?" with "No" and "Yes" buttons. The dialog includes the directory name for clear identification.</p>

        <img src="Search Crawling Included Directory Management_step07_delete_confirmation.png" alt="Delete Confirmation Dialog" class="screenshot">
    </div>

    <h2>Observations</h2>
    <div class="observations">
        <ul>
            <li><strong>Folder Picker Component:</strong> The folder picker uses a React-based tree component (dnn-folder-picker) that displays folders hierarchically. The component includes a search textbox for filtering folders.</li>
            <li><strong>Portal-Specific Lists:</strong> Based on code review, the directory lists are portal-specific, fetched via the GetCrawlSettings API endpoint which filters by portal ID.</li>
            <li><strong>Event Handling:</strong> The folder selection in the React component uses synthetic events that require specific interaction patterns. Direct DOM clicks may not trigger the React state updates needed for selection.</li>
            <li><strong>Confirmation Dialog:</strong> The delete confirmation uses a utils.confirm() helper that shows a styled modal with the directory name dynamically inserted into the warning message.</li>
            <li><strong>API Endpoints:</strong> The feature uses POST endpoints for SaveCrawlIncludedDirectory and DeleteCrawlIncludedDirectory with CSRF validation (ValidateAntiForgeryToken).</li>
        </ul>
    </div>

    <h2>Test Environment</h2>
    <table>
        <tr><th>Website URL</th><td>http://localhost:8081</td></tr>
        <tr><th>User</th><td>host (SuperUser)</td></tr>
        <tr><th>Browser</th><td>Chromium (via Playwright)</td></tr>
        <tr><th>Viewport</th><td>1280x720</td></tr>
    </table>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
        <p>Generated by Claude Code - Automated Testing Framework</p>
        <p>Test execution completed: 2026-01-06</p>
    </footer>
</body>
</html>
