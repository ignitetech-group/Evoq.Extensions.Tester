<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Search Crawling Included Directory Management</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }
        .header p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .summary-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .summary-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .stat {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat.passed {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .stat.failed {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .stat.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }
        .stat h3 {
            margin: 0;
            font-size: 32px;
        }
        .stat p {
            margin: 5px 0 0 0;
            color: #666;
        }
        .test-scenario {
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .scenario-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .scenario-header.passed {
            background: #28a745;
            color: white;
        }
        .scenario-header.failed {
            background: #dc3545;
            color: white;
        }
        .scenario-header.observation {
            background: #ffc107;
            color: #333;
        }
        .scenario-header h2 {
            margin: 0;
            font-size: 18px;
        }
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .passed .status-badge {
            background: rgba(255,255,255,0.2);
        }
        .failed .status-badge {
            background: rgba(255,255,255,0.2);
        }
        .observation .status-badge {
            background: rgba(0,0,0,0.1);
        }
        .scenario-content {
            padding: 20px;
        }
        .steps {
            margin: 0 0 20px 0;
            padding: 0;
        }
        .steps li {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            list-style-position: inside;
        }
        .screenshot-container {
            margin: 15px 0;
        }
        .screenshot-container img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .screenshot-container img:hover {
            transform: scale(1.02);
        }
        .screenshot-caption {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        .observations {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .observations h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        .feature-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2a5298;
        }
        .info-card h4 {
            margin: 0 0 10px 0;
            color: #2a5298;
        }
        .info-card p {
            margin: 0;
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Test Report: Search Crawling Included Directory Management</h1>
        <p><strong>Extension:</strong> Evoq.PersonaBar.SiteSettings (PersonaBar Module)</p>
        <p><strong>Feature Priority:</strong> Medium</p>
        <p><strong>Test Date:</strong> December 30, 2024</p>
        <p><strong>UI Location:</strong> Admin &gt; Settings &gt; Site Settings &gt; Search &gt; Crawling &gt; Included Directories</p>
    </div>

    <div class="summary-box">
        <h2>Test Summary</h2>
        <div class="summary-stats">
            <div class="stat passed">
                <h3>6</h3>
                <p>Passed</p>
            </div>
            <div class="stat failed">
                <h3>0</h3>
                <p>Failed</p>
            </div>
            <div class="stat info">
                <h3>14</h3>
                <p>Screenshots</p>
            </div>
        </div>
    </div>

    <div class="summary-box">
        <h2>Feature Description</h2>
        <p>Manages directories that should be included in search crawling operations. This feature allows administrators to specify which folders within the DNN file system should have their contents indexed by the search crawler.</p>

        <div class="feature-info">
            <div class="info-card">
                <h4>Key Files</h4>
                <p>Services/EvoqSiteSettingsController.cs<br>
                Components/EvoqSiteSettingsController.cs<br>
                Components/Dto/CrawlerDirectoryDto.cs<br>
                DirectoryList/index.jsx</p>
            </div>
            <div class="info-card">
                <h4>Dependencies</h4>
                <p>DotNetNuke.Professional.SearchCrawler<br>
                DNN Folder Manager<br>
                SearchSpiderHelper</p>
            </div>
            <div class="info-card">
                <h4>API Endpoints</h4>
                <p>POST /API/EvoqSiteSettings/SaveCrawlIncludedDirectory<br>
                POST /API/EvoqSiteSettings/DeleteCrawlIncludedDirectory<br>
                GET /API/EvoqSiteSettings/GetCrawlSettings</p>
            </div>
        </div>
    </div>

    <!-- Test Scenario 1 -->
    <div class="test-scenario">
        <div class="scenario-header passed">
            <h2>Scenario 1: View List of All Included Directories</h2>
            <span class="status-badge">PASSED</span>
        </div>
        <div class="scenario-content">
            <h3>Steps Taken</h3>
            <ol class="steps">
                <li>Navigate to http://localhost:8081/default.aspx</li>
                <li>Log in as superuser (host/Pass123456)</li>
                <li>Open PersonaBar and navigate to Settings &gt; Site Settings</li>
                <li>Click on the "Search" tab</li>
                <li>Click on "Crawling" sub-tab</li>
                <li>Locate "Included Directories" section</li>
            </ol>

            <h3>Screenshots</h3>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step01_homepage.png" alt="Homepage">
                <p class="screenshot-caption">Step 1: DNN Homepage</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step02_login_page.png" alt="Login Page">
                <p class="screenshot-caption">Step 2: Login page</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step03_logged_in.png" alt="Logged In">
                <p class="screenshot-caption">Step 3: Successfully logged in</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step04_crawling_tab.png" alt="Crawling Tab">
                <p class="screenshot-caption">Step 4: Crawling settings tab</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step05_included_directories.png" alt="Included Directories">
                <p class="screenshot-caption">Step 5: Included Directories section showing "Site Root" as initially included</p>
            </div>

            <h3>Result</h3>
            <p>The Included Directories section displays correctly with "Site Root" shown as the default included directory. The directory path is displayed clearly with a trash icon for deletion.</p>
        </div>
    </div>

    <!-- Test Scenario 2 -->
    <div class="test-scenario">
        <div class="scenario-header passed">
            <h2>Scenario 2: Test Folder Picker Functionality</h2>
            <span class="status-badge">PASSED</span>
        </div>
        <div class="scenario-content">
            <h3>Steps Taken</h3>
            <ol class="steps">
                <li>Click on "+ Add Directory" button in Included Directories section</li>
                <li>Observe the folder picker dropdown appears</li>
                <li>Click on the folder dropdown to expand the directory tree</li>
                <li>Navigate through the folder structure</li>
            </ol>

            <h3>Screenshots</h3>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step06_folder_picker_open.png" alt="Folder Picker Open">
                <p class="screenshot-caption">Step 1: Add Directory form expanded with folder picker</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step07_folder_picker_tree.png" alt="Folder Picker Tree">
                <p class="screenshot-caption">Step 2: Folder picker showing directory tree structure</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step08_folder_tree_visible.png" alt="Folder Tree Visible">
                <p class="screenshot-caption">Step 3: Full directory tree visible with expandable folders</p>
            </div>

            <h3>Result</h3>
            <p>The folder picker works correctly. It displays a hierarchical tree of folders from the DNN file system. Users can expand folders to see subfolders and select the desired directory.</p>
        </div>
    </div>

    <!-- Test Scenario 3 -->
    <div class="test-scenario">
        <div class="scenario-header passed">
            <h2>Scenario 3: Validate Folder Selection Required</h2>
            <span class="status-badge">PASSED</span>
        </div>
        <div class="scenario-content">
            <h3>Steps Taken</h3>
            <ol class="steps">
                <li>Open Add Directory form</li>
                <li>Click "Save" without selecting a folder</li>
                <li>Observe validation error</li>
            </ol>

            <h3>Screenshots</h3>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step09_select_folder_error.png" alt="Select Folder Error">
                <p class="screenshot-caption">Validation: "Please select a folder" error displayed when saving without selection</p>
            </div>

            <h3>Result</h3>
            <p>The system correctly validates that a folder must be selected before saving. The error message "Please select a folder" is displayed, and the form field is highlighted with an error state (red border).</p>
        </div>
    </div>

    <!-- Test Scenario 4 -->
    <div class="test-scenario">
        <div class="scenario-header passed">
            <h2>Scenario 4: Add Directory That Conflicts With Existing (Ancestor Directory Already Included)</h2>
            <span class="status-badge">PASSED</span>
        </div>
        <div class="scenario-content">
            <h3>Steps Taken</h3>
            <ol class="steps">
                <li>With "Site Root" already in the included list</li>
                <li>Attempt to add "Images" folder (a subdirectory of Site Root)</li>
                <li>Select the Images folder in folder picker</li>
                <li>Click Save</li>
                <li>Observe error message</li>
            </ol>

            <h3>Screenshots</h3>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step10_images_selected.png" alt="Images Folder Selected">
                <p class="screenshot-caption">Step 1: Selected "Images" folder in the folder picker</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step11_ancestor_error.png" alt="Ancestor Error">
                <p class="screenshot-caption">Step 2: Error message showing directory is already included by ancestor</p>
            </div>

            <h3>Result</h3>
            <p>The system correctly prevents adding a subdirectory when its parent (ancestor) directory is already included. The error message clearly indicates that the directory is "included by ancestor directory" - this prevents redundant entries and maintains data integrity.</p>

            <div class="observations">
                <h4>Technical Details</h4>
                <p>This validation is handled server-side in the <code>SearchSpiderHelper.AddDirectoryToPortalIncludedDirectoryList</code> method, which checks if the selected folder or any of its ancestors are already in the included list.</p>
            </div>
        </div>
    </div>

    <!-- Test Scenario 5 -->
    <div class="test-scenario">
        <div class="scenario-header passed">
            <h2>Scenario 5: Remove Directory From Included List (Delete Confirmation)</h2>
            <span class="status-badge">PASSED</span>
        </div>
        <div class="scenario-content">
            <h3>Steps Taken</h3>
            <ol class="steps">
                <li>Locate "Site Root" in the Included Directories list</li>
                <li>Click the trash/delete icon next to "Site Root"</li>
                <li>Observe confirmation dialog appears</li>
                <li>Confirm deletion</li>
                <li>Verify directory is removed from the list</li>
            </ol>

            <h3>Screenshots</h3>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step12_delete_confirmation.png" alt="Delete Confirmation">
                <p class="screenshot-caption">Step 1: Delete confirmation dialog asking "Are you sure you want to delete this?"</p>
            </div>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step13_after_delete.png" alt="After Delete">
                <p class="screenshot-caption">Step 2: Included Directories list is now empty after deletion</p>
            </div>

            <h3>Result</h3>
            <p>The delete functionality works correctly with a confirmation dialog. After confirming, the directory is removed from the list. The confirmation dialog helps prevent accidental deletions.</p>
        </div>
    </div>

    <!-- Test Scenario 6 -->
    <div class="test-scenario">
        <div class="scenario-header passed">
            <h2>Scenario 6: Add Directory to Included List Using Folder Picker</h2>
            <span class="status-badge">PASSED</span>
        </div>
        <div class="scenario-content">
            <h3>Steps Taken</h3>
            <ol class="steps">
                <li>With the included list empty (after deleting Site Root)</li>
                <li>Click "+ Add Directory" button</li>
                <li>Open folder picker and navigate to "Badges" folder</li>
                <li>Select the Badges folder</li>
                <li>Click "Save" button</li>
                <li>Verify the directory appears in the Included Directories list</li>
            </ol>

            <h3>Screenshots</h3>
            <div class="screenshot-container">
                <img src="Search Crawling Included Directory Management_step14_badges_added.png" alt="Badges Added">
                <p class="screenshot-caption">Success: "Badges" directory successfully added to Included Directories list</p>
            </div>

            <h3>Result</h3>
            <p>The add directory functionality works correctly. The "Badges" folder was successfully added to the Included Directories list. The folder path is displayed correctly in the list with the delete icon available for future removal.</p>
        </div>
    </div>

    <!-- Overall Findings -->
    <div class="summary-box">
        <h2>Overall Findings</h2>

        <h3>Feature Functionality</h3>
        <p>The Search Crawling Included Directory Management feature is working correctly. All core functionality has been verified:</p>
        <ul>
            <li><strong>View:</strong> Included directories are displayed correctly with directory names and delete icons</li>
            <li><strong>Add:</strong> New directories can be added using the folder picker interface</li>
            <li><strong>Delete:</strong> Directories can be removed with a confirmation dialog</li>
            <li><strong>Validation:</strong> Proper validation prevents empty submissions and duplicate/conflict entries</li>
            <li><strong>Error Handling:</strong> Clear error messages for ancestor directory conflicts</li>
        </ul>

        <h3>Code Analysis</h3>
        <p>Key implementation details:</p>
        <div class="code-block">
// CrawlerDirectoryDto.cs - Data transfer object
public class CrawlerDirectoryDto
{
    [JsonProperty(PropertyName = "directoryId")]
    public int DirectoryId { get; set; }

    [JsonProperty(PropertyName = "directoryName")]
    public string DirectoryName { get; set; }
}
        </div>

        <div class="code-block">
// API endpoint for saving included directory
[HttpPost]
[ValidateAntiForgeryToken]
public HttpResponseMessage SaveCrawlIncludedDirectory(
    CrawlerDirectoryDto crawlerDirectoryDto,
    int portalId = -1)
{
    Validate(crawlerDirectoryDto);
    var folderPath = Components.EvoqSiteSettingsController.Instance
        .SaveCrawlIncludedDirectory(GetSettingsPortalId(portalId), crawlerDirectoryDto);
    return Request.CreateResponse(HttpStatusCode.OK, "Success");
}
        </div>

        <h3>UI Components</h3>
        <p>The frontend uses React components:</p>
        <ul>
            <li><strong>DirectoryList/index.jsx:</strong> Main component managing the list display and add form</li>
            <li><strong>DirectoryColumnRow.jsx:</strong> Individual row component with directory name and delete icon</li>
            <li><strong>FolderPicker:</strong> DNN's standard folder picker component for directory selection</li>
        </ul>

        <h3>Recommendations</h3>
        <ol>
            <li>Consider adding bulk delete functionality for multiple directories</li>
            <li>Add search/filter capability if the list grows large</li>
            <li>Consider showing the full path tooltip on hover for nested directories</li>
        </ol>
    </div>

    <div class="footer">
        <p>Test Report Generated: December 30, 2024</p>
        <p>Extension: Evoq.PersonaBar.SiteSettings | Feature 4 of 10</p>
        <p>Tested with Playwright MCP Browser Automation</p>
    </div>
</body>
</html>
