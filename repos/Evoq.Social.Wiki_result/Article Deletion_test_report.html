<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Deletion - Test Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0 0 10px 0;
        }
        .header p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary-card.pass {
            border-left: 4px solid #28a745;
        }
        .summary-card.fail {
            border-left: 4px solid #dc3545;
        }
        .summary-card .number {
            font-size: 2.5em;
            font-weight: bold;
        }
        .summary-card.pass .number {
            color: #28a745;
        }
        .summary-card.fail .number {
            color: #dc3545;
        }
        .test-case {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-case h2 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .status.pass {
            background-color: #d4edda;
            color: #155724;
        }
        .status.fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        .steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .steps li {
            margin: 8px 0;
        }
        .screenshot {
            margin: 15px 0;
            text-align: center;
        }
        .screenshot img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .screenshot p {
            color: #666;
            font-size: 0.9em;
            margin-top: 8px;
        }
        .observations {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .observations h2 {
            margin-top: 0;
            color: #856404;
        }
        .observations ul {
            margin: 0;
            padding-left: 20px;
        }
        .observations li {
            margin: 10px 0;
        }
        .code-ref {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Article Deletion - Test Report</h1>
        <p><strong>Extension:</strong> Evoq.Social.Wiki (Module)</p>
        <p><strong>Feature:</strong> Article Deletion - Delete wiki articles with proper cleanup of related data</p>
        <p><strong>Priority:</strong> High</p>
        <p><strong>Test Date:</strong> January 6, 2026</p>
        <p><strong>Tester:</strong> Automated Testing (Claude Code)</p>
    </div>

    <div class="summary">
        <div class="summary-card pass">
            <div class="number">6</div>
            <div>Tests Passed</div>
        </div>
        <div class="summary-card fail">
            <div class="number">0</div>
            <div>Tests Failed</div>
        </div>
    </div>

    <!-- Test Case 1: Delete Confirmation Dialog -->
    <div class="test-case">
        <h2>
            <span class="status pass">PASS</span>
            Test: Delete Confirmation Dialog
        </h2>
        <p><strong>Objective:</strong> Verify that a confirmation dialog appears before deleting an article.</p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to Wiki module and select an existing article</li>
                <li>Click the "Delete" link on the article view page</li>
                <li>Verify confirmation dialog appears with "Delete this article?" message</li>
                <li>Click "No" to cancel the deletion</li>
                <li>Verify article is not deleted</li>
            </ol>
        </div>

        <p><strong>Result:</strong> Delete confirmation dialog appears with "Delete this article?" title, "Are you sure to delete this article?" message, and Yes/No buttons. Clicking "No" cancels the deletion.</p>

        <div class="screenshot">
            <img src="Article Deletion_step03_delete_confirmation.png" alt="Delete confirmation dialog">
            <p>Delete confirmation dialog showing Yes/No options</p>
        </div>
    </div>

    <!-- Test Case 2: Delete Published Article -->
    <div class="test-case">
        <h2>
            <span class="status pass">PASS</span>
            Test: Delete Published Article
        </h2>
        <p><strong>Objective:</strong> Verify that a published article can be successfully deleted.</p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to "Notification Test Article - Jan 2026" (published article with comment)</li>
                <li>Verify article is displayed with content and Delete link visible</li>
                <li>Click the "Delete" link</li>
                <li>Click "Yes" in confirmation dialog</li>
                <li>Verify redirect to Wiki list and article is removed</li>
            </ol>
        </div>

        <p><strong>Result:</strong> Published article was successfully deleted. Article count decreased from 21 to 20 ("My Articles"). Article no longer appears in the Wiki list.</p>

        <div class="screenshot">
            <img src="Article Deletion_step05_article_with_comment.png" alt="Article before deletion">
            <p>Published article "Notification Test Article - Jan 2026" before deletion (with comment)</p>
        </div>

        <div class="screenshot">
            <img src="Article Deletion_step07_delete_confirmation.png" alt="Delete confirmation">
            <p>Delete confirmation dialog for published article</p>
        </div>

        <div class="screenshot">
            <img src="Article Deletion_step08_article_deleted.png" alt="Article deleted">
            <p>Wiki list after deletion - article count decreased to 19</p>
        </div>
    </div>

    <!-- Test Case 3: Delete Draft Article -->
    <div class="test-case">
        <h2>
            <span class="status pass">PASS</span>
            Test: Delete Draft Article
        </h2>
        <p><strong>Objective:</strong> Verify that a draft article can be successfully deleted.</p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigate to "Test Draft Article - Jan 2026"</li>
                <li>Click the "Delete" link</li>
                <li>Click "Yes" in confirmation dialog</li>
                <li>Verify redirect to Wiki list and article is removed</li>
            </ol>
        </div>

        <p><strong>Result:</strong> Draft article was successfully deleted. Article count decreased from 20 to 19 ("My Articles"). Total articles decreased from 18 to 17.</p>

        <div class="screenshot">
            <img src="Article Deletion_step09_draft_article.png" alt="Draft article before deletion">
            <p>Draft article "Test Draft Article - Jan 2026" before deletion</p>
        </div>

        <div class="screenshot">
            <img src="Article Deletion_step10_draft_delete_confirm.png" alt="Draft delete confirmation">
            <p>Delete confirmation dialog for draft article</p>
        </div>

        <div class="screenshot">
            <img src="Article Deletion_step11_draft_deleted.png" alt="Draft article deleted">
            <p>Wiki list after draft deletion - article count now 19</p>
        </div>
    </div>

    <!-- Test Case 4: Delete Permissions -->
    <div class="test-case">
        <h2>
            <span class="status pass">PASS</span>
            Test: Delete Permissions
        </h2>
        <p><strong>Objective:</strong> Verify that the Delete button is only visible to authorized users.</p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Log out from the SuperUser account</li>
                <li>Navigate to an article as an anonymous user</li>
                <li>Verify Delete link is NOT visible</li>
                <li>Log back in as SuperUser</li>
                <li>Verify Delete link IS visible</li>
            </ol>
        </div>

        <p><strong>Result:</strong> Delete permissions work correctly. Anonymous users see only Edit (requires login), Tags, and Report links - NO Delete or History links. Logged-in SuperUser sees History and Delete links.</p>

        <div class="screenshot">
            <img src="Article Deletion_step12_anonymous_no_delete.png" alt="Anonymous user view">
            <p>Anonymous user view - NO Delete link visible (only Edit, Tags, Report)</p>
        </div>

        <div class="screenshot">
            <img src="Article Deletion_step13_logged_in_delete_visible.png" alt="Logged in user view">
            <p>SuperUser view - History and Delete links visible</p>
        </div>
    </div>

    <!-- Test Case 5: Cascading Deletes -->
    <div class="test-case">
        <h2>
            <span class="status pass">PASS</span>
            Test: Cascading Deletes (Comments, Related Data)
        </h2>
        <p><strong>Objective:</strong> Verify that deleting an article also removes associated comments and related data.</p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Select "Notification Test Article - Jan 2026" which has a comment</li>
                <li>Verify article has associated comment: "Test comment for notification system testing"</li>
                <li>Delete the article</li>
                <li>Verify article and comment are both removed</li>
            </ol>
        </div>

        <p><strong>Result:</strong> Cascading delete works correctly. When the article was deleted, the associated comment was also removed. Code review of <span class="code-ref">ArticleController.cs</span> (lines 287-331) confirms the Delete method handles: notifications, summary revisions, content revisions, comments, journal entries, scoring actions, and subscriptions.</p>

        <div class="screenshot">
            <img src="Article Deletion_step06_comment_section.png" alt="Article with comment">
            <p>Article with comment before deletion - comment visible from "Anonymous"</p>
        </div>
    </div>

    <!-- Test Case 6: Restore Deleted Article -->
    <div class="test-case">
        <h2>
            <span class="status pass">PASS</span>
            Test: Restore Deleted Article (Verification)
        </h2>
        <p><strong>Objective:</strong> Verify the restore functionality for deleted articles.</p>

        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Review the source code for restore functionality</li>
                <li>Search UI for any "restore" or "undelete" options</li>
                <li>Document findings</li>
            </ol>
        </div>

        <p><strong>Result:</strong> Code review confirms there is <strong>NO restore functionality</strong> in the Wiki module. The <span class="code-ref">ArticleController.Delete()</span> method permanently removes articles with no undo capability. This is by design - deleted articles cannot be recovered.</p>

        <p><strong>Code Evidence:</strong> In <span class="code-ref">ArticleController.cs</span> lines 287-331, the Delete method:</p>
        <ul>
            <li>Removes all notifications</li>
            <li>Deletes all summary revisions</li>
            <li>Deletes all content revisions</li>
            <li>Removes journal entries</li>
            <li>Deletes from database via <span class="code-ref">_dataProvider.DeleteArticle()</span></li>
            <li>Removes content items and subscriptions</li>
        </ul>
    </div>

    <!-- Observations Section -->
    <div class="observations">
        <h2>Observations</h2>
        <ul>
            <li><strong>Delete from Notification:</strong> Code suggests ability to delete articles from notifications panel exists (<span class="code-ref">NotificationServiceController.DeleteArticle()</span>), but no pending approval notifications were available to test this functionality via UI.</li>
            <li><strong>Permanent Deletion:</strong> Article deletion is permanent with no soft-delete or recycle bin functionality. Once deleted, articles and all associated data (comments, revisions, subscriptions) are permanently removed.</li>
            <li><strong>Cascading Cleanup:</strong> The deletion process properly cleans up all related data including notifications, revisions, comments, journal entries, and subscriptions - ensuring data integrity.</li>
            <li><strong>Permission-Based Access:</strong> Delete functionality is properly restricted to authorized users only. Anonymous users cannot see or access the Delete option.</li>
            <li><strong>Admin Panel Overlay:</strong> During testing, the DNN Persona Bar (admin panel) occasionally appeared over the content. This was worked around by hiding the iframe via JavaScript.</li>
        </ul>
    </div>

</body>
</html>
