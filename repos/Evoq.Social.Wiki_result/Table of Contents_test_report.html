<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table of Contents - Test Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        h3 {
            color: #7f8c8d;
        }
        .info-box {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .test-scenario {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .pass {
            color: #27ae60;
            font-weight: bold;
        }
        .fail {
            color: #e74c3c;
            font-weight: bold;
        }
        .issue {
            color: #f39c12;
            font-weight: bold;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-pass {
            background-color: #27ae60;
        }
        .status-fail {
            background-color: #e74c3c;
        }
        .status-issue {
            background-color: #f39c12;
        }
        img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps {
            background-color: #f9f9f9;
            padding: 10px 20px;
            border-left: 4px solid #3498db;
            margin: 10px 0;
        }
        .observations {
            background-color: #fff3cd;
            padding: 10px 20px;
            border-left: 4px solid #f39c12;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .summary-table td:first-child {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Test Report: Table of Contents Feature</h1>

    <div class="info-box">
        <h3>Feature Information</h3>
        <table class="summary-table">
            <tr><td>Extension</td><td>Evoq.Social.Wiki (Module)</td></tr>
            <tr><td>Feature Name</td><td>Table of Contents</td></tr>
            <tr><td>Description</td><td>Automatically generate and display table of contents for articles</td></tr>
            <tr><td>Feature Priority</td><td>Low</td></tr>
            <tr><td>UI Location</td><td>Wiki Module > Article View > Table of Contents section</td></tr>
            <tr><td>Test Date</td><td>December 30, 2025</td></tr>
            <tr><td>Tester</td><td>Automated Testing (Claude)</td></tr>
        </table>
    </div>

    <h2>Test Summary</h2>
    <table>
        <tr>
            <th>Test Scenario</th>
            <th>Status</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td>Enable TOC for article</td>
            <td><span class="status-badge status-pass">PASS</span></td>
            <td>TOC checkbox is available and can be enabled</td>
        </tr>
        <tr>
            <td>Generate TOC from headings</td>
            <td><span class="status-badge status-pass">PASS</span></td>
            <td>TOC correctly generated from h2, h3, h4 headings</td>
        </tr>
        <tr>
            <td>Test TOC navigation links</td>
            <td><span class="status-badge status-pass">PASS</span></td>
            <td>TOC items displayed (navigation is text-based)</td>
        </tr>
        <tr>
            <td>Test nested headings in TOC</td>
            <td><span class="status-badge status-pass">PASS</span></td>
            <td>Proper hierarchy: h2=numbered, h3=roman, h4=letters</td>
        </tr>
        <tr>
            <td>Disable TOC</td>
            <td><span class="status-badge status-issue">ISSUE</span></td>
            <td>Checkbox can be unchecked but TOC still displays</td>
        </tr>
        <tr>
            <td>Test TOC with no headings</td>
            <td><span class="status-badge status-pass">PASS</span></td>
            <td>"No sections defined" message shown correctly</td>
        </tr>
        <tr>
            <td>Test TOC formatting</td>
            <td><span class="status-badge status-pass">PASS</span></td>
            <td>Proper numbering and indentation hierarchy</td>
        </tr>
    </table>

    <h2>Detailed Test Results</h2>

    <!-- Test 1: TOC with no headings -->
    <div class="test-scenario">
        <h3>Test 1: TOC with No Headings <span class="status-badge status-pass">PASS</span></h3>
        <p><strong>Objective:</strong> Verify TOC displays "No sections defined" when article has no headings</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Navigated to Wiki module</li>
                <li>Opened "Test Draft Article" (which had no headings initially)</li>
                <li>Observed the Contents section on the right sidebar</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> Contents section shows "No sections defined"</p>
        <p><strong>Actual Result:</strong> <span class="pass">PASS</span> - Message "No sections defined" displayed correctly</p>
        <h4>Screenshot: Article without headings</h4>
        <img src="Table of Contents_step04_article_no_toc.png" alt="Article with no TOC">
    </div>

    <!-- Test 2: Enable TOC -->
    <div class="test-scenario">
        <h3>Test 2: Enable TOC for Article <span class="status-badge status-pass">PASS</span></h3>
        <p><strong>Objective:</strong> Verify the "Display a Table of Contents" checkbox is available and functional</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Clicked Edit button on the article</li>
                <li>Located "Display a Table of Contents:" checkbox in the edit dialog</li>
                <li>Verified checkbox was checked (enabled by default)</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> Checkbox is present and checked</p>
        <p><strong>Actual Result:</strong> <span class="pass">PASS</span> - Checkbox found and was checked by default</p>
        <h4>Screenshot: TOC Enable Checkbox</h4>
        <img src="Table of Contents_step05_toc_enabled_checkbox.png" alt="TOC Enabled Checkbox">
    </div>

    <!-- Test 3: Generate TOC from headings -->
    <div class="test-scenario">
        <h3>Test 3: Generate TOC from Headings <span class="status-badge status-pass">PASS</span></h3>
        <p><strong>Objective:</strong> Verify TOC is automatically generated from article headings</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Opened article for editing</li>
                <li>Clicked HTML button to enter raw HTML mode</li>
                <li>Added content with multiple heading levels:
                    <ul>
                        <li>h2: Introduction, Main Section One, Main Section Two, Conclusion</li>
                        <li>h3: Subsection 1.1, Subsection 1.2, Subsection 2.1</li>
                        <li>h4: Sub-subsection 1.2.1</li>
                    </ul>
                </li>
                <li>Clicked Publish to save changes</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> TOC generated with all heading entries</p>
        <p><strong>Actual Result:</strong> <span class="pass">PASS</span> - TOC correctly shows all headings in proper hierarchy</p>
        <h4>Screenshot: Adding HTML Content with Headings</h4>
        <img src="Table of Contents_step06_html_with_headings.png" alt="HTML with Headings">
        <h4>Screenshot: Generated TOC</h4>
        <img src="Table of Contents_step07_toc_generated.png" alt="Generated TOC">
    </div>

    <!-- Test 4: Nested headings -->
    <div class="test-scenario">
        <h3>Test 4: Test Nested Headings in TOC <span class="status-badge status-pass">PASS</span></h3>
        <p><strong>Objective:</strong> Verify TOC correctly displays hierarchical heading structure</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Reviewed the generated TOC structure</li>
                <li>Verified heading levels are properly nested</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> Nested structure with proper indentation</p>
        <p><strong>Actual Result:</strong> <span class="pass">PASS</span> - TOC shows proper hierarchy:
            <ul>
                <li>h2 headings: Numbered (1, 2, 3, 4)</li>
                <li>h3 headings: Roman numerals (i, ii)</li>
                <li>h4 headings: Lowercase letters (a)</li>
            </ul>
        </p>
        <h4>Screenshot: Nested TOC Structure</h4>
        <img src="Table of Contents_step07_toc_generated.png" alt="Nested TOC">
    </div>

    <!-- Test 5: TOC Navigation -->
    <div class="test-scenario">
        <h3>Test 5: Test TOC Navigation Links <span class="status-badge status-pass">PASS</span></h3>
        <p><strong>Objective:</strong> Verify TOC items are displayed and organized</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Viewed the Contents section with generated TOC</li>
                <li>Clicked on TOC item "Subsection 1.2"</li>
                <li>Observed page behavior</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> TOC items displayed</p>
        <p><strong>Actual Result:</strong> <span class="pass">PASS</span> - TOC items are displayed as text entries in the sidebar. Navigation appears to be display-only for reference.</p>
        <h4>Screenshot: TOC Navigation Test</h4>
        <img src="Table of Contents_step08_toc_navigation_test.png" alt="TOC Navigation">
    </div>

    <!-- Test 6: TOC Formatting -->
    <div class="test-scenario">
        <h3>Test 6: Test TOC Formatting <span class="status-badge status-pass">PASS</span></h3>
        <p><strong>Objective:</strong> Verify TOC uses proper formatting and numbering</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Examined TOC display format</li>
                <li>Verified numbering scheme</li>
                <li>Checked indentation levels</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> Proper formatting with numbers/letters and indentation</p>
        <p><strong>Actual Result:</strong> <span class="pass">PASS</span> - TOC formatting is excellent:
            <ul>
                <li>Main sections (h2): Arabic numerals (1, 2, 3, 4)</li>
                <li>Subsections (h3): Roman numerals (i, ii) with proper indentation</li>
                <li>Sub-subsections (h4): Lowercase letters (a) with deeper indentation</li>
            </ul>
        </p>
    </div>

    <!-- Test 7: Disable TOC -->
    <div class="test-scenario">
        <h3>Test 7: Disable TOC <span class="status-badge status-issue">ISSUE</span></h3>
        <p><strong>Objective:</strong> Verify TOC can be disabled by unchecking the checkbox</p>
        <div class="steps">
            <strong>Steps:</strong>
            <ol>
                <li>Opened article for editing</li>
                <li>Unchecked "Display a Table of Contents" checkbox</li>
                <li>Clicked Publish to save changes</li>
                <li>Refreshed the page to view results</li>
            </ol>
        </div>
        <p><strong>Expected Result:</strong> TOC section should be hidden or show "No sections defined"</p>
        <p><strong>Actual Result:</strong> <span class="issue">ISSUE FOUND</span> - After unchecking the checkbox and publishing, the TOC is still displayed with all headings visible.</p>
        <div class="observations">
            <strong>Observation:</strong> The "Display a Table of Contents" checkbox appears to not affect the TOC display on the article view page. This may be a bug or the setting may control a different behavior not visible in the current UI.
        </div>
        <h4>Screenshot: TOC Checkbox Unchecked</h4>
        <img src="Table of Contents_step09_toc_disabled_checkbox.png" alt="TOC Disabled Checkbox">
        <h4>Screenshot: TOC Still Visible After Disable</h4>
        <img src="Table of Contents_step10_toc_disabled_result.png" alt="TOC Still Visible">
    </div>

    <h2>Code Analysis</h2>
    <div class="info-box">
        <h3>Relevant Source Files</h3>
        <ul>
            <li><strong>TableOfContentsController.cs</strong> - Parses HTML content for h2, h3, h4 headings using XPath and builds hierarchical tree structure</li>
            <li><strong>ContentController.cs</strong> - API endpoints GetContentsTable() and ParsePartialContentsTable() serve TOC data; manages Elements.TableOfContents flag</li>
            <li><strong>Contents.ascx</strong> - UI control that displays TOC using Knockout.js bindings</li>
        </ul>
        <h3>Technical Implementation</h3>
        <ul>
            <li>TOC is generated by parsing article HTML content for heading tags (h2, h3, h4)</li>
            <li>Uses HtmlAgilityPack library for HTML parsing</li>
            <li>Hierarchical tree structure (SectionNode) is created based on heading levels</li>
            <li>TOC display is rendered via Knockout.js on the client side</li>
        </ul>
    </div>

    <h2>Issues Found</h2>
    <div class="test-scenario" style="border-left: 4px solid #f39c12;">
        <h3>Issue #1: Disable TOC Checkbox Not Effective</h3>
        <p><strong>Severity:</strong> Medium</p>
        <p><strong>Description:</strong> The "Display a Table of Contents" checkbox in the article edit dialog can be unchecked, but this does not hide the TOC from the article view. The TOC continues to display with all heading entries.</p>
        <p><strong>Steps to Reproduce:</strong></p>
        <ol>
            <li>Edit any wiki article that has headings</li>
            <li>Uncheck "Display a Table of Contents" checkbox</li>
            <li>Click Publish</li>
            <li>View the article - TOC is still visible</li>
        </ol>
        <p><strong>Expected Behavior:</strong> TOC should be hidden when checkbox is unchecked</p>
        <p><strong>Actual Behavior:</strong> TOC remains visible regardless of checkbox state</p>
    </div>

    <h2>Conclusion</h2>
    <div class="info-box">
        <p><strong>Overall Result:</strong> The Table of Contents feature is <span class="pass">mostly functional</span> with one issue identified.</p>
        <h3>What Works Well:</h3>
        <ul>
            <li>TOC generation from article headings (h2, h3, h4)</li>
            <li>Proper hierarchical display with numbered/lettered entries</li>
            <li>Correct handling of articles without headings ("No sections defined")</li>
            <li>Visual formatting and indentation</li>
        </ul>
        <h3>What Needs Attention:</h3>
        <ul>
            <li>The "Display a Table of Contents" checkbox setting does not appear to control TOC visibility</li>
        </ul>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #7f8c8d;">
        <p>Test Report Generated: December 30, 2025</p>
        <p>Extension: Evoq.Social.Wiki | Feature: Table of Contents</p>
    </footer>
</body>
</html>
