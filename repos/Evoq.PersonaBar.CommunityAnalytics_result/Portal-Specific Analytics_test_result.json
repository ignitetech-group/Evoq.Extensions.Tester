{
  "metadata": {
    "extension_name": "Evoq.PersonaBar.CommunityAnalytics",
    "extension_type": "PersonaBar Module",
    "feature_name": "Portal-Specific Analytics",
    "feature_description": "Isolation of analytics data per portal in multi-portal installations",
    "feature_priority": "High",
    "test_date": "2026-02-09T16:45:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify portal data isolation",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Logged in as host user and navigated to Community Analytics",
          "expected": "Community Analytics dashboard should display for current portal",
          "actual": "Community Analytics dashboard displayed with Answers, Blogs, Discussions, Events, Ideas, Wiki modules showing metrics for Portal 0 (My Website)",
          "screenshot": "Portal-Specific Analytics_step01_community_analytics_dashboard.png"
        },
        {
          "step_number": 2,
          "action": "Verified analytics API calls use EffectivePortalId",
          "expected": "API calls should use portal-specific context",
          "actual": "Network inspection confirmed API calls to GetModuleDashboardInfo endpoint. Code review confirmed all analytics methods use EffectivePortalId property which derives portal ID from PortalSettings.PortalId or ActiveModule.OwnerPortalID",
          "screenshot": "Portal-Specific Analytics_step01_community_analytics_dashboard.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test portal switching functionality",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to Settings and opened portal selector dropdown",
          "expected": "Portal selector should show available portals",
          "actual": "Portal selector dropdown displayed showing 'My Website' (Portal 0) and 'Test Portal 2' (Portal 1)",
          "screenshot": "Portal-Specific Analytics_step02_portal_selector_visible.png"
        },
        {
          "step_number": 2,
          "action": "Selected 'Test Portal 2' from the dropdown",
          "expected": "Context should switch to Test Portal 2",
          "actual": "Portal context successfully switched to Test Portal 2. Site Settings displayed 'EDITING SITE: TEST PORTAL 2' with Home Directory showing 'Portals/1' confirming Portal ID 1",
          "screenshot": "Portal-Specific Analytics_step03_portal2_selected.png"
        },
        {
          "step_number": 3,
          "action": "Navigated to Community Analytics after portal switch",
          "expected": "Community Analytics should display data for Test Portal 2",
          "actual": "Community Analytics dashboard loaded successfully for Test Portal 2 with separate analytics data (all 0% as expected for test portal without community content)",
          "screenshot": "Portal-Specific Analytics_step04_portal2_community_analytics.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Validate portal ID handling in API calls",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Examined network requests for Community Analytics API calls",
          "expected": "API should properly isolate portal data using portal context",
          "actual": "Network inspection showed API calls to /en-us/API/personabar/CommunityAnalytics/GetModuleDashboardInfo endpoint. Portal ID is handled server-side via EffectivePortalId property in CommunityAnalyticsController.cs (line 33-45), not passed as URL parameter, which is the secure approach",
          "screenshot": "Portal-Specific Analytics_step04_portal2_community_analytics.png"
        },
        {
          "step_number": 2,
          "action": "Verified code implementation of portal isolation",
          "expected": "Code should use EffectivePortalId for all analytics queries",
          "actual": "Code review confirmed all API methods (GetDashboardInfo, GetTagStats, GetPopularContent, GetModuleDashboardInfo, GetModuleContextData, GetModuleTagStats, GetModulePopularContent) pass EffectivePortalId to the analytics controller ensuring proper portal isolation",
          "screenshot": "Portal-Specific Analytics_step01_community_analytics_dashboard.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify host user access across portals",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Confirmed host user can access Community Analytics for Portal 0 (My Website)",
          "expected": "Host user should have access to analytics for all portals",
          "actual": "Host user (SuperUser Account) successfully accessed Community Analytics dashboard for Portal 0 showing full analytics interface with Community Health, Engagement, Creates & Views metrics",
          "screenshot": "Portal-Specific Analytics_step01_community_analytics_dashboard.png"
        },
        {
          "step_number": 2,
          "action": "Confirmed host user can switch to and access Community Analytics for Portal 1 (Test Portal 2)",
          "expected": "Host user should be able to switch portals and view analytics",
          "actual": "Host user successfully switched to Test Portal 2 and accessed Community Analytics dashboard. Code review confirmed Components/CommunityAnalyticsController.cs (lines 55-59) provides access for host users and admins via Utilities.IsHost(user) and Utilities.IsAdmin(user) checks",
          "screenshot": "Portal-Specific Analytics_step04_portal2_community_analytics.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test cross-portal data prevention",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Verified that portal switching results in different analytics data",
          "expected": "Each portal should have isolated analytics data",
          "actual": "Portal 0 (My Website) and Portal 1 (Test Portal 2) showed independent analytics data sets. Portal 0 had its own metrics while Portal 1 showed 0% values for all metrics (as expected for test portal). The EffectivePortalId mechanism ensures queries only return data for the current portal context",
          "screenshot": "Portal-Specific Analytics_step04_portal2_community_analytics.png"
        },
        {
          "step_number": 2,
          "action": "Verified server-side portal isolation in API controller",
          "expected": "API should prevent cross-portal data access",
          "actual": "Code review confirmed CommunityAnalyticsController uses [MenuPermission] and [LicenseCheck] attributes for authorization. The EffectivePortalId property (Services/CommunityAnalyticsController.cs:33-45) ensures all data queries are scoped to the effective portal ID derived from PortalSettings, preventing cross-portal data leakage",
          "screenshot": "Portal-Specific Analytics_step01_community_analytics_dashboard.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "The portal ID is not passed as a URL parameter to analytics APIs - instead, it uses server-side EffectivePortalId property derived from PortalSettings.PortalId or ActiveModule.OwnerPortalID, which is a more secure implementation approach",
    "The Components/CommunityAnalyticsController.cs implements role-based dashboard path selection (social-dashboard-combined for hosts/admins vs default path) ensuring appropriate access levels",
    "Google Analytics integration shows a warning about needing to set up the Google Analytics Connector, but this does not affect the Community Analytics functionality which uses internal analytics data",
    "All six community modules (Answers, Blogs, Discussions, Events, Ideas, Wiki) are properly displayed in the Community Analytics dashboard with portal-specific data"
  ],
  "summary": {
    "total_scenarios": 5,
    "passed": 5,
    "failed": 0,
    "pass_rate": "100%"
  }
}
