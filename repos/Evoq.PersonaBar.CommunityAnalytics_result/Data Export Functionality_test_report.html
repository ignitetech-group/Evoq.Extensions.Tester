<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Data Export Functionality</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0 0 10px 0;
        }
        .header p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .summary-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-fail {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            color: #c62828;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-pass {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            color: #2e7d32;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: bold;
        }
        .test-case {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case h3 {
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .test-steps {
            background: #fafafa;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .test-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error-details {
            background: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .error-details code {
            background: #ffecb3;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .observations {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        .observations h2 {
            margin-top: 0;
            color: #1565c0;
        }
        .code-review {
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Test Report: Data Export Functionality</h1>
        <p><strong>Extension:</strong> Evoq.PersonaBar.CommunityAnalytics</p>
        <p><strong>Feature:</strong> Data Export Functionality</p>
        <p><strong>Priority:</strong> Low (SMOKE Testing)</p>
        <p><strong>Test Date:</strong> January 6, 2026</p>
        <p><strong>UI Location:</strong> PersonaBar > Dashboard > Community Analytics > Export Button</p>
    </div>

    <div class="summary-box">
        <h2>Test Summary</h2>
        <p><strong>Description:</strong> Export analytics data to various formats for external analysis</p>
        <p><strong>Testing Depth:</strong> SMOKE testing - Verify feature loads and basic functionality works</p>
        <div class="status-fail">OVERALL STATUS: FAIL</div>
        <p style="margin-top: 15px;"><strong>Root Cause:</strong> Community Analytics dashboard fails to load due to JavaScript error, preventing access to Export functionality.</p>
    </div>

    <h2>Test Results</h2>

    <div class="test-case">
        <h3>Test 1: Access Community Analytics Dashboard</h3>
        <div class="status-fail">FAIL</div>

        <div class="test-steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Logged in as SuperUser (host/Pass123456)</li>
                <li>Navigated to PersonaBar > Dashboard</li>
                <li>Hovered over Dashboard to reveal submenu</li>
                <li>Clicked on "Community Analytics"</li>
            </ol>
        </div>

        <p><strong>Expected Result:</strong> Community Analytics dashboard should load showing analytics data and Export button</p>
        <p><strong>Actual Result:</strong> Dashboard panel opens but displays blank white area. JavaScript error prevents loading.</p>

        <div class="error-details">
            <strong>JavaScript Error:</strong><br>
            <code>TypeError: utility.serializeCustomDate is not a function</code><br><br>
            <strong>Error Location:</strong><br>
            <code>social-dashboard-combined-instance.js:1025:39</code> at <code>dashboardClass.init()</code>
        </div>

        <p><strong>Screenshot - Dashboard Menu (Community Analytics visible):</strong></p>
        <img src="Data_Export_Functionality_step03_dashboard_menu_showing_community_analytics.png" alt="Dashboard menu showing Community Analytics option" class="screenshot">

        <p><strong>Screenshot - Community Analytics Panel Failed to Load:</strong></p>
        <img src="Data_Export_Functionality_step02_community_analytics_js_error.png" alt="Community Analytics panel blank due to JS error" class="screenshot">
    </div>

    <div class="test-case">
        <h3>Test 2: Export to CSV Format</h3>
        <div class="status-fail">FAIL</div>

        <p><strong>Expected Action:</strong> Click Export button and select CSV format</p>
        <p><strong>Actual Result:</strong> Cannot test - Export button is not accessible because Community Analytics dashboard fails to load.</p>
        <p><strong>Issue:</strong> The Export button exists in the code (see code review below) but is not rendered in the UI due to the JavaScript error blocking dashboard initialization.</p>
    </div>

    <div class="test-case">
        <h3>Test 3: Export to Excel Format</h3>
        <div class="status-fail">FAIL</div>

        <p><strong>Expected Action:</strong> Click Export button which calls Excel export API</p>
        <p><strong>Actual Result:</strong> Cannot test - Export button is not accessible because Community Analytics dashboard fails to load.</p>
        <p><strong>Issue:</strong> Code review shows the export function calls <code>api/dnncorp/cmx/SpreadsheetExport/Excel</code> but the UI cannot be accessed to trigger this functionality.</p>
    </div>

    <div class="test-case">
        <h3>Test 4: Test Large Data Exports</h3>
        <div class="status-fail">FAIL</div>

        <p><strong>Expected Action:</strong> Export analytics data with large dataset</p>
        <p><strong>Actual Result:</strong> Cannot test - Community Analytics dashboard fails to load.</p>
    </div>

    <div class="test-case">
        <h3>Test 5: Verify Data Completeness</h3>
        <div class="status-fail">FAIL</div>

        <p><strong>Expected Action:</strong> Verify exported data contains all expected fields</p>
        <p><strong>Actual Result:</strong> Cannot test - Community Analytics dashboard fails to load.</p>
    </div>

    <div class="test-case">
        <h3>Test 6: Test Filename Generation</h3>
        <div class="status-fail">FAIL</div>

        <p><strong>Expected Action:</strong> Verify exported file has appropriate filename</p>
        <p><strong>Actual Result:</strong> Cannot test - Community Analytics dashboard fails to load.</p>
    </div>

    <div class="test-case">
        <h3>Test 7: Validate Export Permissions</h3>
        <div class="status-fail">FAIL</div>

        <p><strong>Expected Action:</strong> Verify export respects user permissions</p>
        <p><strong>Actual Result:</strong> Cannot test - Community Analytics dashboard fails to load even for SuperUser account.</p>
    </div>

    <div class="observations">
        <h2>Observations</h2>

        <h3>Code Review Findings</h3>
        <p>The Data Export functionality exists in the codebase:</p>

        <p><strong>1. Export Button in HTML (social-dashboard.html:13):</strong></p>
        <div class="code-review">
&lt;a class="dashboard-export-btn" data-bind="click: exportDashboard, html: $root.resx.Export"&gt;&lt;/a&gt;
        </div>

        <p><strong>2. Export Function in JavaScript (social-dashboard-instance.js:922-931):</strong></p>
        <div class="code-review">
var exportDashboard = function() {
    var comparativeTerm = viewModel.period() == 'Custom' ? 'c' : viewModel.comparativeTerm();
    var url = config.siteRoot + 'api/dnncorp/cmx/SpreadsheetExport/Excel?' +
        $.param({
            period: viewModel.period(),
            startDate: viewModel.startDate(),
            endDate: viewModel.endDate(),
            comparativeTerm: comparativeTerm,
            ...
        });
    // Downloads Excel file
};
        </div>

        <p><strong>3. API Controller (CommunityAnalyticsController.cs):</strong></p>
        <p>The controller provides endpoints for dashboard data but the export is handled by a separate SpreadsheetExport API endpoint.</p>

        <h3>Root Cause Analysis</h3>
        <p>The Community Analytics dashboard fails to initialize due to a missing or incompatible utility function:</p>
        <ul>
            <li>Error occurs at <code>utility.serializeCustomDate()</code> which is called during dashboard initialization</li>
            <li>This function appears to be expected in a shared utility library but is not defined or not loaded properly</li>
            <li>The error prevents all Community Analytics functionality including the Export feature</li>
        </ul>

        <h3>Recommendations</h3>
        <ol>
            <li><strong>Bug Fix Required:</strong> Investigate why <code>utility.serializeCustomDate</code> is undefined - this may be a missing dependency or version mismatch</li>
            <li>Check if the utility script is being loaded correctly in the PersonaBar module bundle</li>
            <li>Once the dashboard loads, the Export functionality can be tested</li>
        </ol>

        <h3>Environment Notes</h3>
        <ul>
            <li>Testing performed on Evoq Engage Trial (20 days remaining)</li>
            <li>Google Analytics connector not configured (warning displayed)</li>
            <li>The JavaScript error occurs regardless of Analytics configuration</li>
        </ul>
    </div>

    <div class="summary-box" style="margin-top: 30px;">
        <h2>Conclusion</h2>
        <p>All Data Export Functionality tests <strong>FAIL</strong> due to a critical JavaScript error that prevents the Community Analytics dashboard from loading. The export functionality code exists and appears properly implemented, but cannot be tested or used until the underlying dashboard initialization bug is resolved.</p>
        <p><strong>Blocker Issue:</strong> <code>TypeError: utility.serializeCustomDate is not a function</code></p>
    </div>
</body>
</html>
