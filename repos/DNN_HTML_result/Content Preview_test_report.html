<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Preview - Test Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
        }
        h3 {
            color: #555;
        }
        .feature-info {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .feature-info p {
            margin: 5px 0;
        }
        .test-case {
            background-color: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pass {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }
        .fail {
            color: #dc3545;
            font-weight: bold;
            font-size: 1.2em;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        .status-pass {
            background-color: #28a745;
        }
        .status-fail {
            background-color: #dc3545;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .steps {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .observations {
            background-color: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #ffc107;
        }
        .summary {
            background-color: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .summary.has-failures {
            background-color: #ffebee;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
        }
        .issue {
            background-color: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid #dc3545;
        }
    </style>
</head>
<body>
    <h1>Content Preview - Test Report</h1>

    <div class="feature-info">
        <h2>Feature Information</h2>
        <p><strong>Feature Name:</strong> Content Preview</p>
        <p><strong>Description:</strong> Preview content before publishing with token replacement and formatting applied</p>
        <p><strong>Extension:</strong> DNN_HTML (Module)</p>
        <p><strong>Feature Priority:</strong> Medium</p>
        <p><strong>UI Location:</strong> Module Actions > Edit Content > Preview</p>
        <p><strong>Test Date:</strong> January 6, 2026</p>
    </div>

    <h2>Test Results Summary</h2>
    <div class="summary has-failures">
        <table>
            <tr>
                <th>Test Scenario</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Preview current draft</td>
                <td><span class="status-badge status-pass">PASS</span></td>
            </tr>
            <tr>
                <td>Preview with tokens replaced</td>
                <td><span class="status-badge status-fail">FAIL</span></td>
            </tr>
            <tr>
                <td>Preview different versions</td>
                <td><span class="status-badge status-fail">FAIL</span></td>
            </tr>
        </table>
        <p><strong>Overall:</strong> 1 PASS, 2 FAIL</p>
    </div>

    <h2>Test Cases</h2>

    <!-- Test Case 1: Preview current draft -->
    <div class="test-case">
        <h3>Test 1: Preview current draft</h3>
        <p><span class="status-badge status-pass">PASS</span></p>

        <h4>What was tested:</h4>
        <p>Verify that the CKEditor Preview button displays the current draft content with proper formatting.</p>

        <div class="steps">
            <h4>Steps taken:</h4>
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Enabled Edit Mode on the Home page</li>
                <li>Clicked on an HTML module (Test Module Created via API)</li>
                <li>Clicked "Advanced Editor" to open the full CKEditor dialog</li>
                <li>Clicked the "Preview" button in the CKEditor toolbar</li>
                <li>Verified the preview displayed correctly in a new tab</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Step 1: Edit Content Dialog with CKEditor</strong></p>
        <img src="Content Preview_step02_edit_content_dialog.png" alt="Edit Content Dialog" class="screenshot">

        <p><strong>Step 2: Preview in new tab showing formatted content</strong></p>
        <img src="Content Preview_step03_preview_current_draft.png" alt="Preview Current Draft" class="screenshot">

        <h4>Result:</h4>
        <p class="pass">PASS - The Preview button successfully opened a new tab displaying the HTML content with proper formatting (heading styled as H3, paragraph text properly displayed).</p>
    </div>

    <!-- Test Case 2: Preview with tokens replaced -->
    <div class="test-case">
        <h3>Test 2: Preview with tokens replaced</h3>
        <p><span class="status-badge status-fail">FAIL</span></p>

        <h4>What was tested:</h4>
        <p>Verify that the preview displays content with DNN tokens replaced with actual values.</p>

        <div class="steps">
            <h4>Steps taken:</h4>
            <ol>
                <li>Located the Token Replacement Test Module containing various DNN tokens</li>
                <li>Examined the module content in edit mode</li>
                <li>Verified token display in the module (tokens like [User:DisplayName], [Portal:PortalName], etc.)</li>
                <li>Tested the CKEditor Preview to check if tokens were replaced</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Token Replacement Test Module showing raw tokens in edit mode:</strong></p>
        <img src="Content Preview_step04_tokens_raw_in_edit_mode.png" alt="Tokens Raw in Edit Mode" class="screenshot">

        <div class="issue">
            <h4>Issue Found:</h4>
            <p>The CKEditor Preview does NOT process DNN tokens. Tokens appear as raw strings (e.g., [User:DisplayName], [Portal:PortalName]) in both the editor view and the preview.</p>
            <p><strong>Root Cause:</strong> Based on code review of HtmlTextController.cs:</p>
            <ul>
                <li>Token replacement requires the <code>HtmlText_ReplaceTokens</code> module setting to be enabled</li>
                <li>Token replacement only occurs in the <code>FormatHtmlText</code> method when <code>viewWithReplacedTokens</code> parameter is true</li>
                <li>The CKEditor Preview is a client-side feature that shows raw HTML - it doesn't integrate with DNN's server-side token replacement system</li>
            </ul>
        </div>

        <h4>Result:</h4>
        <p class="fail">FAIL - The preview does not show tokens replaced with actual values. The feature description states "Preview content before publishing with token replacement" but this functionality is not available in the CKEditor preview.</p>
    </div>

    <!-- Test Case 3: Preview different versions -->
    <div class="test-case">
        <h3>Test 3: Preview different versions</h3>
        <p><span class="status-badge status-fail">FAIL</span></p>

        <h4>What was tested:</h4>
        <p>Verify that users can preview different versions of content from version history.</p>

        <div class="steps">
            <h4>Steps taken:</h4>
            <ol>
                <li>Opened Edit Content dialog for an HTML module</li>
                <li>Searched for version history or version preview options in the editor interface</li>
                <li>Checked module actions menu for version-related options</li>
                <li>Reviewed the EditHtml.ascx code for VersionPreview functionality</li>
            </ol>
        </div>

        <div class="issue">
            <h4>Issue Found:</h4>
            <p>No UI element was found in the Edit Content dialog to access version history or preview different versions.</p>
            <p><strong>Code Evidence:</strong> The code in EditHtml.ascx references a <code>VersionPreview</code> button class, but this appears to be part of a workflow/versioning system that may require specific page-level version control settings to be enabled.</p>
        </div>

        <h4>Result:</h4>
        <p class="fail">FAIL - No accessible UI element found to preview different versions in the Edit Content interface.</p>
    </div>

    <!-- Observations Section -->
    <div class="observations">
        <h2>Observations</h2>
        <p>The following observations were made during testing that may be relevant but were not directly testable via UI:</p>
        <ul>
            <li><strong>Preview mobile view:</strong> Code review did not reveal any UI element for mobile preview in the HTML module. This feature does not appear to exist in the current implementation.</li>
            <li><strong>Preview as different user role:</strong> No UI element found in the Edit Content interface to preview content as a different user role. This feature does not appear to exist.</li>
            <li><strong>Compare preview with live:</strong> No dedicated comparison view was found in the UI. Users would need to manually compare the preview tab with the live page.</li>
            <li><strong>Token Replacement Architecture:</strong> The <code>FormatHtmlText</code> method in HtmlTextController.cs handles token replacement using DNN's <code>TokenReplace</code> class, but this is only applied during content rendering on the live page, not in the editor preview.</li>
            <li><strong>Version Control:</strong> The module implements <code>IVersionable</code> interface with methods like <code>GetPublishedVersion</code>, <code>GetLatestVersion</code>, and <code>RollBackVersion</code>. Version history functionality may be available through page-level version control settings rather than the Edit Content dialog.</li>
        </ul>
    </div>

    <h2>Environment Information</h2>
    <table>
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Website URL</td>
            <td>http://localhost:8081</td>
        </tr>
        <tr>
            <td>Test User</td>
            <td>SuperUser Account (host)</td>
        </tr>
        <tr>
            <td>Browser Viewport</td>
            <td>1280x720</td>
        </tr>
        <tr>
            <td>Relevant Files Reviewed</td>
            <td>EditHtml.ascx, HtmlTextController.cs</td>
        </tr>
    </table>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
        <p>Test Report Generated: January 6, 2026</p>
        <p>Testing conducted for DNN_HTML extension - Content Preview feature</p>
    </footer>
</body>
</html>
