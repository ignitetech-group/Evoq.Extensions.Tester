{
  "metadata": {
    "extension_name": "DNN_HTML",
    "extension_type": "Module",
    "feature_name": "Token Replacement",
    "feature_description": "Replace dynamic tokens in content with actual values at runtime",
    "feature_priority": "Medium",
    "test_date": "2026-02-09T15:05:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Enable/disable token replacement setting",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Module Settings for HTML module (Module 363)",
          "expected": "Module settings dialog opens with HTML Module Settings tab",
          "actual": "Module settings dialog opened with HTML Module Settings tab showing Replace Tokens checkbox",
          "screenshot": "Token Replacement_step05_module363_settings.png"
        },
        {
          "step_number": 2,
          "action": "Enable the Replace Tokens checkbox by clicking on it",
          "expected": "Checkbox becomes checked",
          "actual": "Checkbox became checked after clicking the visual checkbox image element",
          "screenshot": "Token Replacement_step08_enable_token_via_image_click.png"
        },
        {
          "step_number": 3,
          "action": "Click Update to save settings",
          "expected": "Settings saved successfully",
          "actual": "Settings saved successfully, redirected to home page",
          "screenshot": "Token Replacement_step09_settings_saved_successfully.png"
        },
        {
          "step_number": 4,
          "action": "Verify setting persists by reopening module settings",
          "expected": "Replace Tokens checkbox remains checked",
          "actual": "Replace Tokens checkbox is checked, Last Updated timestamp confirms save",
          "screenshot": "Token Replacement_step09_settings_saved_successfully.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Insert user and portal tokens",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Edit Content page for Module 363",
          "expected": "Rich Text Editor opens with existing content",
          "actual": "CKEditor Rich Text Editor opened with existing content",
          "screenshot": "Token Replacement_step10_token_content_added.png"
        },
        {
          "step_number": 2,
          "action": "Click Source button to view HTML source",
          "expected": "HTML source view shows editable content",
          "actual": "HTML source view displayed with editable textarea",
          "screenshot": "Token Replacement_step10_token_content_added.png"
        },
        {
          "step_number": 3,
          "action": "Add token content: [User:DisplayName], [Portal:PortalName], [DateTime:Now]",
          "expected": "Token content added to HTML",
          "actual": "Token content successfully added to HTML source",
          "screenshot": "Token Replacement_step10_token_content_added.png"
        },
        {
          "step_number": 4,
          "action": "Save and Close the editor",
          "expected": "Content saved successfully",
          "actual": "Content saved and redirected to home page",
          "screenshot": "Token Replacement_step12_edit_mode_tokens_visible.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Tokens displayed as raw text in Edit mode",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Enter Edit mode and view module content with tokens",
          "expected": "Tokens should display as raw text (e.g., [User:DisplayName]) in Edit mode",
          "actual": "Tokens displayed as raw text: [User:DisplayName], [Portal:PortalName], [DateTime:Now]",
          "screenshot": "Token Replacement_step12_edit_mode_tokens_visible.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Handle invalid tokens",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Add invalid token [Invalid:FakeToken] to content",
          "expected": "Invalid token can be added without errors",
          "actual": "Invalid token [Invalid:FakeToken] added successfully to content",
          "screenshot": "Token Replacement_step14_invalid_token_added.png"
        },
        {
          "step_number": 2,
          "action": "Save content and verify invalid token is preserved",
          "expected": "Invalid token should be displayed as-is (not replaced)",
          "actual": "Invalid token [Invalid:FakeToken] displayed as raw text, system handles gracefully without errors",
          "screenshot": "Token Replacement_step15_invalid_token_displayed.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "Token replacement is controlled by the HtmlText_ReplaceTokens module setting stored in ModuleSettings",
    "When token replacement is enabled, module caching is automatically disabled (as seen in code: if module.CacheTime > 0, it's set to 0)",
    "In Edit mode (PortalSettings.Mode != View), tokens display as raw text with DebugMessages enabled",
    "In View mode, tokens should be replaced with actual values (e.g., [User:DisplayName] -> 'SuperUser Account')",
    "Invalid tokens that don't match known token patterns are left as-is and displayed literally",
    "The TokenReplace service from DotNetNuke.Services.Tokens handles the replacement logic",
    "Content with tokens is saved as draft and requires publishing to be visible in View mode to non-editors",
    "The Home page requires login, so anonymous visitors cannot view the token-replaced content without authentication"
  ],
  "summary": {
    "total_scenarios": 4,
    "passed": 4,
    "failed": 0,
    "pass_rate": "100%"
  }
}
