<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM Container Configuration - Test Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0078d4;
            padding-bottom: 10px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
            border-left: 4px solid #0078d4;
            padding-left: 10px;
        }
        h3 {
            color: #555;
        }
        .feature-info {
            background-color: #e7f3ff;
            border: 1px solid #0078d4;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .test-case {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pass {
            color: white;
            background-color: #28a745;
            padding: 5px 15px;
            border-radius: 3px;
            font-weight: bold;
            display: inline-block;
        }
        .fail {
            color: white;
            background-color: #dc3545;
            padding: 5px 15px;
            border-radius: 3px;
            font-weight: bold;
            display: inline-block;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .steps {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .summary {
            background-color: #d4edda;
            border: 1px solid #28a745;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .summary-table th, .summary-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .summary-table th {
            background-color: #0078d4;
            color: white;
        }
        .observations {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>GTM Container Configuration - Test Report</h1>

    <div class="feature-info">
        <h3>Feature Information</h3>
        <p><strong>Extension:</strong> Evoq.GoogleTagManagerConnector (Connector)</p>
        <p><strong>Feature Name:</strong> GTM Container Configuration</p>
        <p><strong>Description:</strong> Configure Google Tag Manager container ID and settings for a portal including validation against Google servers</p>
        <p><strong>UI Location:</strong> Admin &gt; Settings &gt; Connectors &gt; Google Tag Manager</p>
        <p><strong>Testing Date:</strong> January 6, 2026</p>
        <p><strong>Testing Priority:</strong> Top (Exhaustive Testing)</p>
    </div>

    <div class="summary">
        <h3>Test Summary</h3>
        <table class="summary-table">
            <tr>
                <th>Test Scenario</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Save valid GTM container ID (format GTM-XXXXXX)</td>
                <td><span class="pass">PASS</span></td>
            </tr>
            <tr>
                <td>Save empty container ID to disable GTM</td>
                <td><span class="pass">PASS</span></td>
            </tr>
            <tr>
                <td>Attempt to save invalid container ID format</td>
                <td><span class="pass">PASS</span></td>
            </tr>
            <tr>
                <td>Attempt to save non-existent container ID</td>
                <td><span class="pass">PASS</span></td>
            </tr>
            <tr>
                <td>Verify settings persist after save</td>
                <td><span class="pass">PASS</span></td>
            </tr>
        </table>
        <p><strong>Overall Result: 5/5 Tests Passed</strong></p>
    </div>

    <h2>Test Case 1: Save Valid GTM Container ID</h2>
    <div class="test-case">
        <p><strong>Objective:</strong> Verify that a valid GTM container ID (format GTM-XXXXXX) can be saved and validated against Google servers</p>
        <p><strong>Status:</strong> <span class="pass">PASS</span></p>

        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Navigated to Admin &gt; Settings &gt; Connectors</li>
                <li>Located Google Tag Manager connector and clicked "Connect"</li>
                <li>Entered valid container ID: "GTM-5CVQBG"</li>
                <li>Clicked Save button</li>
                <li>Observed success message: "Item successfully saved."</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Step 1 - Connectors List:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step01_connectors_list.png" alt="Connectors List">

        <p><strong>Step 2 - Empty Config Panel:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step02_config_panel_empty.png" alt="Empty Config Panel">

        <p><strong>Step 3 - Valid Container ID Entered:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step03_valid_id_entered.png" alt="Valid Container ID Entered">

        <p><strong>Step 4 - Save Success (Green checkmark indicates connection):</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step04_valid_id_saved_success.png" alt="Valid ID Saved Success">

        <p><strong>Result:</strong> The valid GTM container ID was successfully validated against Google's servers and saved. The connector now shows a green checkmark indicating it's connected.</p>
    </div>

    <h2>Test Case 2: Save Empty Container ID to Disable GTM</h2>
    <div class="test-case">
        <p><strong>Objective:</strong> Verify that saving an empty container ID disables the GTM integration</p>
        <p><strong>Status:</strong> <span class="pass">PASS</span></p>

        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>With GTM connector already configured, cleared the Container ID field</li>
                <li>Clicked Save button</li>
                <li>Observed success message: "Item successfully saved."</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Step 1 - Empty Container ID:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step05_empty_id_entered.png" alt="Empty Container ID">

        <p><strong>Step 2 - Save Success:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step06_empty_id_saved_success.png" alt="Empty ID Saved Success">

        <p><strong>Result:</strong> Empty container ID was saved successfully. This disables the GTM integration as expected.</p>
    </div>

    <h2>Test Case 3: Invalid Container ID Format</h2>
    <div class="test-case">
        <p><strong>Objective:</strong> Verify that invalid container ID formats are rejected with an appropriate error message</p>
        <p><strong>Status:</strong> <span class="pass">PASS</span></p>

        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Entered invalid format: "INVALID-123" (not GTM-XXXXXX format)</li>
                <li>Clicked Save button</li>
                <li>Observed error message: "The Container Id is invalid or container hasn't been published yet."</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Step 1 - Invalid Format Entered:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step07_invalid_format_entered.png" alt="Invalid Format Entered">

        <p><strong>Step 2 - Validation Error:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step08_invalid_format_error.png" alt="Invalid Format Error">

        <p><strong>Result:</strong> The validation correctly rejected the invalid format and displayed an appropriate error message. The system validates container IDs against Google's servers (https://www.googletagmanager.com/gtm.js?id={containerId}).</p>
    </div>

    <h2>Test Case 4: Non-Existent Container ID</h2>
    <div class="test-case">
        <p><strong>Objective:</strong> Verify that non-existent container IDs (valid format but doesn't exist) are rejected</p>
        <p><strong>Status:</strong> <span class="pass">PASS</span></p>

        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Entered non-existent but valid format: "GTM-ZZZZZZZ"</li>
                <li>Clicked Save button</li>
                <li>Observed error message: "The Container Id is invalid or container hasn't been published yet."</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Step 1 - Non-Existent ID Entered:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step09_nonexistent_id_entered.png" alt="Non-Existent ID Entered">

        <p><strong>Step 2 - Validation Error:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step10_nonexistent_id_error.png" alt="Non-Existent ID Error">

        <p><strong>Result:</strong> The validation correctly rejected the non-existent container ID. The system confirms container IDs exist by making a GET request to Google's servers and checking for HTTP 200 response.</p>
    </div>

    <h2>Test Case 5: Verify Settings Persistence</h2>
    <div class="test-case">
        <p><strong>Objective:</strong> Verify that saved GTM settings persist after navigating away and returning</p>
        <p><strong>Status:</strong> <span class="pass">PASS</span></p>

        <div class="steps">
            <h4>Steps Taken:</h4>
            <ol>
                <li>Entered and saved valid container ID: "GTM-5CVQBG"</li>
                <li>Closed the configuration panel</li>
                <li>Navigated to Dashboard</li>
                <li>Navigated back to Settings &gt; Connectors</li>
                <li>Clicked Edit on Google Tag Manager</li>
                <li>Verified container ID "GTM-5CVQBG" was still present</li>
            </ol>
        </div>

        <h4>Screenshots:</h4>
        <p><strong>Step 1 - Save Configuration:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step11_persistence_saved.png" alt="Persistence Saved">

        <p><strong>Step 2 - Verify Persistence After Navigation:</strong></p>
        <img class="screenshot" src="GTM_Container_Configuration_step12_persistence_verified.png" alt="Persistence Verified">

        <p><strong>Result:</strong> The GTM container ID persisted correctly after navigating away and returning. Settings are stored as portal settings (GTMContainerId) and retrieved correctly.</p>
    </div>

    <h2>Additional Testing Notes</h2>
    <div class="test-case">
        <h4>GA Script Option:</h4>
        <p>The GTM configuration includes a checkbox option: "This GTM container has already been configured to add the Google Analytics Script". This allows users to indicate if their GTM container already includes Google Analytics, which prevents duplicate analytics scripts from being loaded.</p>

        <h4>Validation Mechanism:</h4>
        <p>The container ID validation works by making a GET request to: <code>https://www.googletagmanager.com/gtm.js?id={containerId}</code>. If the response returns HTTP 200, the container is valid; otherwise, validation fails.</p>

        <h4>Portal-Specific Configuration:</h4>
        <p>The GTM settings are stored at the portal level using DNN's PortalController.UpdatePortalSetting(), meaning each portal can have its own GTM configuration.</p>
    </div>

    <div class="observations">
        <h3>Observations</h3>
        <ul>
            <li><strong>Code Review Finding:</strong> The connector validates container IDs by making real HTTP requests to Google's GTM servers, ensuring only valid and published containers can be configured.</li>
            <li><strong>Error Message:</strong> The same error message is displayed for both invalid format and non-existent container IDs: "The Container Id is invalid or container hasn't been published yet." This is intentional for security (doesn't reveal if format is wrong vs. container doesn't exist).</li>
            <li><strong>Empty Value Handling:</strong> Empty container IDs are allowed and used to disable the GTM integration. When empty, the GA script option is automatically set to "False".</li>
            <li><strong>UI Behavior:</strong> The connector shows a green checkmark when successfully configured, and the button changes from "Connect" to "Edit".</li>
        </ul>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
        <p>Test Report Generated: January 6, 2026</p>
        <p>Testing performed on: Evoq Engage Trial (localhost:8081)</p>
        <p>Tester: Automated Testing with Claude Code</p>
    </footer>
</body>
</html>
