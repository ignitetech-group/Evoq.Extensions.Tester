{
  "metadata": {
    "extension_name": "Evoq.GoogleTagManagerConnector",
    "extension_type": "Connector",
    "feature_name": "GTM Script Injection",
    "feature_description": "Injects Google Tag Manager JavaScript code into page headers for tracking and analytics",
    "feature_priority": "Top",
    "test_date": "2026-02-09T15:45:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify no script injection when container ID is empty",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Connectors settings and check GTM configuration status",
          "expected": "GTM connector should show 'Connect' button indicating no container ID configured",
          "actual": "GTM connector showed 'Connect' button with status 'Off'",
          "screenshot": "GTM Script Injection_step01_connectors_list.png"
        },
        {
          "step_number": 2,
          "action": "Open GTM configuration panel and verify empty container ID field",
          "expected": "Container ID field should be empty",
          "actual": "Container ID field was empty",
          "screenshot": "GTM Script Injection_step02_gtm_config_panel.png"
        },
        {
          "step_number": 3,
          "action": "Check page source for GTM script using JavaScript evaluation",
          "expected": "No GTM script (gtm.js or gtm.start) should be present in page head",
          "actual": "No GTM script found in page head - hasGTMScript: false",
          "screenshot": "GTM Script Injection_step03_no_gtm_without_config.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify invalid container ID validation",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Enter invalid container ID 'GTM-INVALID123' in the configuration",
          "expected": "Error message should appear when saving",
          "actual": "Error message displayed: 'The Container Id is invalid or container hasn't been published yet.'",
          "screenshot": "GTM Script Injection_step04_invalid_container_input.png"
        },
        {
          "step_number": 2,
          "action": "Click Save button",
          "expected": "Validation error should prevent saving",
          "actual": "Validation error toast appeared, configuration was not saved",
          "screenshot": "GTM Script Injection_step05_invalid_container_error.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify GTM script appears when valid container is configured",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Enter valid GTM container ID 'GTM-WX8L' (verified as valid via API check)",
          "expected": "Container ID should be accepted",
          "actual": "Container ID 'GTM-WX8L' was entered successfully",
          "screenshot": "GTM Script Injection_step06_valid_container_input.png"
        },
        {
          "step_number": 2,
          "action": "Click Save button",
          "expected": "Configuration should be saved successfully",
          "actual": "Success message 'Item successfully saved' appeared. GTM connector now shows 'Edit' button with green checkmark",
          "screenshot": "GTM Script Injection_step07_valid_container_saved.png"
        },
        {
          "step_number": 3,
          "action": "Navigate to homepage and verify GTM script injection in page head",
          "expected": "GTM script should be present with correct container ID",
          "actual": "GTM script successfully injected in page head with container ID substituted correctly. Script contains: gtm.start, googletagmanager.com/gtm.js, and 'GTM-WX8L' container ID",
          "screenshot": "GTM Script Injection_step08_gtm_script_injected.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify container ID is correctly substituted in script",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Examine the injected GTM script in page head using JavaScript evaluation",
          "expected": "Container ID placeholder [CONTAINERID] should be replaced with actual container ID",
          "actual": "Script contains 'GTM-MXMNS5J' (currently configured container) correctly substituted in the gtm.js URL parameter",
          "screenshot": "GTM Script Injection_step09_current_gtm_config.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify UseTagManagerForGA toggle affects script",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Check current GTM configuration - toggle is currently ON",
          "expected": "UseTagManagerForGA toggle should be visible and controllable",
          "actual": "Toggle was ON, eaSendGaEvents was 'true' in the injected script",
          "screenshot": "GTM Script Injection_step09_current_gtm_config.png"
        },
        {
          "step_number": 2,
          "action": "Toggle UseTagManagerForGA OFF and save",
          "expected": "Configuration should save successfully",
          "actual": "Success message appeared after saving with toggle OFF",
          "screenshot": "GTM Script Injection_step10_toggle_off_saved.png"
        },
        {
          "step_number": 3,
          "action": "Navigate to homepage and verify eaSendGaEvents value in script",
          "expected": "eaSendGaEvents should be 'false' in the GTM script",
          "actual": "eaSendGaEvents is 'false' in the injected GTM script - toggle change was reflected correctly",
          "screenshot": "GTM Script Injection_step11_toggle_verified.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify script injection on multiple CDefault pages",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to the News page",
          "expected": "GTM script should be injected on News page as well",
          "actual": "GTM script was present on News page with hasGtmScript: true, eaSendGaEvents: false",
          "screenshot": "GTM Script Injection_step12_news_page_gtm.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify pageVariant data layer variable",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Examine GTM script for pageVariant custom variable",
          "expected": "Script should contain pageVariant in the dataLayer initialization",
          "actual": "Script contains 'pageVariant' : 'Default' in the dataLayer push - personalized page variant tracking is working",
          "screenshot": "GTM Script Injection_step11_toggle_verified.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "The GTM Script Injection feature uses an HttpModule (TagManagerModule) that hooks into PreRequestHandlerExecute event",
    "Script injection only occurs on CDefault page types as verified in the code check: if (!(page is CDefault)) return",
    "The script template is loaded from GoogleTagManager.config and cached using DataCache",
    "Three placeholders are replaced in the template: [CONTAINERID], [USETAGMANAGERFORGA], and [DATALAYER_INIT]",
    "Container ID validation works by making a GET request to https://www.googletagmanager.com/gtm.js?id={containerId} and checking for HTTP 200 response",
    "The pageVariant variable is automatically set to 'Default' or the personalized page variant name if content personalization is active",
    "The eaSendGaEvents setting controls whether Google Analytics events should be sent through GTM (useful when GTM container already has GA configured)"
  ],
  "summary": {
    "total_scenarios": 7,
    "passed": 7,
    "failed": 0,
    "pass_rate": "100%"
  }
}
