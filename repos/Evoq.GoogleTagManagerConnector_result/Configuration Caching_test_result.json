{
  "metadata": {
    "extension_name": "Evoq.GoogleTagManagerConnector",
    "extension_type": "Connector",
    "feature_name": "Configuration Caching",
    "feature_description": "Caches GTM script template from configuration file to improve performance",
    "feature_priority": "Medium",
    "test_date": "2026-02-09T15:41:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify script template is cached on first access",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Connectors settings and verify GTM configuration exists",
          "expected": "GTM Container ID should be configured",
          "actual": "GTM Container ID 'GTM-5CVQBG' is configured in the Connectors panel with Edit button available",
          "screenshot": "Configuration Caching_step01_connectors_page.png"
        },
        {
          "step_number": 2,
          "action": "Open GTM configuration panel to view settings",
          "expected": "Configuration panel shows container ID and settings",
          "actual": "Configuration panel displays Container ID field with value 'GTM-5CVQBG' and checkbox for 'This GTM container has already been configured to add the Google Analytics Script'",
          "screenshot": "Configuration Caching_step02_gtm_config.png"
        },
        {
          "step_number": 3,
          "action": "Navigate to Home page and inspect page source for GTM script using JavaScript evaluation",
          "expected": "GTM script template from GoogleTagManager.config should be injected into page head",
          "actual": "GTM script was found with the correct template format including 'eaSendGaEvents' and 'pageVariant' variables from the config file template. Container ID 'GTM-WX8L' was used (different from UI-configured value).",
          "screenshot": "Configuration Caching_step03_gtm_script_injected.png"
        }
      ],
      "issues": ["Container ID in page source (GTM-WX8L) differs from UI-configured value (GTM-5CVQBG), suggesting multiple GTM configurations or site-level vs portal-level settings conflict"]
    },
    {
      "scenario_name": "Verify cache works across multiple requests",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to different page (Our Products) and check for GTM script",
          "expected": "Same GTM script template should be present from cache",
          "actual": "GTM script was NOT present on the Our Products page - no eaSendGaEvents, no pageVariant, no GTM container IDs found",
          "screenshot": "Configuration Caching_step04_inconsistent_script.png"
        },
        {
          "step_number": 2,
          "action": "Navigate back to Home page and verify script presence",
          "expected": "GTM script should still be present from cache",
          "actual": "GTM script was NOT present on subsequent Home page load - only GA4 dataLayer script found, no Evoq GTM script",
          "screenshot": "Configuration Caching_step04_inconsistent_script.png"
        }
      ],
      "issues": ["GTM script injection is inconsistent across page loads. Code review reveals a bug in TagManagerModule.cs line 76: cache is only set when scriptContent is empty (condition is inverted), which causes caching logic to fail."]
    },
    {
      "scenario_name": "Verify cache dependency on GoogleTagManager.config",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Review code in TagManagerModule.cs to verify cache dependency implementation",
          "expected": "Code should use DNNCacheDependency on the config file path",
          "actual": "Code at line 76 shows DNNCacheDependency is created with filePath parameter pointing to GoogleTagManager.config, which will invalidate cache when config file changes",
          "screenshot": "Configuration Caching_step02_gtm_config.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "Configuration Caching is a system-level automatic feature with no dedicated UI for cache management or status display",
    "The caching mechanism uses DNN's DataCache with key 'GoogleTagManagerScript' and DNNCacheDependency on the config file",
    "Code bug identified: TagManagerModule.cs line 76 has inverted condition - 'if (string.IsNullOrEmpty(scriptContent))' should be 'if (!string.IsNullOrEmpty(scriptContent))' to cache valid content",
    "The script template from GoogleTagManager.config uses placeholders [CONTAINERID], [USETAGMANAGERFORGA], and [DATALAYER_INIT] which are replaced at runtime",
    "Custom pageVariant variable is added dynamically via RenderCustomGtmScript() method for content personalization tracking",
    "Performance improvement from caching cannot be directly measured via UI - would require server-side profiling",
    "Test for cache invalidation on config file change cannot be performed via UI as it requires file system access to modify GoogleTagManager.config"
  ],
  "summary": {
    "total_scenarios": 3,
    "passed": 2,
    "failed": 1,
    "pass_rate": "67%"
  }
}
