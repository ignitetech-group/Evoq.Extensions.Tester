{
  "metadata": {
    "extension_name": "Evoq.GoogleTagManagerConnector",
    "extension_type": "Connector",
    "feature_name": "Page Variant Tracking",
    "feature_description": "Tracks personalized page variants in GTM dataLayer for A/B testing and personalization analytics",
    "feature_priority": "Medium",
    "test_date": "2026-02-09T15:35:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify GTM connector configuration",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to Settings > Connectors page",
          "expected": "Connectors page loads with list of available connectors",
          "actual": "Connectors page displayed showing all connectors including Google Tag Manager",
          "screenshot": "Page Variant Tracking_step01_gtm_not_configured.png"
        },
        {
          "step_number": 2,
          "action": "Click on Google Tag Manager 'Edit' button to view configuration",
          "expected": "GTM configuration form shows with Container ID field",
          "actual": "GTM configuration form displayed showing Container ID: GTM-5CVQBG (already configured)",
          "screenshot": "Page Variant Tracking_step06_gtm_container_id.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify default page variant 'Default' in dataLayer",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to home page and inspect dataLayer via JavaScript evaluation",
          "expected": "dataLayer contains pageVariant property with value 'Default'",
          "actual": "dataLayer contains: {eaSendGaEvents: false, pageVariant: 'Default'}. GTM script correctly injects: w[l].push({'eaSendGaEvents':false, 'pageVariant' : 'Default'})",
          "screenshot": "Page Variant Tracking_step05_gtm_configured_edit.png"
        },
        {
          "step_number": 2,
          "action": "Verify GTM script content in page head",
          "expected": "GTM script includes pageVariant in dataLayer initialization",
          "actual": "Script found: (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'eaSendGaEvents':false, 'pageVariant' : 'Default'});... with container ID GTM-5CVQBG",
          "screenshot": "Page Variant Tracking_step05_gtm_configured_edit.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify pageVariant appears in GTM dataLayer initialization",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Evaluate window.dataLayer to find pageVariant entry",
          "expected": "dataLayer array contains object with pageVariant property",
          "actual": "Found dataLayer entry: {eaSendGaEvents: false, pageVariant: 'Default'} confirming pageVariant is tracked in GTM dataLayer",
          "screenshot": "Page Variant Tracking_step05_gtm_configured_edit.png"
        },
        {
          "step_number": 2,
          "action": "Check GTM script injection in page source",
          "expected": "GTM script loads from googletagmanager.com with correct container ID",
          "actual": "GTM script loads from https://www.googletagmanager.com/gtm.js?id=GTM-5CVQBG and dataLayer is properly initialized with pageVariant",
          "screenshot": "Page Variant Tracking_step06_gtm_container_id.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Test variant tracking without personalization",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigate to different pages (Home, Our Products) without Content Personalization active",
          "expected": "pageVariant should be 'Default' on all pages since no personalization rules are matching",
          "actual": "Home page: pageVariant='Default', Our Products page: pageVariant='Default'. Code confirms: personalizedPageName defaults to 'Default' when HttpContext.Items[ContentPersonalizedPageVariantName] is null",
          "screenshot": "Page Variant Tracking_step07_products_page.png"
        },
        {
          "step_number": 2,
          "action": "Verify dataLayer on Our Products page",
          "expected": "dataLayer should contain pageVariant: 'Default'",
          "actual": "Evaluated dataLayer on /en-us/Our-Products: pageVariantInDataLayer=true, pageVariantValue='Default'. Script shows: w[l].push({'eaSendGaEvents':true, 'pageVariant' : 'Default'})",
          "screenshot": "Page Variant Tracking_step07_products_page.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify GTM Container ID validation",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempt to save GTM configuration with invalid container ID (GTM-TEST123)",
          "expected": "System validates container ID against Google servers",
          "actual": "Error message displayed: 'The Container Id is invalid or container hasn't been published yet.' - validation works correctly",
          "screenshot": "Page Variant Tracking_step03_gtm_validation_error.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "The pageVariant tracking requires GTM to be configured with a valid container ID. Without GTM configured, the script is not injected.",
    "The pageVariant value comes from Content Personalization's RuleEngine.cs which sets HttpContext.Items['evoq_PersonalizedPageVariantName'] when a personalized page variant matches the user's profile.",
    "Without Content Personalization rules active or matching, pageVariant defaults to 'Default' as implemented in TagManagerModule.RenderCustomGtmScript().",
    "Testing custom page variant names (non-Default values) would require configuring Content Personalization rules and having them match the current user, which is beyond the scope of this standard test.",
    "The eaSendGaEvents property varies by page configuration - observed false on Home page and true on Our Products page, controlled by the 'Use Tag Manager for GA' setting.",
    "GTM script injection uses the IIFE pattern with dataLayer initialization happening before gtm.js loads, ensuring pageVariant is available for GTM triggers."
  ],
  "summary": {
    "total_scenarios": 5,
    "passed": 5,
    "failed": 0,
    "pass_rate": "100%"
  }
}
