<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Report: Profanity Filter Settings</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }
        h2 {
            color: #0066cc;
            margin-top: 30px;
        }
        h3 {
            color: #444;
        }
        .feature-info {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .test-case {
            background-color: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .pass {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }
        .fail {
            color: #dc3545;
            font-weight: bold;
            font-size: 1.2em;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        .status-pass {
            background-color: #28a745;
        }
        .status-fail {
            background-color: #dc3545;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .steps {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #0066cc;
            margin: 10px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .issue {
            background-color: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }
        .summary {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }
        .summary-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .stat-box {
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            text-align: center;
        }
        .stat-pass {
            background-color: #28a745;
        }
        .stat-fail {
            background-color: #dc3545;
        }
        .observations {
            background-color: #fff3e0;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
            border-left: 4px solid #ff9800;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #0066cc;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>Test Report: Profanity Filter Settings</h1>

    <div class="feature-info">
        <h3>Feature Information</h3>
        <table>
            <tr><th>Extension</th><td>Evoq.PersonaBar.CommunitySettings</td></tr>
            <tr><th>Feature Name</th><td>Profanity Filter Settings</td></tr>
            <tr><th>Description</th><td>Configure profanity handling across all modules with options to filter content, prohibit content, or allow all content.</td></tr>
            <tr><th>UI Location</th><td>Admin > Settings > Community Settings > Settings tab</td></tr>
            <tr><th>Priority</th><td>High</td></tr>
            <tr><th>Test Date</th><td>January 6, 2026</td></tr>
        </table>
    </div>

    <h2>Test Results Summary</h2>
    <div class="summary">
        <div class="summary-stats">
            <div class="stat-box stat-pass">
                <div style="font-size: 2em;">4</div>
                <div>PASSED</div>
            </div>
            <div class="stat-box stat-fail">
                <div style="font-size: 2em;">2</div>
                <div>FAILED</div>
            </div>
        </div>
    </div>

    <h2>Test Scenarios</h2>

    <!-- Test Case 1 -->
    <div class="test-case">
        <h3>Test 1: Profanity Filter UI Availability</h3>
        <span class="status-badge status-pass">PASS</span>

        <p><strong>Objective:</strong> Verify the Profanity Filter dropdown is visible and accessible in Community Settings.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Logged in as SuperUser (host)</li>
                <li>Navigated to Settings > Community</li>
                <li>Located the "Profanity Filtering" section in Miscellaneous Community Settings</li>
                <li>Verified dropdown displays all three options</li>
            </ol>
        </div>

        <p><strong>Result:</strong> The Profanity Filtering dropdown is visible and shows three options: Filter Content, Prohibit Content, and No Filtering.</p>

        <img src="Profanity_Filter_Settings_step01_filter_options.png" alt="Profanity Filter Options" class="screenshot">
    </div>

    <!-- Test Case 2 -->
    <div class="test-case">
        <h3>Test 2: Set Profanity Filter to 'Filter Content' (Mask Profanity)</h3>
        <span class="status-badge status-pass">PASS</span>

        <p><strong>Objective:</strong> Test selecting and saving the "Filter Content" option which masks profanity.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Selected "Filter Content" from the Profanity Filtering dropdown</li>
                <li>Clicked the Save button</li>
                <li>Verified success notification appeared</li>
            </ol>
        </div>

        <p><strong>Result:</strong> "Filter Content" option was selected successfully and saved. Success message "Item successfully saved" appeared.</p>

        <img src="Profanity_Filter_Settings_step02_filter_content_saved.png" alt="Filter Content Saved" class="screenshot">
    </div>

    <!-- Test Case 3 -->
    <div class="test-case">
        <h3>Test 3: Set Profanity Filter to 'Prohibit Content' (Block Submission)</h3>
        <span class="status-badge status-pass">PASS</span>

        <p><strong>Objective:</strong> Test selecting and saving the "Prohibit Content" option which blocks submissions containing profanity.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Selected "Prohibit Content" from the Profanity Filtering dropdown</li>
                <li>Clicked the Save button</li>
                <li>Verified success notification appeared</li>
            </ol>
        </div>

        <p><strong>Result:</strong> "Prohibit Content" option was selected successfully and saved. Success message appeared confirming the save.</p>

        <img src="Profanity_Filter_Settings_step03_prohibit_content_saved.png" alt="Prohibit Content Saved" class="screenshot">
    </div>

    <!-- Test Case 4 -->
    <div class="test-case">
        <h3>Test 4: Set Profanity Filter to 'No Filtering' (Allow All)</h3>
        <span class="status-badge status-pass">PASS</span>

        <p><strong>Objective:</strong> Test selecting and saving the "No Filtering" option which allows all content.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Selected "No Filtering" from the Profanity Filtering dropdown</li>
                <li>Clicked the Save button</li>
                <li>Verified success notification appeared</li>
            </ol>
        </div>

        <p><strong>Result:</strong> "No Filtering" option was selected successfully and saved. Success message appeared confirming the save.</p>

        <img src="Profanity_Filter_Settings_step04_no_filtering_saved.png" alt="No Filtering Saved" class="screenshot">
    </div>

    <!-- Test Case 5 -->
    <div class="test-case">
        <h3>Test 5: Verify Setting Persistence After Page Refresh</h3>
        <span class="status-badge status-fail">FAIL</span>

        <p><strong>Objective:</strong> Verify that the saved Profanity Filter setting persists after page refresh.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Set Profanity Filter to "No Filtering"</li>
                <li>Saved the setting (success message appeared)</li>
                <li>Refreshed the page by navigating away and back</li>
                <li>Re-opened Community Settings</li>
                <li>Checked the Profanity Filtering dropdown value</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> After saving "No Filtering" and refreshing the page, the Profanity Filter reverted to "Filter Content" instead of retaining the saved "No Filtering" value. The setting does NOT persist correctly.
        </div>

        <p><strong>Expected:</strong> Dropdown should show "No Filtering" (the last saved value)</p>
        <p><strong>Actual:</strong> Dropdown shows "Filter Content"</p>

        <img src="Profanity_Filter_Settings_step05_persistence_check.png" alt="Persistence Check" class="screenshot">
        <img src="Profanity_Filter_Settings_step07_persistence_verification.png" alt="Persistence Verification - Filter Content shown instead of No Filtering" class="screenshot">
    </div>

    <!-- Test Case 6 -->
    <div class="test-case">
        <h3>Test 6: Verify Default Value (Expected: No Filtering)</h3>
        <span class="status-badge status-fail">FAIL</span>

        <p><strong>Objective:</strong> Verify the default value is "No Filtering" (value 2) as specified in the feature documentation.</p>

        <div class="steps">
            <strong>Steps Taken:</strong>
            <ol>
                <li>Observed the current Profanity Filter value after page load</li>
                <li>Compared to expected default value</li>
            </ol>
        </div>

        <div class="issue">
            <strong>Issue Found:</strong> The documentation states the default value should be "No Filtering" (value 2) for new installations. However, the observed value after loading is "Filter Content" (value 0). This could indicate either:
            <ul>
                <li>The default value in the database is not set correctly</li>
                <li>The persistence mechanism is not working, causing fallback to index 0</li>
                <li>The feature specification differs from the implementation</li>
            </ul>
        </div>

        <p><strong>Expected:</strong> "No Filtering" (as documented default for new installations)</p>
        <p><strong>Actual:</strong> "Filter Content" is shown</p>
    </div>

    <h2>Observations</h2>
    <div class="observations">
        <h3>Additional Notes</h3>
        <ul>
            <li><strong>Save Operation:</strong> The save operation appears to work correctly at the UI level - a success notification is displayed. However, the settings do not persist to the database or are not retrieved correctly on subsequent page loads.</li>
            <li><strong>Profanity Handling Test:</strong> Testing actual profanity filtering behavior (masking profanity, blocking submissions) would require posting content containing profanity through community modules (Discussions, Ideas, etc.). This was not tested as it requires additional setup and test data.</li>
            <li><strong>Code Reference:</strong> The relevant code in CommunitySettings.js shows profanityFilter is handled as a knockout observable with a default value of 0. The SaveSettings function sends ProfanityFilter as part of the settings params. The persistence issue may be in the server-side SaveCmxSettings method or the GetSettings retrieval logic.</li>
            <li><strong>Group Home Page:</strong> It was also observed that the Group Home Page setting showed "Wiki" selected after page load, suggesting there may be similar persistence issues with other settings, or there may be a caching mechanism affecting the displayed values.</li>
        </ul>
    </div>

    <h2>Technical Details</h2>
    <div class="test-case">
        <h3>Relevant Code Files</h3>
        <ul>
            <li><strong>Controller:</strong> src/Modules/Evoq.PersonaBar.CommunitySettings/Services/CommunitySettingsController.cs</li>
            <li><strong>JavaScript:</strong> src/Modules/Evoq.PersonaBar.CommunitySettings/admin/personaBar/scripts/CommunitySettings.js</li>
        </ul>

        <h3>API Endpoints</h3>
        <ul>
            <li><code>GET /API/PersonaBar/CommunitySettings/GetSettings</code> - Retrieves all community settings including ProfanityFilter</li>
            <li><code>POST /API/PersonaBar/CommunitySettings/SaveSettings</code> - Saves all community settings</li>
        </ul>

        <h3>Profanity Filter Values</h3>
        <table>
            <tr><th>Value</th><th>Option</th><th>Behavior</th></tr>
            <tr><td>0</td><td>Filter Content</td><td>Masks profanity in content</td></tr>
            <tr><td>1</td><td>Prohibit Content</td><td>Blocks submission of content containing profanity</td></tr>
            <tr><td>2</td><td>No Filtering</td><td>Allows all content without filtering</td></tr>
        </table>
    </div>

    <h2>Recommendations</h2>
    <div class="test-case">
        <ol>
            <li><strong>Investigate Persistence Issue:</strong> Debug the SaveCmxSettings and GetCmxSettings methods to determine why the Profanity Filter setting is not persisting correctly.</li>
            <li><strong>Verify Database State:</strong> Check the database table storing these settings to confirm if the value is being written correctly.</li>
            <li><strong>Test Profanity Behavior:</strong> Once the persistence issue is resolved, perform end-to-end testing with actual profanity words to verify each mode works as expected.</li>
            <li><strong>Clarify Default Value:</strong> Confirm whether the intended default is "No Filtering" (value 2) as documented, or "Filter Content" (value 0) as observed.</li>
        </ol>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
        <p>Test Report Generated: January 6, 2026</p>
        <p>Tester: Automated Test via Claude</p>
        <p>Extension: Evoq.PersonaBar.CommunitySettings</p>
    </footer>
</body>
</html>
